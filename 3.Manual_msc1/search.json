[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Talleres de Análisis Multivariados en R",
    "section": "",
    "text": "Talleres de Estadística Multivariada\n\n\nJavier Rodríguez Barrios\n\n\nMaestría en Ecología y Biodiversidad\n\n\n“Actualizado: 2023-03-26”"
  },
  {
    "objectID": "summary.html",
    "href": "summary.html",
    "title": "2  Resumen",
    "section": "",
    "text": "El siguiente manual es un compendio de temas vistos en el componente práctico del módulo de estadística multivariada de la Maestría en Ecología y Biodiversidad. Se fundamenta en cuatro grandes módulos:\n\nIntroducción al RStudio y al algebra lineal aplicada a multivariados.\nExloración y visualización gráfica de datos univariados y multivariados.\nTécnicas de ordenación multivariada (PCA, NMDS, MCA y RDA).\nTécnicas de clasificación multivariada (CLA, LDA)\nPruebas de hipótesis (MANOVAS y PERMANOVAS).\n\nPara un mejor entendimiento de este manual, se sugiere complementar la información con las referencias bibliográficas sugeridas en cada capitulo, especialmente el libro **Análisis de datos ecológicos y ambientales - aplicaciones en el programa R” de Rodríguez-Barrios (2023) enlace"
  },
  {
    "objectID": "intro.html",
    "href": "intro.html",
    "title": "3  Introducción",
    "section": "",
    "text": "This is a book created from markdown and executable code.\nSee Knuth (1984) for additional discussion of literate programming.\n\n1 + 1\n\n[1] 2\n\n\n\n\n\n\nKnuth, Donald E. 1984. «Literate Programming». Comput. J. 27 (2): 97-111. https://doi.org/10.1093/comjnl/27.2.97."
  },
  {
    "objectID": "Introducción_R.html",
    "href": "Introducción_R.html",
    "title": "4  Taller 1. Introducción a R y a Tidyverse",
    "section": "",
    "text": "4.0.1 R como calculadora\n\n# Operaciones aritméticas básicas\n5 + 7   # Suma\n5 - 3   # Resta\n5 * 7   # Multiplicación\n5/3     # División\n2^3     # Exponentes\n\n\n# Logarítmos y exponenciales\nx = 5/3\nlog2(x)     # Logarítmo en base 2 de x\nlog10(x)    # Logarítmo en base 10 de x\nexp(x)      # Exponencial de x\n\n\n# Funciones trigonométricas :\ncos(x)    # Coseno de x\nsin(x)    # Seno de x\ntan(x)    # Tangente de x\n\n\n\n4.0.2 Asignaciones\n\n# 2) Asignaciín de valores a objetos o a variables\nsitios <- 2         # Número de sitios = 2\nsitios = 2          # Otra forma\nn.sitios <- \"dos\"   # Número de sitios como un caracter\ndos.sitios <- TRUE  # Objeto lógico\n\n\n\n4.0.3 Algebra\n\n# Vectores\nsitios <- c(2, 3, 2, 3)   # Vector sitios\nsitios                    # Imprimir el vector\n\nsitios <- c(\"dos\", \"tres\", \"dos\", \"dos\")    # Vector como caracter\nsitios\n\nabundancia <- c(TRUE, FALSE, TRUE, TRUE)    # vector con elementos lógicos\nabundancia\n\n\n# Vectores (continuación)\nsitios <- c(2, 3, 2, 3)   # Vector sitios\nnames(sitios) <- c(\"dos\", \"tres\", \"dos\", \"dos\")   # Nombres de los elementos \n\nsitios <- c(dos= 2, tres= 3, dos= 2, dos= 2)      # Otra forma\nsitios\n\n\n# Vectores (continuación)\nsitios [1:3]      # Tres primeros elementos del vector sitios\nsitios[c(1,4)]    # Primer y cuarto elemento del vector\nsitios [-1]       # Eliminar el primer elemento del vector\n\n\n# Matrices\nMatriz <- matrix(c(1:15),5,3, byrow= FALSE)   # 5,3: Número de filas y columnas\nMatriz\n\n\n# Matrices (continuación)\nt(Matriz)         # Transpuesta de la Matriz\nMatriz[2,]        # Ver la segunda fila (coma a la derecha del dato)\nMatriz[,2]        # Ver la segunda columna (coma a la izquierda del dato)\nMatriz[2:4,]      # Filas 2 a la 4\nMatriz[c(2,4),]   # Filas 2 y 4\nMatriz[ ... ]     # Valores de la fila 3 y de las columnas 1:3\nMatriz[ ... ]     # Excluye a la 3a fila\n\n\n\n4.0.4 Bases de datos (data.frames - cbind)\n\n# Base de datos (datos)\ndatos <- data.frame(\n  \"n\" = 1:4,                                   # filas\n  \"indiv.\" = c(\"a\", \"b\", \"c\", \"d\"),            # Individuos\n  \"sexo\"   =  c(\"f\",\"f\",\"m\",\"m\"),              # Sexo\n  \"variable\" = c(1.2, 3.4, 4.5, 5.6))          # Valor de la variable\n\ndatos      # Ver asinación del data.frame\n\n\n# Base de datos (continuación)\nhead(datos)     # Muestra las primeras filas\nnames(datos)    # Nombres de las columnas\nstr(datos)      # Estructura de la base de datos\nt(datos)        # Transpuesta de la base de datos\n\n\n\n4.0.5 Enlaces de operaiciones en R\nDiapositivas Intro a R\nDiapositivas Operaciones en R\nTrucos en R\nRPubs-Intro\nRPubs-Intermed\n/page()\n\n\n5 Importar y exportar bases de datos (read y write)\n\n5.0.1 Complementos requeridos\n\n# Librerías requeridas\nlibrary(tidyverse)\nlibrary(xtable)       # Importar y exportar\nlibrary(openxlsx)     # exportar \"*.xlsx\" \nlibrary(readxl)       # Importar y exportar\nlibrary(xlsx)         # Importar y exportar \"*.xlsx\" \n\n\n\n5.0.2 Base de datos del ejercicio\n\n# Base de datos (datos)\ndatos = data.frame (meses = c(\"enero\", \"junio\", \"octubre\"),\n                    periodos = c(\"sequía\", \"lluvias1\", \"lluvias2\"),\n                    taxón1 = c(2, 1, 3),\n                    taxón2 = c(20, 25, 30),\n                    taxón3 = c(4, 4, 4))\n\ndatos  # Ejecutar la asignación (datos)\n\n\n\n5.0.3 Exportación\n\n# Exportar bases de datos como \"datos1\"\n\nwrite.csv2(datos, \"datos1.csv\")   # paquete \"utils\" \n\nwrite_csv2(datos, \"datos1.csv\")   # paquete \"readxl\" \n\nwrite.xlsx(datos, \"datos1.xlsx\")  # paquete \"openxlsx\" y \"xlsx\"\n\n\n\n5.0.4 Importación\n\n# Importar bases de datos como \"datos1\"\n\ndatos1 <- read.csv2(\"datos1.csv\", row.names = 1)    # paquete \"utils\" \ndatos1 <- read.csv2(file.choose(), row.names = 1)   # paquete \"utils\" \n\ndatos1 <- read_csv2(\"datos1.csv\")     # paquete \"readxl\" \ndatos1 <- read_csv2(file.choose())    # paquete \"readxl\" \n\ndatos1 <- read_excel(\"datos1.xlsx\")    # paquete \"readxl\" \ndatos1 <- read_excel(file.choose())    # paquete \"readxl\" \n\ndatos1 <- read.xlsx(\"datos1.xlsx\")    # paquete \"openxlsx\"\ndatos1 <- read.xlsx(file.choose())    # paquete \"openxlsx\"\n\n\n\n5.0.5 Importación desde internet\n\n# Importar archivo *.csv desde la web\ndatos2 <- read.csv2(\"https://javier-2712.github.io/Multivariados/Insectos.csv\")\n\ndatos2 <- read_csv2(\"https://javier-2712.github.io/Multivariados/Insectos.csv\")\n\n\n\n5.0.6 Enlaces de importación y Exportación de datos\nImportación de datos1\nImportación de datos2\nDiapositivas\nResúmenes con psych\n/page()\n\n\n\n6 Introductorio a Tidyverse\n\n6.0.1 Importar la base de datos (datos)\n\ndatos1 <- read_excel(file.choose())    # paquete \"readxl\" \n\n\n\n6.0.2 Manipulación de los datos enlace\n\ncomando gather para visualizar bases de datos alargadas\ncomando spread para visualizar bases de datos a lo ancho\ncomando %>% tuberías o pippelines.\n\n\n# Base de datos alargada (datos.l)\ndatos.l <- datos %>% \n  gather(key= Columnas, value= Valores)\ndatos.l\n\n\n# Excluir la columna periodo en formato alargado (-periodos)\ndatos.l <- datos %>%\n  gather(key= columnas, value= valores, -periodos)\ndatos.l\n\n\n\n6.0.3 Nueva base de datos con factor\n\n# Base de datos para 4 estudiantes (con 4 replicas)\n# a los que se les midieron dos variables en cuatro ocasiones.\ndatos <- data.frame(n= 1:16,\n                    Estudiante= c(\"a\",\"a\",\"a\",\"a\",\"b\",\"b\",\"b\",\"b\",\n                                 \"c\",\"c\",\"c\",\"c\", \"d\",\"d\",\"d\",\"d\"),\n                    Sexo= c(\"f\",\"f\",\"f\",\"f\",\"f\",\"f\",\"f\",\"f\",\n                            \"m\",\"m\",\"m\",\"m\",\"m\",\"m\",\"m\",\"m\"),\n                    Variable1= c(1.2,3.4,4.5,5.6,1.2,3.4,4.5,5.6,\n                                 0.8,2.4,1.8,1.5,1.6,2.1,1.2,0.8),\n                    Variable2= c(2.4,6.8,9.0,11.2,2.4,6.8,9.0,11.2,\n                                 1.6,4.8,3.6,3.0,3.2,4.2,2.4,1.6))\ndatos\n\n\n\n6.0.4 Filtrando elementos del dataframe (filter)\n\n# Fitrado por sexos \"f\" y \"m\"\ndatos.f <- datos %>% filter(Sexo == \"f\")\ndatos.f  # Base de datos para mujeres\n\ndatos.h <- datos %>% filter(Sexo == \"m\")\ndatos.h  # Base de datos para hombres\n\n\n# Fitrado por sexos y estudiantes \"f\" y \"m\"\ndatos.a <- datos %>% filter(Sexo ==\"f\", Estudiante ==\"a\")\ndatos.a  # Datos de la estudiante a\n\ndatos.a <- datos.f %>% filter(Estudiante ==\"a\")\ndatos.a # Datos de la estudiante a\n\n\n\n6.0.5 Filtrando en orden descendente o ascendente (arrange)\n\n# Filtrando en orden descendente y ascendente\ndatos.des <- datos %>% arrange(desc(Variable1))\ndatos.des  # Variable asignada\n\ndatos.asc <- datos %>% arrange(Variable1)\ndatos.asc  # Variable asignada\n\n\n\n6.0.6 Combinación de filtrado y orden (filter + arrange)\n\n# Filtrar mujeres en orden descendente. \ndatos.des.f <- datos %>% \n  filter(Sexo == \"f\")  %>% \n  arrange(desc(Variable1))\ndatos.des.f  # Asignación \n\n\n\n6.0.7 Generación de variables derivadas (arrange)\n\n# Insertar nuevas variables (mutate)\ndatos.3 <- datos %>% \n  mutate(Variable3 = Variable1 * Variable2)\ndatos.3  # Asignación \n\n\n\n6.0.8 Combinación de filtrado, nuevas variables y orden (filter + mutate + arrange)\n\n# Combinación de funciones (filter, mutate, arrange)\ndatos.4  <- datos %>%\n  filter (Sexo == \"f\") %>%\n  mutate (Variable3 = Variable2 * 12) %>%\n  arrange (desc(Variable3))\ndatos.4   # Asignación \n\n\n# Combinación de funciones (filter, mutate, arrange)\ndatos.4  <- datos %>%\n  filter (Sexo == \"f\", Estudiante == \"b\") %>%\n  mutate (Variable3 = Variable2 * 12) %>%\n  arrange (desc(Variable3))\ndatos.4\n\n\n\n6.0.9 Enlaces de operaiciones en Tidyverse\nVideos de Tidyverse\nIntroducción al Tidyverse\nIntroducción al Tidyverse\nIntroducción al Tidyverse\nEl Tidyverso y tidyr\nCurso de Tidyverse\n10 funciones de Tidyverse\nManipulación de datos\nEstandarización de variables\nTransformaciones de variables\n/page()\n\n\n\n7 Taller práctico para la casa\n\nRealizar los ejemplos del siguiente enlace, utilizando las siguientes opciones de tidyverse:\n\n\nFilter\nArrange\nMutate\n\n\nRealizar los ejemplos del siguiente enlace, utilizando las siguientes opciones de tidyverse:\n\n\nPipeline\nsummarize\ngroup_by\nmutate\nfilter\nselect\njoins\n\n\nRealizar los ejemplos del siguiente enlace, utilizando las siguientes opciones de tidyverse:\n\n\nsummarize\ngroup_by\nmutate\nfilter\nselect\n\n\nRealizar los ejemplos del siguiente enlace, utilizando las siguientes opciones de tidyverse:\n\n\nEjemplo de los censos\nspread"
  },
  {
    "objectID": "Algebra_R.html",
    "href": "Algebra_R.html",
    "title": "5  Taller 2.1 Operaciones matriciales",
    "section": "",
    "text": "Objetivo: Comparar los resultados del PCA anterior con los generados por un paquete o librería de R\nPoner en práctica operaciones matriciales, para resolver un ejercicio de ordenación multivariada, denominado “Análisis de Componentes Principales - PCA“, cuyo objetivo es relacionar a las observaciones de las matrices o de las bases de datos (filas de la matriz), de acuerdo a las variables definidas (columnas de la matriz). Finalmente se realizará la misma técnica con la librería vegan de R. La base de datos a utilizar se presenta en dos formatos: caimanes.csv y caimanes.xlsx. Esta base cuenta con 3 variables morfométricas (columnas) y 17 individuos evaluados (filas)."
  },
  {
    "objectID": "Algebra_R.html#procedimiento-del-pca",
    "href": "Algebra_R.html#procedimiento-del-pca",
    "title": "5  Taller 2.1 Operaciones matriciales",
    "section": "8.1 Procedimiento del PCA",
    "text": "8.1 Procedimiento del PCA\n\n\nCargar librerías requeridas\nCargar la base datos (usar diferentes opciones para practicar)\nHallar el vector de medias (v.m) y la matriz centrada (m.c)\nHallar la matriz de covarianzas de m.c (s.c)\nHallar la matriz de autovectores o vectores propios (v.p)\nHallar la matriz rotada de A (m.r)\nGraficar (stats y ggplot2)\nComparar con el PCA realizado en el paquete vegan\n\n\n\n8.1.0.1 1. Cargar las librerías requeridas\n\n\n# Librerías requeridas\nlibrary(tidyverse)\nlibrary(xtable)       # Importar y exportar\nlibrary(openxlsx)     # exportar \"*.xlsx\" \nlibrary(readxl)       # Importar y exportar\n\nlibrary(ggplot2)       # gráfica en ggplot2\nlibrary(ggrepel)      # insertar rótulos a los puntos\nlibrary(vegan)        # para realizar el pca con vegan\n\n\n\n\n8.1.0.2 2. Cargar o importar la base de datos\n\n\n#------------\ndatos <- read_excel(\"caimanes.xlsx\")    # paquete \"readxl\" \nhead(datos)\n\ndatos <- read_csv2(\"caimanes.csv\")      # paquete \"readxl\"\nhead(datos)\n\ndatos <- read.csv2(\"caimanes.csv\")      # paquete \"utils\"\nhead(datos)\n\n\nAjustar la base de datos\n\n\n# Resumir los rótulos de las columnas\ncolnames(datos) <- c(\"ID\", \"Sexo\",\"LT\",\"CD\",\"CS\")       # Rótulos de la base de datos\nhead(datos)          # Base de datos abreviada\nstr(datos)\n\n\n\n\n8.1.0.3 3. Hallar el vector de medias (v.m) y la matriz centrada (m.c)\n\n\nv.m <- colMeans(datos[,3:5])   # Vector de medias\nv.m\n\nm.c <- t(t(datos[,3:5]) - v.m) # Centralización de datos = Matriz centrada\nround(m.c , 2)\n\n\n\n\n8.1.0.4 4. Vectores própios (v.p)\n\n\ns.c <- var(m.c)       # Covarianza de la matriz centrada\nround(s.c , 2)\n\nvv.p <- eigen(s.c)    # Vectores y valores propios de m.centrada\nround(vv.p, 2)\n\nv.p  <- vv.p$vectors   # Matriz de vectores propios \nround(v.p , 2)\n\n\n\n\n8.1.0.5 5. Matriz Rotada (m.r)\n\n\nm.c <- as.matrix(m.c)   # Matriz centrada (m.c)\nround(m.c, 2)\n\nm.r <- m.c %*% v.p      # Matriz rotada (m.r)\nround(m.r, 2)\n\nA <- data.frame (n= 1:16, A)  # matriz A como dataframe\nround(A, 2)\n\n\n\n\n8.1.0.6 6. figura (paquete - stats)\n\n\nx11()\nplot(m.r[,1:2],\n     xlab=\"PC1\", ylab=\"PC2\")\n\ntext(m.r,               # Rótulos de los datos (caimanes)\n     labels = row.names(datos),\n     pos=3, cex=0.7)    \n\nabline(v=0, lty=2,col= \"blue\")\nabline(h=0, lty=2,col= \"blue\")\n\n\n\n\n8.1.0.7 7. figura)\n\n\nx11()\nm.r <- data.frame(m.r)   # matriz rotada como data.frame \n\nggplot(m.r, aes(x= X1 ,y= X2)) +\n  geom_point() +\n  geom_text_repel (aes (label = datos$ID)) +\n  geom_hline(yintercept=0,linetype=2,size=1) +\n  geom_vline(xintercept=0,linetype=2,size=1)\n\n\n\n\n8.1.1 Análisis de Componentes principales - PCA en librería \"vegan\"\n\nObjetivo: Comparar los resultados del PCA anterior con los generados por un paquete o librería de R\n\n\n8.1.1.1 1. Realización del PCA\n\n\n# Comparar con el Análisis de Componentes Principales - pca\nhead(datos[,3:5])             # Variables y observaciones (caimanes)\npca <- rda(datos[,3:5])       # Realización del pca\n\n\n\n\n8.1.1.2 2. Figura del PCA\n\n\nx11()\nbiplot(pca)"
  },
  {
    "objectID": "Exploratorios.html#procedimiento-de-la-exploración",
    "href": "Exploratorios.html#procedimiento-de-la-exploración",
    "title": "6  Taller 3. Exploración Univariada y Multivariada",
    "section": "6.1 Procedimiento de la exploración",
    "text": "6.1 Procedimiento de la exploración\n\n\nCargar librerías requeridas\nCargar la base Insectos (usar diferentes opciones para practicar)\nExplorar al objetivo 1 (figuras de elipses, pares, dispersión y coplot).\nExplorar al objetivo 2 (figuras de elipses, pares, dispersión y coplot).\nRealizar las opciones gráficas relacionadas a los objetivos.\nRealizar transformaciones de los datos, para mejorar la visualización de patrones.\nPracticar con leyendas y resultados de la visualización realizada.\n\n\n\n6.1.0.1 Cargar las librerías requeridas\n\n\n# Librerías requeridas\nlibrary(tidyverse)\nlibrary(xtable)       # Importar y exportar\nlibrary(openxlsx)     # exportar \"*.xlsx\" \nlibrary(readxl)       # Importar y exportar\n\nlibrary(stats)        # Para las figuras de pares\nlibrary(lattice)      # No se requiere instalar\nlibrary(ggplot2)      # gráfica en ggplot2\nlibrary(ggrepel)      # insertar rótulos a los puntos\nrequire(SciViews)     # Fig. dispersión con coef. de pearson\nlibrary(plotrix)      # Figuras de cajas con múltiples variables\nlibrary(reshape)      # Figuras de cajas con múltiples variables\nlibrary(corrplot)     # Figuras de elipses\nlibrary(gridExtra)    # Para figuras estadísticas (varios factores)\nlibrary(grid)         # Para figuras estadísticas (varios factores)\n\nNota: ggcorrplot2 requiere instalarse de la siguiente manera, debido a que está en proceso de ajuste para las nuevas plataformas de R. ver_enlace_procedimiento\n\n# Instalar \"ggcorrplot2\", solo por una vez\ninstall.packages(\"remotes\")\nremotes::install_github(\"caijun/ggcorrplot2\")\n\n\nNota: gganimate requiere instalarse de la siguiente manera: ver_enlace_procedimiento\n\n\ninstall.packages('gganimate')\ndevtools::install_github('thomasp85/gganimate')\n\n\n\n\n6.1.0.2 Cargar o importar la base de datos\n\n\n#------------\ndatos <- read.csv2(\"Insectos.csv\")      # paquete \"utils\"\nhead(datos)\n\n  quebrada cuenca  pH temp Efem Plec Tric Dipt Cole Ab\n1        1  cuen1 6.8 17.4   26    4    9   30    3 72\n2        4  cuen1 7.3 16.8   17    6    9   25    1 58\n3       11  cuen1 5.6 16.0    9    3   28   24    3 67\n4       13  cuen1 6.3 17.8    2    3   25   21    6 57\n5       19  cuen1 5.6 18.2    6    4   24   12   13 59\n6        3  cuen2 6.3 17.0    7    2   25   10    1 45\n\n\n\n\n\n6.1.1 1. Figuras de elipses\n\nEl Paquete corrplot es el que permite realizar las opciones gráficas de elipses a color, ingresar a este enlace:\ncorrplot\nOtro enlace a corrplot:\ncorrplot\n\n#---\n# 1. Elipses\nlibrary(corrplot)\n\n# Elipses con colores\nM <- cor(datos[,3:10])            # Matriz de Correlación (M)\n\n# Elipses con colores\nx11()                            # Panel gráfico adicional\ncorrplot(M, method = \"ellipse\")  # Figura de correlaciones con elipses\n\n\n\n# Elipses con colores\nX11()\ncorrplot(M, method = \"circle\")   # Figura de correlaciones con circulos\n\n\n\n# Elipses con colores\nX11()\ncorrplot.mixed(M, upper=\"ellipse\")\n\n\n\n\n\n# Figura de elipses con coeficientes de correlación\nx11()\ncorrplot(M,  method = \"circle\",            # Correlaciones con circulos\n         type = \"lower\", insig=\"blank\",    # Forma del panel\n         order = \"AOE\", diag = FALSE,      # Ordenar por nivel de correlación\n         addCoef.col =\"black\",             # Color de los coeficientes\n         number.cex = 0.8,                 # Tamaño del texto\n         col = COL2(\"RdYlBu\", 200))        # Transparencia de los circulos\n\n\n\n\n\n\n\n6.1.2 3. Figuras de Dispersión por pares de variables (pairs)\n\nEl Paquete pairs es el que permite realizar las opciones gráficas de dispersión por parejas de variables, ingresar a este enlace:\npairs\nOtro enlace a pairs:\npairs\n\n# Figuras de pares\nx11()\npairs ((datos[,c(3:9)]),panel=function(x,y)\n{abline(lsfit(x,y)$coef,lwd=2,col=3)    # lwd = Ancho de la línea\n  lines(lowess(x,y),lty=1,lwd=3,col=2)    # col= Color de la línea\n  points(x,y,cex=1)}) \n\n\n\n\n\n# Incluir el factor (cuenca)\n# **requiere a cuenca como factor\ndatos$cuenca =as.factor(datos$cuenca)\npairs ((datos[,c(3,7,8,10)]),panel=function(x,y)\n{abline(lsfit(x,y)$coef,lwd=2,col=3)\n  lines(lowess(x,y),lty=2,lwd=2,col=2)\n  points(x,y,col=datos$cuenca, cex=1.4,pch=19)})\n\n\n\n\n\n# Correlaciones de Pearson\nlibrary(SciViews)\nx11()\npairs(datos[,c(3,7,8,10)], diag.panel = panel.hist, \n      upper.panel = panel.cor, lower.panel = panel.smooth)\n\n\n\n\n\n# Incluir histogramas\npairs(datos[, 3:10], diag.panel = panel.hist, \n      upper.panel = panel.cor, lower.panel = panel.smooth)\n\n\n\n\n\n\n6.1.3 3. Histogramas\n\n\n# Frecuencias de abundancias \nhistogram (~Ab,data=datos, ylab=\"Porcentaje del Total\",\n           xlab=\"Abundancia de insectos\")\n\n\n\n# Frecuencias de abundancias por cuencas\nhistogram (~Ab|cuenca,data=datos, ylab=\"Porcentaje del Total\",\n           xlab=\"Abundancia de insectos\")\n\n\n\n\n\n# Frecuencias por densidad\ndensityplot(~Ab,data=datos, ylab=\"Porcentaje del Total\",\n            xlab=\"Abundancia de insectos\")  \n\n\n\ndensityplot(~Ab|cuenca,data=datos, ylab=\"Porcentaje del Total\",\n            xlab=\"Abundancia de insectos\")\n\n\n\n\n\n# Frecuencias de abundancias por densidad\nggplot(data = datos, aes(x = Ab, color = cuenca)) +\n  geom_density(aes(fill = cuenca), alpha = 0.5) +\n  labs( y=\"Frecuencia\", x=\"Abundancia\")\n\n\n\n\n\n# Otra opción\nggplot(data = datos, aes(x = Ab, color = cuenca)) +\n  geom_density(aes(fill = cuenca)) + \n  facet_wrap(~ cuenca)\n\n\n\n\n\n\n\n6.1.4 4. Dispersión X-Y\n\nEl Paquete lattice es uno de los que permite realizar las opciones gráficas de dispersión, ingresar a este enlace:\nlattice\n\n# Regresión lineal (esquema básico) \nlibrary(lattice)\ndatos$cuenca <- as.factor (datos$cuenca)  # cuenca como factor\n\nx11()\nplot(Efem~pH,                         # Relación pH vs. Efem\n     col=as.integer(cuenca),          # Colores por tipo de cuencas\n     data=datos, pch=19)              # Base de datos\nlegend(5.5,25,                        # Coordenadas de la leyenda\n       legend=levels(datos$cuenca),   # Grupos de la leyenda\n       pch=19,col=1:4,cex=1.2)\nlines(abline(lm(datos$Efem~datos$pH), # regresión lineal\n             lwd=2,col=2, lty=2))\n\n\n\n\n\n\n6.1.4.1 Dispersión X-Y con ggplot2\n\nEl Paquete ggplot2 es el que permite realizar las opciones gráficas de dispersión bivariados, ingresar a este enlace:\nRPubs.\nOtro enlace a ggplot2:\nggplot2\n\n# Regresiones lineales (Esquema ggplot2) \nggplot(datos,aes(x = pH,y = Efem)) +   \n  geom_point(aes(color = cuenca), size = 3) +  \n  geom_smooth(method= \"lm\") +\n  theme_classic()\n\n\n\n\n\n# Regresiones suavizadas - Loess o Lowess (Esquema ggplot2) \nggplot(datos,aes(x = pH, y = Efem)) +   \n  geom_point(aes(color = cuenca), size = 3) +  \n  geom_smooth()\n\n\n\n\n\n# Regresiones suavizadas (Loess)\nggplot(datos,aes(x = pH, y = Efem)) +   \n  geom_point(aes(color = cuenca), size = 3) +  \n  geom_smooth(se = FALSE, span = 0.4)\n\n\n\n\n\n\n\n\n6.1.5 5. Cajas y Bigotes\n\nEl Paquete lattice es uno de los que permite realizar las opciones gráficas de cajas, ingresar a este enlace:\nHow to make a boxplot in R\nEl Paquete ggplot2 presenta opciones más estéticas y robustas para estas y muchas más figuras, ingresar a este enlace:\nEnlace1\nEnlace2\n\n# Figuras de Cajas y bigotes\ndatos$cuenca<-factor(datos$cuenca, \n                     levels=c(\"cuen1\",\"cuen2\",\"cuen3\",\"cuen4\"))\n\n# Cajas y Bigotes con muescas\nboxplot(Ab~cuenca,data=datos,notch=TRUE,\n        xlab=\"Cuencas\",ylab=\"Abundancia\",\n        col=\"lightgray\", cex.lab=1.3)     # Probar con otros colores\n\n\n\n\nEnlaces de paletas de colores para la edición de las figuras:\ncolorbrewer\ncoolors\n\n# Buscar en google: colorbrewer2\nggplot(datos, aes(x=cuenca, y=Ab)) + \n  geom_boxplot(aes(fill = cuenca)) +\n  scale_fill_manual(values = c('#fc8d59','#ffffbf','#99d594','#377eb8'))\n\n\n\n\n\n# Organización por nivel de magnitud\nggplot(datos, aes(x = fct_reorder(cuenca, Ab),y=Ab)) + \n  geom_boxplot(notch = T, aes(fill = cuenca)) +\n  scale_fill_manual(values = c('#fc8d59','#ffffbf','#99d594','#377eb8'))\n\n\n\n\nParéntesis Base de datos de lirios (iris) para figura de violín\n\n# violin: como histograma acostado\nggplot(iris, aes(x = Species, y = Sepal.Length)) + \n  geom_violin(aes(fill = Species)) + \n  geom_jitter() +\n  scale_fill_manual(values = c('#fc8d59','#ffffbf','#99d594')) +\n  theme_bw()\n\n\n\n\n\n\n\n6.1.6 6. Coplot\n\n\n# Coplot con líneas de ajuste suavizado (loess)\nwith(datos, {\n  coplot(Efem~pH|temp,\n         panel = panel.smooth)})\n\n\n\n\n\n# Categorización de dos variables contínuas (pH y Temp)\nsummary(datos[,2:8])\n\n   cuenca        pH            temp            Efem            Plec     \n cuen1:5   Min.   :5.50   Min.   :15.00   Min.   : 2.00   Min.   :0.00  \n cuen2:5   1st Qu.:6.00   1st Qu.:15.95   1st Qu.: 6.00   1st Qu.:3.00  \n cuen3:5   Median :6.50   Median :17.05   Median :12.50   Median :4.00  \n cuen4:5   Mean   :6.48   Mean   :16.99   Mean   :13.75   Mean   :3.85  \n           3rd Qu.:7.00   3rd Qu.:17.88   3rd Qu.:19.00   3rd Qu.:5.00  \n           Max.   :7.50   Max.   :19.80   Max.   :28.00   Max.   :8.00  \n      Tric            Dipt      \n Min.   : 7.00   Min.   : 0.00  \n 1st Qu.:15.00   1st Qu.:12.00  \n Median :22.00   Median :24.50  \n Mean   :20.95   Mean   :22.15  \n 3rd Qu.:25.00   3rd Qu.:30.00  \n Max.   :37.00   Max.   :39.00  \n\nclasetemp <- cut(datos$temp,seq(15,20,1.2),include.lowest=T,\n                 labels = c(\"t.baja\", \"t.media1\",\"t.media2\", \"t.alta\"))\n\nclasepH <- cut(datos$pH,seq(5,8,1),include.lowest=T,\n               labels = c(\"pH.bajo\", \"pH.medio\",\"pH.alto\"))\n\n\n# Función para el coplot \npanel.lm = function(x, y, ...) {\n  tmp<-lm(y~x,na.action=na.omit)\n  abline(tmp, lwd = 1.5, col= 2)\n  points(x,y, ...)}\n\n\n# Relación trivariada - Lineal\ncoplot(Efem~pH | clasetemp, pch=19,\n       panel = panel.lm, data=datos)\n\n\n\ncoplot(Efem~pH | clasetemp, pch=19,\n       panel = panel.smooth, data=datos)\n\n\n\n\n\n\n\n6.1.7 7. Figuras con estadísticos (promedios, errores, …)\n\nEl Paquete ggplot2 es uno de los que permite realizar las opciones gráficas de barras con estadísticos, ingresar a este enlace:\nExploratory Data Analysis with ggplot\nExisten otros enlaces en los que se puede encontrar información complementaria para figuras de barras, como los siguientes\nggplot2 barplots\nStunning Bar Charts\n\n# Resumen estadístico \"datos_resum\"\ndatos_resum <- datos %>%        # Base de datos resumida\n  group_by(cuenca) %>%          # Factor o variable agrupadora\n  summarise(datos.m = mean(Ab),   # Media de cada grupo del factor\n            datos.de  = sd(Ab),   # Desviacioes estándar de cada grupo\n            datos.var = var(Ab),  # Varianzas de cada grupo\n            n.Ab = n(),           # Tamaño de cada grupo\n            datos.ee = sd(Ab)/sqrt(n()))   # Error estándar de cada grupo\ndatos_resum\n\n# A tibble: 4 × 6\n  cuenca datos.m datos.de datos.var  n.Ab datos.ee\n  <fct>    <dbl>    <dbl>     <dbl> <int>    <dbl>\n1 cuen1     62.6     6.58      43.3     5    2.94 \n2 cuen2     49.2     5.40      29.2     5    2.42 \n3 cuen3     73.8     1.30       1.7     5    0.583\n4 cuen4     88      10.1      102.      5    4.53 \n\n\n\n# Figura de promedios y errores estándar\nDatosPlot<-\n  ggplot(datos_resum, aes(cuenca, datos.m, dev.off())) + \n  geom_bar(stat=\"identity\", col=\"blue\", fill=\"lightblue\") +  \n  geom_errorbar(aes(ymin=datos.m-datos.ee, \n                    ymax=datos.m+datos.ee),width=0.2) \n\n\n# Imprimir la figura de promedios con errores estándar\nprint (DatosPlot + \n       labs(y=\"Abundancia ± e.e.\", \n            x = \"cuenca\") + \n        scale_fill_manual(values= c(\"#A1D5D5\")) +\n        theme_classic())\n\n\n\n\nNota: Para las figuras de Cajas y Bigotes, el comando stat_boxplot(geom = \"errorbar\",...) permite realizar gráficas sin necesidad de extraer algunos estadísticos previamente.\n\n# Opción de cajas y bigotes con errores estándar\nggplot(datos, aes(x=cuenca, y= Ab, fill= cuenca)) +\n  stat_boxplot(geom = \"errorbar\",width = 0.05) + \n  geom_boxplot(width = 0.4, \n        notchwidth = 0.9, outlier.colour=\"red\",\n        outlier.fill=\"red\",\n        outlier.size=3, outlier.alpha = 0.2) + \n  theme_classic() + \n  scale_fill_manual(values=c('#fc8d59','#ffffbf','#99d594','#377eb8')) + \n  labs(x = \"Cuencas\", y = \"Abundancia ± e.e.\")+ \n  scale_y_continuous(limits = c(40,90))\n\n\n\n\n\n\n6.1.7.1 Base de datos con múltiples factores\n\n\n# Base de datos multifactorial (insectos1)\ndatos1<-read_csv2(\"Insectos2.csv\")    # Formato *xlsx\nhead(datos1)  # Encabezado\n\n# A tibble: 6 × 6\n     No Muestreo GF    Lluvia    Ab  Biom\n  <dbl> <chr>    <chr> <chr>  <dbl> <dbl>\n1     1 M1       C-F   P1        98 56.0 \n2     2 M2       C-F   P1       198 52.7 \n3     3 M3       C-F   P2        45 11.4 \n4     4 M4       C-F   P2        51 25.3 \n5     5 M5       C-F   P2         3  0.36\n6     6 M6       C-F   P2        69 23.6 \n\n\n\n# Resumen estadístico \"datos_resum\"\ndatos_resum <- datos1 %>%        # Base de datos resumida\n  group_by(Lluvia,GF) %>%          # Factor o variable agrupadora\n  summarise(datos.m = mean(Biom),   # Media de cada grupo del factor\n            datos.de  = sd(Biom),   # Desviacioes estándar de cada grupo\n            datos.var = var(Biom),  # Varianzas de cada grupo\n            n.Biom = n(),           # Tamaño de cada grupo\n            datos.ee = sd(Biom)/sqrt(n()))   # Error estándar de cada grupo\ndatos_resum\n\n# A tibble: 10 × 7\n# Groups:   Lluvia [2]\n   Lluvia GF    datos.m datos.de datos.var n.Biom datos.ee\n   <chr>  <chr>   <dbl>    <dbl>     <dbl>  <int>    <dbl>\n 1 P1     C-F      37.0     30.0      902.      3    17.3 \n 2 P1     C-R      31.7     32.1     1029.      3    18.5 \n 3 P1     D       361.     120.     14411.      3    69.3 \n 4 P1     R        53.5     69.8     4873.      3    40.3 \n 5 P1     T       190.     296.     87533.      3   171.  \n 6 P2     C-F      14.4     10.2      105.      5     4.58\n 7 P2     C-R      88.5    115.     13273.      5    51.5 \n 8 P2     D       176.      94.9     9010.      5    42.4 \n 9 P2     R        21.9     12.9      165.      5     5.75\n10 P2     T       151.     223.     49655.      5    99.7 \n\n\n\n# Figura 1 (f1)\nf1 = ggplot(datos_resum, aes(x=GF, y=datos.m, fill=Lluvia)) + \n     geom_bar(stat=\"identity\", color=\"black\", \n              position=position_dodge()) +\n     geom_errorbar(aes(ymin=datos.m, ymax=datos.m+datos.de), width=.2,\n              position=position_dodge(.9)) \n\n# f2: Otro formato de figura bifactorial - theme_classic\nf2 = f1+labs(title=\"Biomasa por GF\", \n             x=\"Grupos Funcionales - GF\", \n             y = \"Biomasa\")+\n     theme_classic() +\n     scale_fill_manual(values=c('#E69F00','#999999'))\n\n# Impresión de un panel con las dos figuras (p1 y p2)\ngrid.arrange (f1, f2, ncol=2)\n\n\n\n\n\n# Inserción de las figuras en columna (figuras p1 y p2)\nf3 <- ggplotGrob(f1)\nf4 <- ggplotGrob(f2)\ng <- rbind(f3, f4, size=\"first\")\ng$widths <- unit.pmax(f3$widths, f4$widths)\ngrid.newpage()\ngrid.draw(g)\n\n\n\n\n\n\n\n6.1.7.2 parentesis Figuras de dispersión animadas\n\nEnlace\n\nlibrary(ggplot2)\nlibrary(gganimate)\ntheme_set(theme_bw())   # Tema o fondo de la figura por default\n\n\n# Demo\nlibrary(gapminder)\n\np <- ggplot(\n  gapminder, \n  aes(x = gdpPercap, y=lifeExp, size = pop, colour = country)\n  ) +\n  geom_point(show.legend = FALSE, alpha = 0.7) +\n  scale_color_viridis_d() +\n  scale_size(range = c(2, 12)) +\n  scale_x_log10() +\n  labs(x = \"GDP per capita\", y = \"Life expectancy\")\np\n\n\n\np + transition_time(year) +\n  labs(title = \"Year: {frame_time}\")\n\nNULL"
  },
  {
    "objectID": "Exploratorios.html#taller-de-entrenamiento",
    "href": "Exploratorios.html#taller-de-entrenamiento",
    "title": "6  Taller 3. Exploración Univariada y Multivariada",
    "section": "6.2 Taller de entrenamiento",
    "text": "6.2 Taller de entrenamiento\n\nObjetivo: Poner en práctica los conceptos vistos en el módulo de exploratorios multivariados, realizando las siguientes opciones gráficas en las bases de datos asignadas para los estdios de caso:\n\nFiguras de elipses\nFiguras de Dispersión por pares de variables (pairs)\nHistogramas\nDispersión X-Y\nCajas y Bigotes\nCoplot\nFiguras con estadísticos (promedios, errores, …)"
  },
  {
    "objectID": "Ordenación_pca1.html",
    "href": "Ordenación_pca1.html",
    "title": "7  Taller 4.1 Análisis de Componentes Principales - PCA",
    "section": "",
    "text": "El siguiente ejemplo relaciona a 7 lugares en playas de de Santa Marta (observaciones) y en cada una de ellas se midieron 7 variables ambientales (descriptores). En este análisis de comonentes principales - PCA, se intenta saber cuál es la relación entre variables ambientales y cómo estas estructuran o caracterizan a las localidades estudiadas. La base de datos a trabajar es FQmarino.csv.\nEjercicio tomado de: Rodríguez-Barrios (2023) Enlace del libro\nEnlace de los archivos del libro\n\nSigatoka en cultivos de banano - Aguirre et al. (2015). Análisis de componentes principales con el paquete “dudipca” y algunas técnicas multivariadas complementarias.\nMétodos de componentes principales en R - STHDA\nArtículos - Métodos de componentes principales - STHDA\nPCA en factoextra - datanovia\nGuía práctica sonre el PCA - datanovia\nPCA para variables categóricas - R-bloggers\nCapítulo PCA - Libro Numerical Ecology with R - Borcard et al. 2018\n\n\n# LIBRERÍAS REQUERIDAS\nlibrary(factoextra)   # Para el PCA\nlibrary(rlang)        # \nlibrary(FactoMineR)   # Para el PCA\nlibrary(vegan)        # Para el PCA\nlibrary(ade4)         # Para el PCA\nlibrary(corrplot)     # Figuras de elipses\nlibrary(ggplot2)      # Figuras de dispersión\n\n\n# Lectura de la base de datos \"FQmarino\"\ndatos <-read.csv2(\"FQmarino.csv\",row.names=1) # file.choose()\nView(datos)\nstr(datos)\n\n'data.frame':   7 obs. of  8 variables:\n $ Sitio     : chr  \"S1\" \"S1\" \"S1\" \"S1\" ...\n $ pH        : num  8.42 8.49 8.51 8.56 8.61 ...\n $ Cond      : num  38 38.1 37.8 37.3 37.3 ...\n $ Turbidez  : num  1.364 0.545 1.273 1.273 0.636 ...\n $ Temp      : num  29.5 29.5 29.6 29.3 29.3 ...\n $ Salinidad : num  2.42 2.43 2.42 2.38 2.38 ...\n $ CapaFotica: num  19.7 22.1 22.1 10.8 9 ...\n $ Oxigeno   : num  0.097 0.147 0.331 0.17 0.098 0.098 0.098\n\n\n\n\n8 Exploración Gráfica\n\n\n# Elipses con colores\nM <- cor(datos[,2:8])            # Matriz de Correlación (M)\nround(head(M),2)\n\n              pH  Cond Turbidez  Temp Salinidad CapaFotica Oxigeno\npH          1.00 -0.27    -0.04 -0.68      0.37      -0.77   -0.38\nCond       -0.27  1.00     0.21  0.68     -0.19       0.61    0.12\nTurbidez   -0.04  0.21     1.00  0.03     -0.16       0.01    0.26\nTemp       -0.68  0.68     0.03  1.00     -0.03       0.97    0.59\nSalinidad   0.37 -0.19    -0.16 -0.03      1.00       0.02   -0.15\nCapaFotica -0.77  0.61     0.01  0.97      0.02       1.00    0.56\n\n\nLa Figura 9.1 muestra la relación entre las variables, a partir de figuras de elipses.\n\nx11()                            # Panel gráfico adicional\ncorrplot(M, method = \"ellipse\")  # Figura de correlaciones con elipses\n\n\n\n\nFigura 8.1: Relación de variables ambientales en las siete bahías estudiadas.\n\n\n\n\nLa Figura 10.1 muestra la relación entre las variables, a partir de figuras de elipses y coeficientes de correlación de Pearson.\n\nX11()\ncorrplot.mixed(M, upper=\"ellipse\")  # Figura con coeficientes de correlación\n\n\n\n\nFigura 8.2: Relación de variables ambientales en las siete bahías estudiadas.\n\n\n\n\nLa Figura 11.1 otra forma de mostrar la relación entre las variables, a partir de figuras de elipses y coeficientes de correlación de Pearson.\n\nx11()\ncorrplot(M,  method = \"circle\",            # Correlaciones con circulos\n         type = \"lower\", insig=\"blank\",    # Forma del panel\n         order = \"AOE\", diag = FALSE,      # Ordenar por nivel de correlación\n         addCoef.col =\"black\",             # Color de los coeficientes\n         number.cex = 0.8,                 # Tamaño del texto\n         col = COL2(\"RdYlBu\", 200))        # Transparencia de los circulos\n\n\n\n\nFigura 8.3: Relación de variables ambientales en las siete bahías estudiadas.\n\n\n\n\n\n\n\n9 1) PCA con el paquete stats (pca1)\n\n\npca1 <- princomp(datos[,2:8],cor=TRUE)\n\n\n1.1) Valores propios - autovalores para medir el ajuste del PCA \n\nsummary(pca1)\n\nImportance of components:\n                          Comp.1    Comp.2    Comp.3    Comp.4     Comp.5\nStandard deviation     1.8454563 1.1063340 0.9919952 0.9474050 0.68078731\nProportion of Variance 0.4865298 0.1748536 0.1405792 0.1282252 0.06621019\nCumulative Proportion  0.4865298 0.6613834 0.8019626 0.9301878 0.99639798\n                            Comp.6 Comp.7\nStandard deviation     0.158789715      0\nProportion of Variance 0.003602025      0\nCumulative Proportion  1.000000000      1\n\n\n\n1.2) Insumos del pca (names) \n\nnames(pca1)\n\n[1] \"sdev\"     \"loadings\" \"center\"   \"scale\"    \"n.obs\"    \"scores\"   \"call\"    \n\n\n\n1.3) Valores propios - autovectores y escores \n\nround(pca1$loadings,2)   # Autoectores (loadings)\n\n\nLoadings:\n           Comp.1 Comp.2 Comp.3 Comp.4 Comp.5 Comp.6 Comp.7\npH          0.43          0.42   0.18   0.61   0.20   0.45 \nCond       -0.36          0.16   0.74   0.27  -0.35  -0.32 \nTurbidez          -0.65   0.62         -0.41   0.11        \nTemp       -0.52   0.21                        0.81  -0.10 \nSalinidad   0.13   0.67   0.60  -0.11  -0.29  -0.13  -0.26 \nCapaFotica -0.52   0.25                -0.13  -0.29   0.75 \nOxigeno    -0.35  -0.15   0.24  -0.63   0.53  -0.25  -0.22 \n\n               Comp.1 Comp.2 Comp.3 Comp.4 Comp.5 Comp.6 Comp.7\nSS loadings     1.003  1.006  1.010  0.992  1.003  0.994  1.002\nProportion Var  0.143  0.144  0.144  0.142  0.143  0.142  0.143\nCumulative Var  0.143  0.287  0.431  0.573  0.716  0.858  1.001\n\nround(pca1$scores,2)     # Coordenadas de las localidades (Scores)\n\n      Comp.1 Comp.2 Comp.3 Comp.4 Comp.5 Comp.6 Comp.7\nBTag   -1.55  -0.34   0.14   0.85  -1.34   0.11      0\nPBet   -1.80   1.54  -0.97   0.67   0.36  -0.19      0\nMono   -2.77  -0.36   0.84  -1.20   0.63   0.11      0\nGran    0.93  -1.34  -0.27  -0.96  -0.41  -0.27      0\nPGran   1.67   0.05  -1.70  -0.52   0.16   0.22      0\nRod     1.19  -1.20   0.58   1.53   0.82   0.01      0\nAero    2.33   1.64   1.38  -0.36  -0.22   0.01      0\n\n\n\n1.4) Contribución de los ejes del pca \nLa Figura 11.2 muestra la manera de graficar a la varinza que captura cada componente principal.\n\nx11()\nscreeplot(pca1,ylab=\"Varianza\",main=\"\",\n          cex.lab=1.5, col=\"lightblue\")\n\n\n\n\nFigura 9.1: Varianza capturada o representada por cada componente principal.\n\n\n\n\n\n1.5) Opciones de biplot, por combinaciones de ejes. \nLa Figura 11.3 muestra la ordenación de las locaidades y las variables ambientales en las 7 bahías evaluadas (gráfico de biplot).\n\nbiplot(pca1,choices = 1:2, cex=0.9)\nabline(v=0,lty=2, col=4)\nabline(h=0,lty=2, col=4)\n\n\n\n\nFigura 9.2: Figura del “Biplot” del análisis de componentes principales.\n\n\n\n\n\n# Otras opciones de pca por combinaciones de ejes\nbiplot(pca1,choices = 2:3, cex=0.9)\nbiplot(pca1,choices = c(1,3), cex=0.9)\n\n\n\n\n10 2) PCA con el paquete FactoMiner\n\n\n2.1) Inserción de las variables al PCA \n\n# Insertar las variables al PCA\nnames(datos)\n\n[1] \"Sitio\"      \"pH\"         \"Cond\"       \"Turbidez\"   \"Temp\"      \n[6] \"Salinidad\"  \"CapaFotica\" \"Oxigeno\"   \n\ndatos.PCA<-datos[, c(\"pH\", \"Cond\", \"Turbidez\", \"Temp\", \"Salinidad\",\n                     \"CapaFotica\", \"Oxigeno\")]\n\n\n2.1) PCA con escalamiento de las variables (similar a la matriz de correlación) \n\n# Realización del pca con la librería FactoMiner           \npca2<-PCA(datos.PCA , scale.unit=TRUE, ncp=5, graph = FALSE)\n\n\n2.2) Figura del PCA \nLa Figura 12.1 muestra la ordenación de las locaidades en las 7 bahías evaluadas (gráfico de biplot).\n\n# Figura del pca realizado (grafica de observaciones)\nplot.PCA(pca2, axes=c(1, 2), choix=\"ind\", habillage=\"none\", col.ind=\"black\", \n         col.ind.sup=\"blue\", col.quali=\"magenta\", \n         label=c(\"ind\", \"ind.sup\", \"quali\"))\n\n\n\n\nFigura 10.1: Figura del “Plot” del análisis de componentes principales.\n\n\n\n\n\n2.3) Circulo de contribuciones de las variables \nLa Figura 12.2 muestra el circulo de contribuciones para identificar a las variables con mayor aporte por cada componente principal del análisis.\n\n# Circulo de contribuciones\nplot.PCA(pca2, axes=c(1, 2), choix=\"var\", col.var=\"#ff0000\", new.plot=T,\n         col.quanti.sup=\"blue\", label=c(\"var\", \"quanti.sup\"), lim.cos2.var=0)\n\n\n\n\nFigura 10.2: Figura del circuo de contribuciones del PCA.\n\n\n\n\n\n2.4) Selección de variables a partir del PCA \n\n# Variables con mayor aporte al PC1\ndimdesc=dimdesc(pca2, axes=1:2)\nround(dimdesc$Dim.1$quanti,4)\n\n           correlation p.value\nTemp            0.9594  0.0006\nCapaFotica      0.9564  0.0007\npH             -0.7899  0.0346\n\n\n\n\n\n11 3) PCA con el paquete vegan\n\n\n# Realización del pca\npca3 <- rda(datos[,c(2:8)], scale = TRUE) \n\n\n3.1) Insumos del análisis \n\n# Insumos del pca\nsummary(pca3)\n\n\nCall:\nrda(X = datos[, c(2:8)], scale = TRUE) \n\nPartitioning of correlations:\n              Inertia Proportion\nTotal               7          1\nUnconstrained       7          1\n\nEigenvalues, and their contribution to the correlations \n\nImportance of components:\n                         PC1    PC2    PC3    PC4     PC5      PC6\nEigenvalue            3.4057 1.2240 0.9841 0.8976 0.46347 0.025214\nProportion Explained  0.4865 0.1749 0.1406 0.1282 0.06621 0.003602\nCumulative Proportion 0.4865 0.6614 0.8020 0.9302 0.99640 1.000000\n\nScaling 2 for species and site scores\n* Species are scaled proportional to eigenvalues\n* Sites are unscaled: weighted dispersion equal on all dimensions\n* General scaling constant of scores:  2.54573 \n\n\nSpecies scores\n\n               PC1      PC2      PC3      PC4      PC5      PC6\npH          0.7600 -0.05946 -0.39634  0.16779  0.39815 -0.03017\nCond       -0.6409  0.03919 -0.15521  0.67510  0.17577  0.05298\nTurbidez   -0.1626  0.69132 -0.59117  0.02172 -0.26687 -0.01640\nTemp       -0.9231 -0.21981 -0.06696  0.04433  0.05922 -0.12436\nSalinidad   0.2220 -0.71203 -0.56910 -0.09845 -0.18854  0.02044\nCapaFotica -0.9203 -0.26095 -0.03157 -0.01094 -0.08801  0.04456\nOxigeno    -0.6245  0.16367 -0.22590 -0.57864  0.34878  0.03860\n\n\nSite scores (weighted sums of species scores)\n\n          PC1      PC2     PC3     PC4     PC5      PC6\nBTag  -0.8103  0.29431 -0.1336  0.8605 -1.8923 -0.68752\nPBet  -0.9363 -1.34295  0.9378  0.6784  0.5141  1.12733\nMono  -1.4457  0.31382 -0.8173 -1.2159  0.8964 -0.64531\nGran   0.4866  1.16512  0.2621 -0.9789 -0.5863  1.60931\nPGran  0.8705 -0.04719  1.6534 -0.5317  0.2280 -1.31394\nRod    0.6186  1.04517 -0.5617  1.5570  1.1561 -0.05927\nAero   1.2166 -1.42828 -1.3407 -0.3694 -0.3161 -0.03060\n\n\n\n3.2) Autovalores \n\n# Ajuste del pca\nround((ev <- pca3$CA$eig),2)\n\n PC1  PC2  PC3  PC4  PC5  PC6 \n3.41 1.22 0.98 0.90 0.46 0.03 \n\n\n\n3.3) Figura del PCA \nLa Figura 12.3 muestra dos opciones de visualizar los resultados del pca “scaling 1” y “scaling 2”.\n\n# Panel con dos figuras del pca\nx11(12,6)\npar(mfrow=c(1,2))\nbiplot(pca3, scaling=1, main=\"PCA - scaling 1\")\nbiplot(pca3, main=\"PCA - scaling 2\") \n\n\n\n\nFigura 11.1: dos copciones de figuras del PCA - “scaling 1” y “scaling 2”.\n\n\n\n\n#— \n\n\n12 Taller en casa\n\nRealizar el cálculo del los siguientes insumos de la página 126 a 127, del libro Análisis de datos ecológicos y ambientales: Aplicaciones con el programa R el cual se encuentra en la biblioteca.\n\nAjuste de los componentes principales.\nFigura de atovalores\n\nFigura del modelo de Kaiser\n\n\nFigura del modelo de Vara Quebrada\n\n\n#—\n\n\n\n13 4) Análisis avanzado de PCA\n\n\n13.0.1 Combinación de clasificación y ordenación\nTomado de 5.3.2.6 Combining Clustering and Ordination Results del libro de Borcard et al. (2018), el cual se encuentra en la base de la Biblioteca de Unimagdalena.\n\n4.1) Generación de grupos con la distancia euclídea y el agrupamiento de Ward \n\nstr(datos)   # Identificación de las variables cuantitativas\n\n'data.frame':   7 obs. of  8 variables:\n $ Sitio     : chr  \"S1\" \"S1\" \"S1\" \"S1\" ...\n $ pH        : num  8.42 8.49 8.51 8.56 8.61 ...\n $ Cond      : num  38 38.1 37.8 37.3 37.3 ...\n $ Turbidez  : num  1.364 0.545 1.273 1.273 0.636 ...\n $ Temp      : num  29.5 29.5 29.6 29.3 29.3 ...\n $ Salinidad : num  2.42 2.43 2.42 2.38 2.38 ...\n $ CapaFotica: num  19.7 22.1 22.1 10.8 9 ...\n $ Oxigeno   : num  0.097 0.147 0.331 0.17 0.098 0.098 0.098\n\n# Generación de grupos\ndatos.w <- hclust(dist(scale(datos[,c(2:8)])), \"ward.D\")\n\n\n4.2) Cortar la clasificación en 2 grupos \n\ngr <- cutree(datos.w, k = 2)\ngrl <- levels(factor(gr))\n\n\n4.3) Base de datos con el factor agrupador \n\ndatos.gr=data.frame(gr,datos)       # Dataframe con la variable agrupadora (gr)\ndatos.gr$gr=as.factor(datos.gr$gr)  # crear los grupos como factor\n\n\n4.4) Extraer los escores de los sitios con el pca del paquete “vegan” \n\nsit.sc1 <- scores(pca3, display = \"wa\", scaling = 1)\n\n\n4.5) PCA con simbolos y colores por cada grupo \nLa Figura 13.1 muestra los dos grupos de bahías generados en el pca.\n\nx11()\npc4 <- plot(pca3,  display = \"wa\",  scaling = 1,  type = \"n\",\n          main = \"PCA correlation + clusters\")\nabline(v = 0, lty = \"dotted\")\nabline(h = 0, lty = \"dotted\")\n\nfor (i in 1:length(grl)) {\n  points(sit.sc1[gr == i, ],\n         pch = (14 + i),\n         cex = 2,\n         col = i + 1)\n}\n\n# Agregar los rótulos de los sitios\ntext(sit.sc1, row.names(datos), cex = 0.7, pos = 3)\n\n# Adicionar el dendograma al pca generado (uniones entre puntos)\nordicluster(pc4, datos.w, col = \"dark grey\")\n\n# Adicionar la leyenda de la figura (**Nota**: hacer clic en la figura)\nlegend(locator(1),\n       paste(\"Grupo\", c(1:length(grl))),\n       pch = 14 + c(1:length(grl)),\n       col = 1 + c(1:length(grl)),\n       pt.cex = 2)\n\n\n\n\nFigura 13.1: dos grupos de bahías generados en el PCA.\n\n\n\n\n\n\n\n\n14 5) PCA por tipos con la función “dudi.pca” del paquete ade4\n\n\npca5 <- dudi.pca(datos[,c(2:8)],scannf=F,nf=2,scale=T)\n\n\n5.1) Figuras del pca por tipo de grupo \nLa Figura 13.2 muestra el agrupamiento por elipses en el pca.\n\ns.class(pca5$li,datos.gr$gr, cpoi = 2)\n\n\n\n\nFigura 14.1: agrupamiento por elipses en el PCA.\n\n\n\n\nLa Figura 14.2 muestra el agrupamiento por líneas en el pca.\n\ns.class(pca5$li,datos.gr$gr, cell = 0, cstar = 0.5)\n\n\n\n\nFigura 14.2: agrupamiento por líneas en el PCA.\n\n\n\n\nLa Figura 14.3 muestra el agrupamiento por triangulos en el pca.\n\ncoul <- c(\"red\",  \"blue\")\ns.chull(pca5$li,datos.gr$gr, cpoi = 1, col = coul)\n\n\n\n\nFigura 14.3: agrupamiento por triangulos en el PCA."
  },
  {
    "objectID": "Ordenación_pca2.html",
    "href": "Ordenación_pca2.html",
    "title": "8  Taller 4.2 Análisis de Componentes Principales - PCA",
    "section": "",
    "text": "La Figura 9.1 muestra la relación entre las variables, a partir de figuras de elipses.\nLa Figura 10.1 muestra la relación entre las variables, con las transformaciones realizadas.\nRealización pca de los paquetes factoextra y ggbiplot Para gererar las coordenadas de los sitios y taxones"
  },
  {
    "objectID": "Ordenación_pca2.html#taller-de-entrenamiento",
    "href": "Ordenación_pca2.html#taller-de-entrenamiento",
    "title": "8  Taller 4.2 Análisis de Componentes Principales - PCA",
    "section": "13.1 Taller de entrenamiento",
    "text": "13.1 Taller de entrenamiento\n\nObjetivo: Poner en práctica los conceptos vistos en este taller, realizando las siguientes opciones realizando un PCA que integgre a las variables biológicas (taxones) y a las ambientalñes de la base seleccionada. Enviar los resultados al Teams del profesor."
  },
  {
    "objectID": "Ordenación_nmds.html",
    "href": "Ordenación_nmds.html",
    "title": "9  Taller 5.1 Análisis de Escalamiento Multidimensional no Métrico - NMDS",
    "section": "",
    "text": "Objetivo de la actividad:\n\nLa siguiente base de datos, corresponde a una muestra de 50 especies de malezas asociadas a cultivos de banano en cuatro localidades del Departamento del Magdalena (Regiones Alta, Norte, Media y Baja), basado en la composición y abundancia de estas especies vegetales. Estos datos fueron tomados del estudio realizado por Quintero-Pertuz et al., 2020) y solo representan a una parte de los taxones registrados (en total fueron 202 especies). Se utilizará el siguiente archivo como base de datos: maezas.csv\nEjercicio tomado de: Rodríguez-Barrios (2023) Enlace del libro\nEnlace de los archivos del libro\n\n\n9.0.1 Referencias bibliográficas de apoyo.\n\n[Perifiton de un río de Montaña - Osorio et al. 2014](https://www.scielo.sa.cr/scielo.php?script=sci_arttext&pid=S0034-77442011000400009#:~:text=Los%20GFA%20considerados%20en%20este,t%C3%A1xones%20neotropicales%20(Tomanova%20et%20al.) Valoración del proceso sucesional de microalgas perifíticas el tramo medio del río Gaira - Santa Marta.\nInvertebrados de un río de Montaña - Rodríguez-Barrios et al. 2011 Estudio de diferentes atributos comunitarios en invertebados acuáticos del río Gaira - Santa Marta.\nDescomposición de Hojarásca en Ríos - Eyes et al. 2011 Trabajo realizado en el bosque de ribera del río Gaira - Santa Marta.\nNutrientes de la hojarásca - Fuentes y Rodríguez. 2011 Otro trabajo realizado en el bosque de ribera del río Gaira - Santa Marta.\nAnálisis de Volnerabilidad a Inundaciones - Noriega et al. 2011 Valoración de riesgo a inundaciones en la parte baja del río Gaira - Santa Marta.\n\n\n\n9.0.2 Procedimiento de la exploración\n\n\nCargar librerías requeridas\nCargar la base malezas.csv\nCorrer el NMDS con una distancia binaria (Jaccard)\nRealizar las opciones gráficas con las librerías \"vegan\" y \"ggplot2\".\n\n\n\n9.0.2.1 Cargar las librerías requeridas\n\n\n# Librerías requeridas\nlibrary (ade4)\nrequire(vegan)\nlibrary(analogue)\nlibrary(magrittr)\nlibrary(dplyr)\nlibrary(ggpubr)\nlibrary(vegan)\nlibrary(ggplot2)\nlibrary(ggrepel)\n\n\n\n\n9.0.2.2 Cargar o importar la base de datos\n\n\n# Base de datos\ndatos<-read.csv2(\"malezas.csv\",row.names=1)  \n\n\n\n\n\n9.0.3 1) Ordenación de las localidades y las especies de malezas.\n\nSe prsenta un estrés de 0.13 (13%) con la distancia binaria de Jaccard.\n\n# 1. 1) Ordenación con el nmds\ndatos.nmds <- metaMDS(datos[,3:52],trace = FALSE,distance = \"jaccard\")\ndatos.nmds\n\n\nCall:\nmetaMDS(comm = datos[, 3:52], distance = \"jaccard\", trace = FALSE) \n\nglobal Multidimensional Scaling using monoMDS\n\nData:     datos[, 3:52] \nDistance: jaccard \n\nDimensions: 2 \nStress:     0.1362424 \nStress type 1, weak ties\nBest solution was repeated 3 times in 20 tries\nThe best solution was from try 13 (random start)\nScaling: centring, PC rotation, halfchange scaling \nSpecies: expanded scores based on 'datos[, 3:52]' \n\n\n\n\n\n9.0.4 2) Figuras del nmds con el paquete “vegan”\n\n9.0.4.1 2.1 nMDS con solapamiento de taxones\n\nLa figura muestra la ordenación de las especies de malezas con las localidades evaluadas. Muchas de las especies quedan solapadas enn la figura, en la siguiente figura se aplicará un comando para eliminar el solapamiento.\n\nx11()\nfig=plot(datos.nmds, type = \"t\",display = c(\"n\", \"species\"),\n         ylab=\"Dim 2\", xlab=\"Dim 1\", cex=0.7,shrink = FALSE)\n# Texto\ntext(datos.nmds, display=\"sites\", labels = as.character(datos$Finca), \n     cex=0.7, col=\"blue\", lwd=1.5, pos=3)\n# Puntos *opcionales\npoints(datos.nmds, display = \"sites\",cex = 0.8, \n       col = \"lightblue\", lwd=1.5)\n# plano cartesiano\nabline(h=0,lty=2)\nabline(v=0,lty=2)\n\n\n\n\n\n\n\n9.0.4.2 2.2 Ordenación con el comando “orditorp”\n\nLa figura elimina el solapamiento de las especies con el comando orditorp. Las especies de malezas son graficadas en rojo y las fincas en color azul.\n\nx11()\nfig=plot(datos.nmds, type = \"n\",display = c(\"n\", \"species\"),\n         ylab=\"Dim 2\", xlab=\"Dim 1\", ex=0.7,shrink = FALSE)\n#\ntext(datos.nmds, display=\"sites\", labels = as.character(datos$Finca), \n     cex=0.7, col=\"blue\", lwd=1.5, pos=3)\n#\nordi=orditorp(datos.nmds, display = \"species\", \n              shrink = FALSE, col = \"red\", type=\"n\") \n#\npoints(datos.nmds, display = \"sites\",cex = 0.7, \n       col = \"lightblue\", lwd=1.5)\nabline(h=0,lty=2)\nabline(v=0,lty=2)\n\n\n\n\n\n\n\n\n9.0.5 3) NMDS con paquete ggplot2\n\nA continuación se utilizarán las coordenadas de las regiones, las fincas y las especies de malazas, para graficarlas con el paquete ggplot2, debido a que muestra unas imágenes más didácticas y compactas. El siguiente comando - names(datos.nmds), permite visualizar los insumos del escalamiento multidimensional realizado.\n\n# Correr nuevamente el nMDS\nnames(datos.nmds)\n\n [1] \"nobj\"       \"nfix\"       \"ndim\"       \"ndis\"       \"ngrp\"      \n [6] \"diss\"       \"iidx\"       \"jidx\"       \"xinit\"      \"istart\"    \n[11] \"isform\"     \"ities\"      \"iregn\"      \"iscal\"      \"maxits\"    \n[16] \"sratmx\"     \"strmin\"     \"sfgrmn\"     \"dist\"       \"dhat\"      \n[21] \"points\"     \"stress\"     \"grstress\"   \"iters\"      \"icause\"    \n[26] \"call\"       \"model\"      \"distmethod\" \"distcall\"   \"data\"      \n[31] \"distance\"   \"converged\"  \"tries\"      \"bestry\"     \"engine\"    \n[36] \"species\"   \n\n\n\n\n9.0.5.1 3.1 Coordenadas de los sitios y el factor “coord.sit”\n\nCon el siguiente comando - datos.nmds$points, se extraen las coordenadas de los sitios y con el comando datos$Región se obtienen la columna del factor región.\n\n# 1) Coordenadas de los sitios y el factor (coord.sit)\ncoord.sit <- as.data.frame(datos.nmds$points)   # Coordenadas de los sitios\ncoord.sit$sitio <- rownames(coord.sit)          # Crear una columna con nombres de los sitios\ncoord.sit$grp <- datos$Región                   # Adicionar columna de grupos por región\nhead(coord.sit)                                 # vista resumida de las coordenadas de stios\n\n            MDS1       MDS2 sitio  grp\nACa -0.368866122 -0.2302102   ACa Alta\nACr  0.400345490 -0.1960911   ACr Alta\nALa -0.583055823  0.3700309   ALa Alta\nBBu  0.885282966  0.1463719   BBu Baja\nBLa -0.094239871  0.2144740   BLa Baja\nBMa  0.001409622  0.5159340   BMa Baja\n\n\n\n\n\n9.0.5.2 3.2 Coordenadas de los taxones “coord.tax”\n\nCon el comando datos.nmds$species, se extraen las coordenadas de las especies.\n\n# 2) Coordenadasde las especies (coord.tax) \ncoord.tax <- as.data.frame(datos.nmds$species)  # Dos primeros ejes\ncoord.tax$especies <- rownames(coord.tax)       # Insertar columna con nombres de las especies\nhead(coord.tax) \n\n              MDS1       MDS2 especies\nAcal  -0.267756205  0.1591907     Acal\nAchas -0.226794822  0.3661172    Achas\nAcsc   0.006697392  0.8749412     Acsc\nAdein  0.629900841 -0.3485990    Adein\nAdite -0.099404568 -0.1925386    Adite\nAlal  -0.016471756 -0.5190507     Alal\n\n\n\n\n\n9.0.5.3 3.3 Figura con de elipses\n\nLa siguiente figura presenta los comandos que se organizan por sitios, especies y el factor Región.\n\nx11()\nggplot() +\n# Sitios\n  geom_text_repel(data = coord.sit,aes(MDS1,MDS2,label = as.character(datos$Finca)),\n                  size=4)+   # Muestra el cuadro de la figura\n  geom_point(data = coord.sit,aes(MDS1,MDS2,colour=grp),size=4)+\n  scale_shape_manual(values = c(21:25))+\n\n# Especies  \n  geom_segment(data = coord.tax,aes(x = 0, y = 0, xend = MDS1, yend = MDS2), \n               arrow = arrow(angle=0,length = unit(0,\"cm\"),\n                             type = \"closed\"),linetype=0, size=0,colour = \"red\")+\n  geom_text_repel(data = coord.tax,aes(MDS1,MDS2,label=especies),colour = \"red\")+\n\n#Factor\n  geom_polygon(data=coord.sit,aes(x=MDS1,y=MDS2,fill=grp,group=grp),alpha=0.30) +\n  geom_hline(yintercept=0,linetype=3,size=1) + \n  geom_vline(xintercept=0,linetype=3,size=1)+\n  guides(shape=guide_legend(title=NULL,color=\"black\"),\n         fill=guide_legend(title=NULL))+\n  theme_bw()+theme(panel.grid=element_blank())\n\n\n\n\n\n\n\n\n9.0.6 Taller de entrenamiento\n\nObjetivo: Poner en práctica los conceptos vistos en este taller, realizando las siguientes opciones realizando un NMDS con las variables biológicas del estudio de caso (taxones). Enviar los resultados al Teams del profesor."
  },
  {
    "objectID": "Ordenación_mca.html",
    "href": "Ordenación_mca.html",
    "title": "10  Taller 6.1 Análisis de Correspondencias Múltiples - MCA",
    "section": "",
    "text": "Objetivo de la actividad:\n\nEl siguiente ejercicio analizará los datos de un proyecto de SEPEC (2021), basado en 100 registros tomados aleatoriamente de encuestas realizadas a pescadores y comercializadores de diferentes especies de bagres en Colombia.\nEl objetivo de este ejercicio consiste en valorar la relación entre las variables categóricas producto de las encuestas y la información relacionada a la comercialización de los bagres censados. Se utilizará el siguiente archivo como base de datos: bagres.xlsx\nEjercicio tomado de: Rodríguez-Barrios (2023) Enlace del libro\nEnlace de los archivos del libro\n\n\n10.0.1 Procedimiento de la exploración\n\nAnálisis de Correspondencia múltiple (MCA). A partir de la muestra de 100 registros de bagres y de variables cualitativas o categóricas obtenidas mediante las encuestas realizadas, se identifican los siguientes elementos de los datos seleccionados:\n• Individuos activos: Filas de la base de datos (100 registros de bagres).\n• Variables activas: Variables categóricas que se utilizarán en el primer mca, que corresponden a las categóricas que han sido encuestadas.\n• Variables cuantitativas suplementarias (quanti.sup): Son las variables cuantitativas que presenta la base de datos de bagres (venta en kg y precio de venta de los bagres).\n• Variables cualitativas suplementarias (quali.sup): corresponden a las que se requieran analizar por separado, en este caso serán los nombres vernaculares de los bagres. Las variables cuantitativas y cualitativas suplementarias serán evaluadas al final del ejercicio con un mca adicional.\nMás detalles de este procedimiento se pueden revisaar en el siguiente enlace: MCA - Multiple Correspondence Analysis in R\n\n\n10.0.1.1 Librerías requeridas\n\n\n# Librerías requeridas\nlibrary(tidyverse)\nlibrary(xtable)       # Importar y exportar\nlibrary(openxlsx)     # exportar \"*.xlsx\" \nlibrary(readxl)       # Importar y exportar\n\nlibrary(FactoMineR)   # Para realizar el MCA\nlibrary(factoextra)   # Para realizar el MCA\nlibrary(dplyr)        # Para pasar variables a factor\n\n\n\n\n10.0.1.2 Cargar o importar la base de datos\n\n\n# Base de datos\nbagres <- read_excel(\"bagres.xlsx\")    # paquete \"readxl\" \nhead(bagres) \nstr(bagres)\nView(bagres)\n\n\n\n\n\n10.0.2 1) Ajuste de la base de datos de bagres.\n\nPara la realización del primer mca, que solo incluirá a las variables activas (excluye a las suplementarias), se escogerán solo las variables categóricas requeridas para este análisis (columnas 1, 9 a la 22).\n\n# Base de variables activas\nbagres <- read_excel(\"bagres.xlsx\")    # paquete \"readxl\" \ndatos.activos = bagres[,c(1,9:22)]  # selección de columnas 1, 9 a 22 \nView(datos.activos)\n\nAl analizar la estructura de la base datos activos, a excepción de las columnas 4 y 5 (variables cuantitativas o cuantitativas suplementarias) Venta.kg y Precio.venta, el resto son de tipología caracter (chr) y se deben pasar a factores, para que el MCA pueda ejecutarse de forma apropiada. Es importante aclarar que las columnas 1 a la 4 no corresponden a variables activas, pero serán tabuladas en el siguiente data.frame.\n\n# Cambiar todas las variables cualitativas a factor\ndatos.activos <- datos.activos %>% \n                 mutate_all(factor)      # Pasar a factores excepto variables 5 y 6\nprint(head(datos.activos))\n\n# A tibble: 6 × 15\n  ...1   Import…¹ Origen Destino Tipo.…² Prove…³ Sit.c…⁴ Frec.…⁵ Trans…⁶ Conserv\n  <fct>  <fct>    <fct>  <fct>   <fct>   <fct>   <fct>   <fct>   <fct>   <fct>  \n1 1.Psdo Importa… Orige… Destin… Tipo.p… Provee… Sitio.… Frec.c… Transf… Conser…\n2 2.Psdo Importa… Orige… Destin… Tipo.p… Provee… Sitio.… Frec.c… Transf… Conser…\n3 3.Psdm Importa… Orige… Destin… Tipo.p… Provee… Sitio.… Frec.c… Transf… Conser…\n4 4.Psdp Importa… Orige… Destin… Tipo.p… Provee… Sitio.… Frec.c… Transf… Conser…\n5 5.Psdp Importa… Orige… Destin… Tipo.p… Provee… Sitio.… Frec.c… Transf… Conser…\n6 6.Psdm Importa… Orige… Destin… Tipo.p… Provee… Sitio.… Frec.c… Transf… Conser…\n# … with 5 more variables: Empaque <fct>, Transporte <fct>,\n#   Cliente.prim. <fct>, Cliente.sec. <fct>, Cliente.ter. <fct>, and\n#   abbreviated variable names ¹​Importado, ²​Tipo.prod, ³​Proveedor, ⁴​Sit.comp,\n#   ⁵​Frec.compra, ⁶​Transform\n\nView(datos.activos)\n\n\n\n\n10.0.3 2) Primera ordenación de las variables cualitativas activas (mca1).\n\nLas variables consideradas para esta ordenación, son las cualitativas (tipo factor) que pueden ejercer un efecto en la comercialización de los bagres.\n\n# 2) Ordenación de las variables acualitativas activas\n# Las columnas 5 a 18 son las requeridas por el mca\nstr(datos.activos)\n\ntibble [100 × 15] (S3: tbl_df/tbl/data.frame)\n $ ...1         : Factor w/ 100 levels \"1.Psdo\",\"10.Psdo\",..: 1 13 24 35 46 57 68 79 90 2 ...\n $ Importado    : Factor w/ 2 levels \"Importado.F\",..: 1 1 1 1 2 1 1 1 1 1 ...\n $ Origen       : Factor w/ 2 levels \"Origen.i\",\"Origen.n\": 2 2 2 2 1 2 2 2 2 2 ...\n $ Destino      : Factor w/ 2 levels \"Destino.c\",\"Destino.i\": 2 2 2 2 2 2 2 2 2 2 ...\n $ Tipo.prod    : Factor w/ 1 level \"Tipo.prod.p\": 1 1 1 1 1 1 1 1 1 1 ...\n $ Proveedor    : Factor w/ 3 levels \"Proveedor.i\",..: 1 1 1 1 3 1 1 1 1 1 ...\n $ Sit.comp     : Factor w/ 6 levels \"Sit.comp.c\",\"Sit.comp.o\",..: 3 3 3 3 6 3 3 3 4 4 ...\n $ Frec.compra  : Factor w/ 3 levels \"Frec.compra.d\",..: 3 3 1 3 3 3 3 3 3 3 ...\n $ Transform    : Factor w/ 3 levels \"Transform.c\",..: 2 2 2 1 2 1 2 1 1 1 ...\n $ Conserv      : Factor w/ 2 levels \"Conserv.c\",\"Conserv.sa\": 1 1 1 1 1 1 1 1 1 1 ...\n $ Empaque      : Factor w/ 3 levels \"Empaque.b\",\"Empaque.cc\",..: 1 1 1 1 3 1 1 1 1 1 ...\n $ Transporte   : Factor w/ 3 levels \"Transporte.m\",..: 3 3 2 3 3 3 3 2 3 3 ...\n $ Cliente.prim.: Factor w/ 3 levels \"Cliente.prim.c\",..: 1 3 1 1 3 1 1 1 1 1 ...\n $ Cliente.sec. : Factor w/ 5 levels \"Cliente.sec.c\",..: 2 2 2 4 3 4 2 2 2 2 ...\n $ Cliente.ter. : Factor w/ 5 levels \"Cliente.ter.c\",..: 3 4 3 3 3 3 4 3 3 3 ...\n\nView(datos.activos[,c(2:15)])\nmca1 <- MCA(datos.activos[,c(2:15)], graph = FALSE)\nsummary(mca1)\n\n\nCall:\nMCA(X = datos.activos[, c(2:15)], graph = FALSE) \n\n\nEigenvalues\n                       Dim.1   Dim.2   Dim.3   Dim.4   Dim.5   Dim.6   Dim.7\nVariance               0.391   0.197   0.172   0.161   0.139   0.111   0.105\n% of var.             18.874   9.525   8.307   7.768   6.700   5.348   5.073\nCumulative % of var.  18.874  28.399  36.706  44.474  51.174  56.522  61.596\n                       Dim.8   Dim.9  Dim.10  Dim.11  Dim.12  Dim.13  Dim.14\nVariance               0.102   0.091   0.087   0.077   0.068   0.062   0.052\n% of var.              4.928   4.404   4.197   3.712   3.291   3.000   2.504\nCumulative % of var.  66.523  70.928  75.125  78.837  82.128  85.128  87.632\n                      Dim.15  Dim.16  Dim.17  Dim.18  Dim.19  Dim.20  Dim.21\nVariance               0.046   0.040   0.037   0.029   0.025   0.020   0.018\n% of var.              2.243   1.937   1.774   1.381   1.223   0.958   0.850\nCumulative % of var.  89.875  91.812  93.585  94.966  96.189  97.147  97.997\n                      Dim.22  Dim.23  Dim.24  Dim.25  Dim.26  Dim.27  Dim.28\nVariance               0.015   0.009   0.008   0.005   0.003   0.001   0.000\n% of var.              0.728   0.453   0.395   0.251   0.148   0.027   0.000\nCumulative % of var.  98.726  99.179  99.574  99.825  99.973 100.000 100.000\n                      Dim.29\nVariance               0.000\n% of var.              0.000\nCumulative % of var. 100.000\n\nIndividuals (the 10 first)\n                Dim.1    ctr   cos2    Dim.2    ctr   cos2    Dim.3    ctr\n1            | -0.171  0.075  0.086 | -0.077  0.030  0.017 |  0.022  0.003\n2            | -0.066  0.011  0.004 | -0.427  0.925  0.180 |  0.265  0.407\n3            | -0.024  0.002  0.000 |  0.116  0.068  0.009 |  0.325  0.614\n4            | -0.342  0.299  0.220 | -0.037  0.007  0.003 | -0.305  0.542\n5            |  1.905  9.283  0.692 | -0.242  0.297  0.011 | -0.472  1.293\n6            | -0.342  0.299  0.220 | -0.037  0.007  0.003 | -0.305  0.542\n7            | -0.207  0.109  0.065 | -0.157  0.124  0.037 |  0.200  0.233\n8            | -0.300  0.230  0.090 | -0.046  0.011  0.002 |  0.053  0.016\n9            | -0.310  0.245  0.111 |  0.071  0.025  0.006 | -0.250  0.363\n10           | -0.310  0.245  0.111 |  0.071  0.025  0.006 | -0.250  0.363\n               cos2  \n1             0.001 |\n2             0.069 |\n3             0.073 |\n4             0.175 |\n5             0.042 |\n6             0.175 |\n7             0.061 |\n8             0.003 |\n9             0.072 |\n10            0.072 |\n\nCategories (the 10 first)\n                Dim.1    ctr   cos2 v.test    Dim.2    ctr   cos2 v.test  \nImportado.F  | -0.241  0.984  0.770 -8.730 | -0.013  0.005  0.002 -0.457 |\nImportado.v  |  3.198 13.079  0.770  8.730 |  0.167  0.071  0.002  0.457 |\nOrigen.i     |  3.198 13.079  0.770  8.730 |  0.167  0.071  0.002  0.457 |\nOrigen.n     | -0.241  0.984  0.770 -8.730 | -0.013  0.005  0.002 -0.457 |\nDestino.c    |  0.126  0.012  0.001  0.255 |  2.133  6.589  0.190  4.332 |\nDestino.i    | -0.005  0.000  0.001 -0.255 | -0.089  0.275  0.190 -4.332 |\nTipo.prod.p  |  0.000  0.000    NaN    NaN |  0.000  0.000    NaN    NaN |\nProveedor.i  | -0.250  1.018  0.506 -7.080 | -0.112  0.404  0.102 -3.170 |\nProveedor.o  | -0.571  0.179  0.010 -0.999 |  1.092  1.295  0.037  1.911 |\nProveedor.pa |  2.997 13.129  0.781  8.794 |  0.837  2.027  0.061  2.455 |\n              Dim.3    ctr   cos2 v.test  \nImportado.F   0.083  0.264  0.091  2.997 |\nImportado.v  -1.098  3.503  0.091 -2.997 |\nOrigen.i     -1.098  3.503  0.091 -2.997 |\nOrigen.n      0.083  0.264  0.091  2.997 |\nDestino.c     1.601  4.255  0.107  3.251 |\nDestino.i    -0.067  0.177  0.107 -3.251 |\nTipo.prod.p   0.000  0.000    Inf   -Inf |\nProveedor.i   0.015  0.008  0.002  0.412 |\nProveedor.o  -0.005  0.000  0.000 -0.009 |\nProveedor.pa -0.160  0.085  0.002 -0.470 |\n\nCategorical variables (eta2)\n               Dim.1 Dim.2 Dim.3  \nImportado    | 0.770 0.002 0.091 |\nOrigen       | 0.770 0.002 0.091 |\nDestino      | 0.001 0.190 0.107 |\nTipo.prod    | 0.000 0.000 0.000 |\nProveedor    | 0.784 0.103 0.002 |\nSit.comp     | 0.798 0.317 0.338 |\nFrec.compra  | 0.350 0.235 0.107 |\nTransform    | 0.303 0.249 0.181 |\nConserv      | 0.047 0.024 0.102 |\nEmpaque      | 0.494 0.321 0.398 |\n\n\nEl anterior insumo es importante, porque define el orcentaje de varianza que capturan los 29 ejes canónicos - Eigenvalues y selecciona a las 10 variables de mayor relevancia para el análisis de ordenación - mca Categories (the 10 first) en los tres primeros ejes canónicos - Categorical variables (eta2).\n\n\n10.0.3.1 2.1) Ajuste de la ordenación definida por los autovalores\n\nA continuación se calcula el componente tabular, para identificar la varianza que captira cada eje canónico o Dim.i, en donde i es cada uno de los ejes de la ordenación.\n\n# # Matriz de autovalores de los seis primeros ejes canónicos\nhead(mca1$eig)\n\n      eigenvalue percentage of variance cumulative percentage of variance\ndim 1  0.3909689              18.874360                          18.87436\ndim 2  0.1972939               9.524535                          28.39889\ndim 3  0.1720808               8.307348                          36.70624\ndim 4  0.1609039               7.767773                          44.47401\ndim 5  0.1387903               6.700220                          51.17423\ndim 6  0.1107851               5.348244                          56.52248\n\n\nEn la Figura 14.1, se grafican los resultados de la tabla anterior.\n\n# Figura de autovalores (para la escogencia de variables)\nx11()\nfviz_screeplot(mca1, addlabels = TRUE, ylim = c(0, 20),\n               ylab = \"% Varianza explicada\", xlab = \"Dimensiones\",\n               col=\"steelblue\")\n\n\n\n\nFigura 10.1: Varianza capturada por cada eje canónico\n\n\n\n\n\n\n\n10.0.3.2 2.2) Figuras generales del mca1\n\nLa Figura 14.2 muestra la relación de las 14 variables categoricas del análisis, el nivel de relación o cercanía es definido por la distancia chi cuadrado. fviz_mca_var representa a la grafica de variables, mca.cor muestra solo a las variables que más contribuyen a la ordenación, repel = TRUE permite visualizar los elementos sin solapamientos. ior.\n\n# Figura de relación de las variables categóricas\nx11()\nfviz_mca_var(mca1, choice = \"mca.cor\", repel = TRUE, \n             ggtheme = theme_minimal())\n\n\n\n\nFigura 10.2: Ordenación de las variables que más contribuyen al análisis\n\n\n\n\nLa Figura 14.3 muestra el biplot integrado por los 100 registros de peces y las variables categóricas que los caracterizan. fviz_mca_biplot permite visualizar a las observaciones o filas de la base de datos (números en azul) y a las variables con mayor contribución al análisis (en rojo).\n\n# Figura del Biplot de ordenación registros de peces y de variables\nx11()\nfviz_mca_biplot(mca1, choice = \"mca.cor\",repel = TRUE,         \n                ggtheme = theme_minimal())\n\n\n\n\nFigura 10.3: Ordenación de las variables que más contribuyen al análisis y de las observaciones (registros de peces)\n\n\n\n\nLa Figura 13.4 define a l00 registros de peces con todas las variables activas y sus categorías (no incluye al comando “mca.cor”).\n\n# Figura del Biplot de ordenación para registros de peces y categoricas de las variables\nx11()\nfviz_mca_biplot(mca1, repel = TRUE,       \n                ggtheme = theme_minimal())\n\n\n\n\nFigura 10.4: Ordenación de todas las variables activas y de las observaciones (registros de peces)\n\n\n\n\n\n\n\n10.0.3.3 2.3) Figuras del mca con ponderaciones\n\nA continuación se visualiza la ordenación de las observaciones (100 registros de peces) y su nivel de importancia (observaciones en rojo son las más importantes). fviz_mca_ind, permite visualizar a los individuos u observaciones (Figura 13.5).\n\n# Contribuciones de las observaciones (filas de la la base de bagres)\nx11()\nfviz_mca_ind(mca1, col.ind = \"cos2\", \n             gradient.cols = c(\"#00AFBB\", \"#E7B800\", \"#FC4E07\"),\n             repel = TRUE, \n             ggtheme = theme_minimal())\n\n\n\n\nFigura 10.5: Ordenación de las observaciones (registros de peces) y su nivel de contribución al análisis.\n\n\n\n\nEn la Figura 13.6 se muestra la ordenación de las variables activas y su nivel de contribución (variables en rojo son las más importantes).\n\n# Contribuciones de las variables categóricas (columnas de variables activas)\nx11()\nfviz_mca_var(mca1, col.var = \"cos2\",\n             gradient.cols = c(\"#00AFBB\", \"#E7B800\", \"#FC4E07\"), \n             repel = TRUE, ggtheme = theme_minimal())\n\n\n\n\nFigura 10.6: Ordenación de las variables activas y su nivel de contribución al análisis.\n\n\n\n\n\n\n\n\n10.0.4 3) Segunda ordenación de las variables cualitativas activas (mca2).\n\nA continuación se realiza un mca con dos elementos adicionales a a las variables activas ordenadas anteriormente:\n\nVariables cuantitativas suplementarias (quanti.sup), correspondientes a la venta en kilogramos y el precio de venta de los bagres.\nVariables cualitativas suplementarias (quali.sup), representadas por los nombres o tipos de bagres (columna: Nombre.vernacular)\n\nEsto con el objetivo de visualizar aspectos asociados a la comercialización de los bagres (variables cuantitativas y tipos de bagres), en respuesta a las variables categóricas producto de las encuestas (variables activas).\nPaso 1. Incluir los nombres de los bagres a la base “datos.activos” (datos.activos.2)\n\n# Pasar nombres de los bagres a factor\nbagres <- read_excel(\"bagres.xlsx\")    # paquete \"readxl\"\nbagres$Nombre.vernacular = as.factor(bagres$Nombre.vernacular)\n\n# Crear data frame con los nombres de los bagres y variables cuantitativas.\ndatos.activos.1 <- data.frame(bagres = bagres[,6], \n                              venta.kg = bagres[,7],\n                              Precio.venta = bagres[,8], \n                              datos.activos[,2:15])\nstr(datos.activos.1)\n\n'data.frame':   100 obs. of  17 variables:\n $ Nombre.vernacular: Factor w/ 4 levels \"B.Ray.o.Tigr\",..: 4 4 3 2 2 2 2 4 4 4 ...\n $ Venta.kg         : num  150 1000 150 50 2200 20 30 20 50 35 ...\n $ Precio.venta     : num  18000 14000 16000 19000 13000 24000 24000 22000 22000 18000 ...\n $ Importado        : Factor w/ 2 levels \"Importado.F\",..: 1 1 1 1 2 1 1 1 1 1 ...\n $ Origen           : Factor w/ 2 levels \"Origen.i\",\"Origen.n\": 2 2 2 2 1 2 2 2 2 2 ...\n $ Destino          : Factor w/ 2 levels \"Destino.c\",\"Destino.i\": 2 2 2 2 2 2 2 2 2 2 ...\n $ Tipo.prod        : Factor w/ 1 level \"Tipo.prod.p\": 1 1 1 1 1 1 1 1 1 1 ...\n $ Proveedor        : Factor w/ 3 levels \"Proveedor.i\",..: 1 1 1 1 3 1 1 1 1 1 ...\n $ Sit.comp         : Factor w/ 6 levels \"Sit.comp.c\",\"Sit.comp.o\",..: 3 3 3 3 6 3 3 3 4 4 ...\n $ Frec.compra      : Factor w/ 3 levels \"Frec.compra.d\",..: 3 3 1 3 3 3 3 3 3 3 ...\n $ Transform        : Factor w/ 3 levels \"Transform.c\",..: 2 2 2 1 2 1 2 1 1 1 ...\n $ Conserv          : Factor w/ 2 levels \"Conserv.c\",\"Conserv.sa\": 1 1 1 1 1 1 1 1 1 1 ...\n $ Empaque          : Factor w/ 3 levels \"Empaque.b\",\"Empaque.cc\",..: 1 1 1 1 3 1 1 1 1 1 ...\n $ Transporte       : Factor w/ 3 levels \"Transporte.m\",..: 3 3 2 3 3 3 3 2 3 3 ...\n $ Cliente.prim.    : Factor w/ 3 levels \"Cliente.prim.c\",..: 1 3 1 1 3 1 1 1 1 1 ...\n $ Cliente.sec.     : Factor w/ 5 levels \"Cliente.sec.c\",..: 2 2 2 4 3 4 2 2 2 2 ...\n $ Cliente.ter.     : Factor w/ 5 levels \"Cliente.ter.c\",..: 3 4 3 3 3 3 4 3 3 3 ...\n\n\nPaso 2. Nuevo mca, que incluye a las variables suplementarias (quali.sup y quanti.sup)\n\n# mca con nombres de los bagres (quali.sup) y variables cuantitativas (cuanti sub)\nmca2  <- MCA (datos.activos.1, \n              quali.sup = 1,            # Registros de peces (X)\n              quanti.sup = 2:3,         # 2 y 3 son Variables cuantitativas\n              graph=FALSE) \n\nPaso 3. Gráfica de las variables cuantitativas suplementarias (quanti.sup) (Figura 13.7).\n\n# Figura de las variables suplementarias (azul) y las activas (rojo)\nx11()\nfviz_mca_var(mca2, \n             choice = \"mca.cor\",    # Principales variables cualitativas\n             repel = TRUE)          # Quita el solapamiento de las variables.\n\n\n\n\nFigura 10.7: Ordenación de las variables activas y su nivel de contribución al análisis.\n\n\n\n\nPaso 4. Grafica de las variables cualitativas suplementarias (quali.sup) (Figura 12.8)\n\n# Figura de las variables suplementarias (verde), las activas (rojo) y los individuos (azul)\nx11()\nfviz_mca_biplot(mca2, repel = TRUE,\n                geom.ind = c(\"n\", \"n\"),    # No mostrar a los individuos\n                ggtheme = theme_bw())      # Puede usar temas de \"ggplot2\"    \n\n\n\n\nFigura 10.8: Ordenación de todas las variables activas que más contribuyen al análisis (rojo) y su relación co las variables cualitativas suplementarias (verde).\n\n\n\n\nLa Figura 12.9 muestra las elipses que representan a los intervalos de confianza de cada grupo de bagres, para medir el tipo de relación o de colapamiento entre estos, basado en las variables activas que los caracterizan.\n\n# Elipses por cada tipo de bagre\nx11()\nfviz_ellipses(mca2, \"Nombre.vernacular\",\n              geom = \"text\", repel = TRUE)\n\n\n\n\nFigura 10.9: Relación entre las especies de bagres y con sus observaciones (registros de peces).\n\n\n\n\n\n\n\n10.0.5 Taller de entrenamiento\n\nObjetivo: Poner en práctica los conceptos vistos en este taller, realizando las siguientes opciones realizando un MCA con las variables biológicas (taxones). Enviar los resultados al Teams del profesor."
  },
  {
    "objectID": "Ordenación_rda.html",
    "href": "Ordenación_rda.html",
    "title": "11  Taller 7.1 Análisis de Redundancia - RDA",
    "section": "",
    "text": "Objetivo de la actividad:\n\nLa siguiente base de datos es tomada del trabajo de (Osorio, 2021), relacionado a un estudio sobre la composición de microalgas de la ciénaga Sevillano en el complejo lagunar de la Ciénaga Grande de Santa Marta (Colombia). La información contiene a 21 géneros de microalgas (matriz Y) y 10 variables ambientales (matriz X) medidas en 24 observaciones (localidades y campañas de muestreo). El propósito del ejercicio consiste en determinar la relación entre la composición de las microalgas y las variables fisicoquímicas de su ambiente, aplicando un análisis de redundancia (RDA) y un Análisis de Correspondencia Canónica (ACC), para finalmente comparar la aplicación de cada técnica. Se utilizará el siguiente archivo: Microalgas.csv\nEjercicio tomado de: Rodríguez-Barrios (2023) Enlace del libro\nEnlace de los archivos del libro Revisar el capitulo de Análisis de Redundancia - RDA\nNumerical Ecology With R - Borcard et al. 2018 Capítulo de Análisis de Redundancia - RDA\n\n\n11.0.0.1 Procedimiento resumido de la ordenación con el RDA\n\n\nCargar librerías y funciones requeridas\nCargar la base Microalgas.csv\nRealizar los ajustes a las variables y factores\nCorrer el RDA con todas las variables\nCorrer el RDA con las variables ambientales seleccionadas\nFiguras de BIPLOT y TRIPLOT con librerías \"vegan\" y \"ggplot2\".\n\n\n\n\n11.0.0.2 Cargar las librerías requeridas\n\n\n# Librerías requeridas\nlibrary(ade4)\nlibrary(adegraphics)\nlibrary(adespatial)\nlibrary(cocorresp)\nlibrary(vegan)\nlibrary(MASS)\nlibrary(ellipse)\nlibrary(FactoMineR)\nlibrary(rrcov)\nlibrary(ggplot2)\nlibrary(reshape2)\nlibrary(ggrepel)\nlibrary(ggforce)\n\n\n\n\n11.0.0.3 Funciones adicionales (Bordcard et al. 2018)\n\n\n# Funciones a cargar\nsource(\"hcoplot.R\")\nsource(\"triplot.rda.R\")\nsource(\"plot.lda.R\")\nsource(\"polyvars.R\")\nsource(\"screestick.R\")\n\n\n\n\n11.0.0.4 Cargar o importar la base de datos\n\nEsta base de datos cuenta con una variable agrupadora o factor (Tributario), 10 variables ambientales y 21 taxones de microalgas.\n\n# Base de datos\ndatos = read.csv2(\"Microalgas.csv\",row.names=1)\n\n\n\n\n11.0.0.5 Ajuste de las bases de datos biológica (tax.hel) y Ambiental (amb)\n\nA continuación se realizará un ajuste de la base de datos, primero convirtiendo a la columna Tributario como un factor, luego transformando a las variables ambientales amb con logaritmo en base 10 y finalmente ajustando a los taxones tax.hel con la transformación de Hellinger. Las abreviaturas en las filas T1.1, ..., T1.6, ... Representan el número del tributario (T1) y el numero de la visita realizada al lugar de muestreo (1).\n\n# Ajuste de factores\ndatos$Tributario = as.factor (datos$Tributario)     \n# str(datos)    # Nueva estructura de la base de datos\n\n# Variables ambientales\namb=(datos[,c(2:11)]+1)\nround(head(amb),2)\n\n     Amonio Nitrito Nitrato Oxigeno    pH Conductividad Caudal Vel_Corriente\nT1.1   1.30    1.84    1.90    8.68  9.10            77   1.51          1.73\nT1.2   1.30    1.78    1.83    7.54  8.45            77   2.59          1.37\nT1.3   2.11    2.18    4.43    6.62  8.81            77   2.48          2.15\nT1.4   2.02    1.88    3.67    7.08 10.21            77   2.24          2.33\nT1.5   1.19    1.15    1.52    6.10 10.24            77   2.32          2.32\nT1.6   1.21    1.47    1.90    6.60 10.63            78   2.25          2.29\n     Luz Temp\nT1.1 801 18.6\nT1.2 401 19.3\nT1.3 301 18.1\nT1.4 101 19.6\nT1.5 801 18.9\nT1.6 201 18.8\n\n\nLos datos de abundancia de los taxones están en cifras decimales, debido a la transformación logarítmica que se les aplicó.\n\n# Variables biológicas linealizadas - Taxones con Hellinger\ntax.hel=decostand(datos[,c(12:32)],\"hellinger\")\nround(head(tax.hel),2)\n\n     Fragillaria Lyngbya Chamaepinnularia Achnantes Amphora Caloneis Closterium\nT1.1        0.00    0.62             0.10      0.00    0.15     0.00       0.23\nT1.2        0.10    0.49             0.07      0.00    0.12     0.00       0.22\nT1.3        0.34    0.16             0.20      0.00    0.00     0.00       0.18\nT1.4        0.31    0.21             0.23      0.05    0.07     0.14       0.11\nT1.5        0.28    0.14             0.22      0.08    0.10     0.12       0.09\nT1.6        0.25    0.18             0.19      0.09    0.11     0.19       0.06\n     Cocconeis Cymbella Eolimna Epithemia Eunotia Frustulia Girosigma\nT1.1      0.22        0    0.27      0.00    0.00      0.00      0.00\nT1.2      0.30        0    0.33      0.00    0.17      0.17      0.00\nT1.3      0.33        0    0.32      0.00    0.09      0.11      0.00\nT1.4      0.29        0    0.26      0.05    0.00      0.00      0.15\nT1.5      0.44        0    0.29      0.07    0.10      0.00      0.16\nT1.6      0.44        0    0.28      0.08    0.09      0.00      0.13\n     Gomphonema Melosira Navicula Nitzchia Planothidium Surilella Pinnularia\nT1.1       0.00     0.51     0.00     0.24         0.15      0.10       0.25\nT1.2       0.00     0.49     0.20     0.29         0.17      0.00       0.19\nT1.3       0.09     0.50     0.11     0.37         0.32      0.00       0.22\nT1.4       0.18     0.49     0.20     0.33         0.33      0.12       0.20\nT1.5       0.20     0.43     0.20     0.25         0.35      0.19       0.12\nT1.6       0.19     0.49     0.20     0.21         0.31      0.19       0.09\n\n\n\n\n\n11.0.1 Doce pasos para el análisis de redundancia - RDA.\n\n\n\n11.0.1.1 Paso 1. Ordenación de los taxones y las variables ambientales.\n\nEn el siguiente analisis se relaciona a la matriz de datos biológicos (abundancia de taxones) con la matriz de datos ambientales. A continuación se determinan los insumos generales del análisis.\n\n# 1. Realización del RDA\ntax.rda<-rda(tax.hel ~.,amb)\ntax.rda # Resultados resumidos\n\nCall: rda(formula = tax.hel ~ Amonio + Nitrito + Nitrato + Oxigeno + pH\n+ Conductividad + Caudal + Vel_Corriente + Luz + Temp, data = amb)\n\n              Inertia Proportion Rank\nTotal         0.14283    1.00000     \nConstrained   0.07804    0.54640   10\nUnconstrained 0.06479    0.45360   13\nInertia is variance \n\nEigenvalues for constrained axes:\n    RDA1     RDA2     RDA3     RDA4     RDA5     RDA6     RDA7     RDA8 \n0.028864 0.019400 0.009741 0.006291 0.004905 0.003407 0.002132 0.001938 \n    RDA9    RDA10 \n0.000927 0.000440 \n\nEigenvalues for unconstrained axes:\n     PC1      PC2      PC3      PC4      PC5      PC6      PC7      PC8 \n0.026487 0.015199 0.009607 0.004206 0.002286 0.002040 0.001779 0.001226 \n     PC9     PC10     PC11     PC12     PC13 \n0.000826 0.000485 0.000303 0.000258 0.000088 \n\n\nMatriz 1. Partición de la varianza. La inercia restringida es la que define el ajuste (restringida) en la relación entre las dos matrices de variables. Para este caso es de 0.54 (54%). Más adelante se aplicará el R2 de Ezequiel (1930), para encontrar el ajuste sin restricción (ajuste final del RDA). A continuación se muestra el comando para presentar los resultados detallados del RDA.\nMatriz 2. Importancia de los componentes. Muestra que se requiere de 10 ejes canónidos (RDA) para explicar el 54% de la varianza explicada por la inercia restringida. La inercia restante se explica por los ejes de los 12 componentes principales PC.\nMatriz 3. Species scores, muestra las coordenadas de las especies en los ejes canónicos, de los cuales se graficarán los dos primeros.\nMatriz 4. Site scores, Muestra las coordenadas de los sitios\nMatriz 5. Site constraints, muestra a las coordenadas de los sitos en el espacio de los taxones.\nMatriz 6. Biplot scores, muestra las coordenadas de las variables ambientales.\n\nsummary(tax.rda) # Resultados completos\n\n\nCall:\nrda(formula = tax.hel ~ Amonio + Nitrito + Nitrato + Oxigeno +      pH + Conductividad + Caudal + Vel_Corriente + Luz + Temp,      data = amb) \n\nPartitioning of variance:\n              Inertia Proportion\nTotal         0.14283     1.0000\nConstrained   0.07804     0.5464\nUnconstrained 0.06479     0.4536\n\nEigenvalues, and their contribution to the variance \n\nImportance of components:\n                         RDA1   RDA2     RDA3     RDA4     RDA5     RDA6\nEigenvalue            0.02886 0.0194 0.009741 0.006291 0.004905 0.003407\nProportion Explained  0.20208 0.1358 0.068195 0.044042 0.034342 0.023850\nCumulative Proportion 0.20208 0.3379 0.406096 0.450138 0.484481 0.508331\n                          RDA7     RDA8      RDA9     RDA10     PC1    PC2\nEigenvalue            0.002132 0.001938 0.0009267 0.0004403 0.02649 0.0152\nProportion Explained  0.014928 0.013566 0.0064878 0.0030829 0.18544 0.1064\nCumulative Proportion 0.523259 0.536825 0.5433124 0.5463953 0.73183 0.8382\n                           PC3      PC4      PC5     PC6      PC7      PC8\nEigenvalue            0.009607 0.004206 0.002286 0.00204 0.001779 0.001226\nProportion Explained  0.067262 0.029449 0.016001 0.01428 0.012454 0.008585\nCumulative Proportion 0.905501 0.934951 0.950952 0.96524 0.977690 0.986274\n                            PC9      PC10      PC11      PC12      PC13\nEigenvalue            0.0008263 0.0004854 0.0003026 0.0002579 8.835e-05\nProportion Explained  0.0057854 0.0033982 0.0021184 0.0018053 6.186e-04\nCumulative Proportion 0.9920595 0.9954577 0.9975762 0.9993814 1.000e+00\n\nAccumulated constrained eigenvalues\nImportance of components:\n                         RDA1   RDA2     RDA3     RDA4     RDA5     RDA6\nEigenvalue            0.02886 0.0194 0.009741 0.006291 0.004905 0.003407\nProportion Explained  0.36984 0.2486 0.124809 0.080605 0.062853 0.043650\nCumulative Proportion 0.36984 0.6184 0.743228 0.823833 0.886685 0.930335\n                          RDA7     RDA8      RDA9     RDA10\nEigenvalue            0.002132 0.001938 0.0009267 0.0004403\nProportion Explained  0.027321 0.024828 0.0118739 0.0056423\nCumulative Proportion 0.957656 0.982484 0.9943577 1.0000000\n\nScaling 2 for species and site scores\n* Species are scaled proportional to eigenvalues\n* Sites are unscaled: weighted dispersion equal on all dimensions\n* General scaling constant of scores:  1.346293 \n\n\nSpecies scores\n\n                     RDA1      RDA2      RDA3       RDA4      RDA5       RDA6\nFragillaria       0.13772 -0.142031  0.176943  0.0562043 -0.063697  0.0736817\nLyngbya          -0.45345  0.075392  0.055651  0.0747107 -0.007676 -0.0088353\nChamaepinnularia  0.11821  0.067633  0.002487 -0.0394544 -0.046828 -0.0453373\nAchnantes         0.12193 -0.007016 -0.005199 -0.0579162  0.007942  0.0004642\nAmphora           0.07641 -0.055694 -0.073152  0.0983283  0.009532 -0.0447069\nCaloneis          0.10235  0.100918  0.010924 -0.0128037 -0.110912 -0.0484938\nClosterium       -0.13921 -0.049866 -0.040879 -0.1396354  0.023961 -0.0356380\nCocconeis         0.08230  0.111537 -0.116166 -0.0253457  0.078588  0.0767795\nCymbella          0.05167 -0.055582  0.016607 -0.0439576 -0.006371  0.0316069\nEolimna          -0.04478  0.040748  0.035461  0.0316799 -0.075134 -0.0244236\nEpithemia         0.07696  0.053827  0.045227  0.0438611  0.041962 -0.0432302\nEunotia          -0.05858  0.073250 -0.007121 -0.0114420 -0.009144 -0.0119924\nFrustulia         0.02272 -0.199618 -0.124568  0.0131044  0.025406 -0.0360106\nGirosigma         0.02634  0.128337 -0.026327 -0.0387420 -0.032438  0.0447555\nGomphonema        0.07341  0.161492  0.025849  0.0627397  0.022804  0.0060812\nMelosira         -0.05697  0.080419  0.113156 -0.1522371 -0.010332 -0.0211294\nNavicula          0.06661  0.024720  0.170748  0.0007566  0.147542 -0.0024464\nNitzchia         -0.01762 -0.146199 -0.006291 -0.0369694 -0.062184  0.0808324\nPlanothidium      0.19033  0.088406  0.005299  0.0107074 -0.019909 -0.0672288\nSurilella        -0.01394  0.225111 -0.076448  0.0277918 -0.025008  0.0725367\nPinnularia       -0.07301 -0.071644 -0.012235  0.0131215 -0.014800 -0.0209236\n\n\nSite scores (weighted sums of species scores)\n\n         RDA1     RDA2      RDA3     RDA4     RDA5     RDA6\nT1.1 -1.07703  0.01888 -0.336999 -0.09191 -0.07613 -0.45253\nT1.2 -0.84054 -0.20049 -0.141839 -0.17384  0.41711 -0.36452\nT1.3 -0.21890 -0.28606  0.057019 -0.41733 -0.19777  0.18328\nT1.4 -0.10950  0.13679  0.237775 -0.15358 -0.27403  0.24129\nT1.5  0.03167  0.36875 -0.068462 -0.02417  0.03290  0.45435\nT1.6 -0.02467  0.44011 -0.025990 -0.07247  0.04603  0.29248\nT1.7  0.16166  0.39197 -0.238118 -0.11707  0.09933 -0.03318\nT1.8  0.10948  0.45084 -0.180997 -0.02135  0.13711  0.57389\nT2.1 -0.26911 -0.30806 -0.767805  0.87397 -0.04427  0.98553\nT2.2 -0.09952 -0.13226  0.772156  0.70675  0.69534  0.25746\nT2.3 -0.22223 -0.20709  0.295607  0.34609 -0.52442  0.03893\nT2.4 -0.10695  0.08534  0.088760  0.27482 -0.62125 -0.25749\nT2.5 -0.01470  0.16145  0.362241  0.26382 -0.47381 -0.22220\nT2.6  0.16730  0.34242  0.051480  0.06839 -0.07649 -0.30779\nT2.7  0.32172  0.27478 -0.097778  0.15784  0.11343 -0.39605\nT2.8  0.34014  0.40401 -0.109732  0.25509  0.06223 -0.44183\nT3.1  0.20708 -0.87754 -0.685639  0.93999 -0.34090  0.42622\nT3.2  0.15556 -0.56176  0.588049 -0.31921 -0.28143  0.64658\nT3.3  0.19044 -0.31732  0.423720 -0.29719 -0.08333  0.35854\nT3.4  0.26461 -0.20676 -0.026922 -0.24747 -0.14614 -0.28402\nT3.5  0.26567 -0.07627 -0.007015 -0.51250 -0.24973 -0.40467\nT3.6  0.26294 -0.02789 -0.060279 -0.54987  0.29896 -0.27382\nT3.7  0.27363  0.07944 -0.083931 -0.34491  0.49386 -0.54819\nT3.8  0.23124  0.04670 -0.045299 -0.54391  0.99339 -0.47227\n\n\nSite constraints (linear combinations of constraining variables)\n\n          RDA1      RDA2       RDA3     RDA4     RDA5     RDA6\nT1.1 -0.608094  0.069700 -0.2659805  0.04600 -0.09435 -0.06431\nT1.2 -0.672062 -0.282194 -0.1487709 -0.10561  0.35054 -0.16350\nT1.3 -0.356768 -0.237330  0.2273373 -0.54749 -0.12603  0.04596\nT1.4  0.009029  0.394109  0.1840858 -0.36486 -0.01351 -0.26989\nT1.5 -0.018557  0.506317 -0.0001257 -0.12165 -0.12484  0.38849\nT1.6 -0.084608  0.400060  0.0271550 -0.29946 -0.05580  0.08539\nT1.7 -0.058104  0.306643 -0.2006076  0.20594  0.15177  0.29384\nT1.8 -0.160580  0.192429 -0.4894293  0.01713  0.14478  0.50417\nT2.1  0.059599 -0.099508 -0.1636965  0.23651 -0.09396  0.42975\nT2.2 -0.152474 -0.181670  0.7823215  0.65227  0.57180  0.22938\nT2.3 -0.135133  0.072656  0.1381488  0.31328 -0.15771 -0.26812\nT2.4  0.080845  0.150351  0.1744033  0.11732 -0.18811 -0.19088\nT2.5 -0.031560 -0.016833  0.3379676  0.09039 -0.71895 -0.07707\nT2.6  0.223424  0.286614  0.0244991  0.13025  0.03622 -0.30461\nT2.7  0.162822  0.261848 -0.0774071  0.33031 -0.01031 -0.18129\nT2.8  0.214704  0.144374 -0.1007849  0.12653  0.16237 -0.32115\nT3.1  0.276688 -0.515338 -0.5875697  0.21567  0.03745 -0.21428\nT3.2 -0.078309 -0.261042  0.0094046  0.01194 -0.09537  0.23117\nT3.3  0.445486 -0.242713  0.3772510 -0.37955  0.05636  0.29527\nT3.4 -0.128534 -0.394367  0.1125166 -0.31742  0.01463 -0.11643\nT3.5  0.206039 -0.409549 -0.1202982  0.19481 -0.60608  0.19190\nT3.6  0.512665 -0.044235 -0.0726911 -0.31755  0.36432  0.26933\nT3.7  0.092435 -0.008915 -0.0763885 -0.02302  0.01115 -0.43913\nT3.8  0.201048 -0.091407 -0.0913406 -0.21175  0.38361 -0.35399\n\n\nBiplot scores for constraining variables\n\n                  RDA1     RDA2     RDA3    RDA4     RDA5     RDA6\nAmonio        -0.05176 -0.12017  0.67080  0.2933  0.41466  0.27637\nNitrito       -0.58706 -0.22830  0.29302 -0.3920 -0.10474 -0.33554\nNitrato        0.11287 -0.04070  0.34885 -0.4042 -0.26078 -0.02453\nOxigeno        0.10513 -0.04085 -0.64672  0.1262  0.55134 -0.18159\npH             0.22497  0.26189 -0.03689 -0.5123 -0.15576 -0.46422\nConductividad -0.61873  0.43117 -0.22737 -0.3900  0.06681  0.25390\nCaudal        -0.32017  0.13247 -0.28194 -0.5026  0.08692  0.36194\nVel_Corriente  0.03368  0.27010 -0.30589 -0.4551 -0.06465  0.51914\nLuz            0.30256 -0.52037 -0.35636  0.2878 -0.31339 -0.01181\nTemp          -0.32332  0.77248 -0.07647  0.2202  0.25887 -0.12217\n\n\nA continuación se muestra una manera de extraer algunos insumos por separado del anterior comando summary(tax.rda). Las coordenadas de los taxonesy de los sitios serán tenidas en cuenta más adelante, para las figuras de ggplot2.\n\n# Matriz 3. Escores o coordenadas de los taxones\nspecies.scores <- scores(tax.rda, display = \"species\")\n\n# Escores o coordenadas de los sitios\nsite.scores <- scores(tax.rda, display = \"sites\")\n\n# Escores de las variables restringidas\nbiplot.scores <- scores(tax.rda, display = \"bp\")\n\n\n\n\n11.0.1.2 Paso 2. Coeficientes de las variables regresoras (ambientales), en el modelo lineal.\n\nSolo se mostrarán los tres primeros ejes canónicos [,1:3], para facilidad de su interpretación.\n\nround(coef(tax.rda),2)[,1:3]\n\n               RDA1  RDA2  RDA3\nAmonio         0.01 -0.01  0.10\nNitrito       -0.18 -0.32  0.18\nNitrato        0.04  0.03  0.01\nOxigeno        0.03 -0.04 -0.11\npH             0.07  0.07  0.04\nConductividad -0.02  0.01 -0.01\nCaudal         0.10 -0.28  0.00\nVel_Corriente  0.37  0.21  0.02\nLuz            0.00  0.00  0.00\nTemp           0.06  0.14  0.01\n\n\nSe puede pensar en un modelo lineal, que tiene en cuenta a los coeficientes descritos en el primer eje canónico:\n\nDistribución de los taxones de microalgas (Matriz Y) = 0.01(Amonio) – 0.18(Nitrito) + … + 0.06(Temp)\n\n\n\n\n11.0.1.3 Paso 3. R2 sin ajuste vs. R2 ajustado (Ezequiel 1930)\n\nLa nueva inercia no sesgada (sin restricción) calculada con la formula de Ezequiel es de 0.19 o del 19%.\n\n# R^2 sin ajuste (inercia restringida)\n(R2 <- RsquareAdj(tax.rda)$r.squared)\n\n[1] 0.5463953\n\n# R^2 ajustado\n(R2adj <- RsquareAdj(tax.rda)$adj.r.squared)\n\n[1] 0.1974686\n\n\n\n\n\n11.0.1.4 Paso 4. Figura de Triplot\n\nA continuación, se realizará la gráfica del RDA (figura Triplot) (Figura 14.1), que relaciona a los tres elementos: taxones, variables ambientales y sitios de muestreo mediante dos tipos de escalamiento (Scalings 1 y 2).\n\ndev.new(title = \"RDA scaling 1 y 2\",\n        width = 16,height = 8,noRStudioGD = TRUE)\npar(mfrow = c(1, 2))\n# Scaling 1\nplot(tax.rda,scaling=1, display = c(\"sp\", \"lc\", \"cn\"), main=\"RDA - scaling 1\")\n# Scaling 2\nplot(tax.rda, display = c(\"sp\", \"lc\", \"cn\"), main=\"RDA - scaling 2\")\n\npar(mfrow = c(1, 1))\n\n\n\n\n11.0.1.5 Paso 5. Prueba global del RDA\n\nEsta prueba obtiene un valor p = 0.04296 *, por lo cual se valida que el modelo de regresión múltiple de este RDA presenta un ajuste apropiado ( a pesar de la poca inercia encontrada).\n\n# Prueba global del RDA (dos opciones)\n# Ho= no hay relación entre las variables X y las Y\nanova(tax.rda, permutations = how(nperm = 1000))\n\nPermutation test for rda under reduced model\nPermutation: free\nNumber of permutations: 1000\n\nModel: rda(formula = tax.hel ~ Amonio + Nitrito + Nitrato + Oxigeno + pH + Conductividad + Caudal + Vel_Corriente + Luz + Temp, data = amb)\n         Df Variance      F  Pr(>F)  \nModel    10 0.078044 1.5659 0.03596 *\nResidual 13 0.064790                 \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n\nA continuación se muestra que ninguno de los ejes canónicos prsenta significancia para la ordenación de las variables y de las observaciones de este análisis (valor p > 0.05), sin embargo se continuará con el procedimiento.\n\n# Prueba de los ejes canónicos\nanova(tax.rda, by = \"axis\", permutations = how(nperm = 1000))\n\nPermutation test for rda under reduced model\nForward tests for axes\nPermutation: free\nNumber of permutations: 1000\n\nModel: rda(formula = tax.hel ~ Amonio + Nitrito + Nitrato + Oxigeno + pH + Conductividad + Caudal + Vel_Corriente + Luz + Temp, data = amb)\n         Df Variance      F Pr(>F)\nRDA1      1 0.028864 5.7914 0.1329\nRDA2      1 0.019400 3.8926 0.3596\nRDA3      1 0.009741 1.9544 0.9411\nRDA4      1 0.006291 1.2622 0.9960\nRDA5      1 0.004905 0.9842 0.9970\nRDA6      1 0.003407 0.6835 1.0000\nRDA7      1 0.002132 0.4278 1.0000\nRDA8      1 0.001938 0.3888 1.0000\nRDA9      1 0.000927 0.1859 1.0000\nRDA10     1 0.000440 0.0884 1.0000\nResidual 13 0.064790              \n\n\n\n\n\n11.0.1.6 Paso 6. Factor de inflación de la varianza (VIF) del RDA\n\n\n# Factor de inflación\nround(vif.cca(tax.rda), 2)\n\n       Amonio       Nitrito       Nitrato       Oxigeno            pH \n         1.40          2.02          1.61          1.22          1.47 \nConductividad        Caudal Vel_Corriente           Luz          Temp \n         9.28          7.46          4.85          2.04          2.31 \n\n\nLos resultados están por debajo de un VIF de 10, por lo que todas las variables son importantes para el análisis.\n\n\n\n11.0.1.7 Paso 7. Criterios de selección de variables ambientales (X)\n\n\n\n11.0.1.8 7.1 Forward selection usando forward.sel()\nEl comando forward.selpermitirá definir a las variables ambientales con importancia para ser relacionadas con los taxones en el RDA. Para este caso define a la Conductividad y a la Velocidad del la Corriente.\n\n# Factor de inflación\nforward.sel(tax.hel, amb, adjR2thresh = R2adj)\n\nTesting variable 1\nTesting variable 2\nTesting variable 3\nProcedure stopped (adjR2thresh criteria) adjR2cum = 0.200960 with 3 variables (> 0.197469)\n\n\n      variables order         R2     R2Cum   AdjR2Cum        F pvalue\n1 Conductividad     6 0.11614724 0.1161472 0.07597211 2.891024  0.009\n2 Vel_Corriente     8 0.09924816 0.2153954 0.14067115 2.656384  0.024\n\n\n\n\n11.0.1.9 7.2 Eliminación anticipada (Backward) usando “ordistep()” de vegan\nEl anterior resultado es validado por esta función ordistep, la cual luego de varias corridas, define a las mismas variables ambientales Conductividad y a la Velocidad del la Corriente, pero incluye a la Temperatura como las significativas para el análisis RDA. Para continuar el ejercicio, a continuación se realizará un nuevo RDA (RDA parsimonioso) con estas tres variables.\n\n# 7.2 Eliminación anticipada (Backward) usando \"ordistep()\" de vegan\nstep.backward <- ordistep(tax.rda,permutations = how(nperm = 499))\n\n\nStart: tax.hel ~ Amonio + Nitrito + Nitrato + Oxigeno + pH + Conductividad +      Caudal + Vel_Corriente + Luz + Temp \n\n                Df     AIC      F Pr(>F)  \n- Nitrato        1 -45.747 0.5267  0.836  \n- Nitrito        1 -45.375 0.7380  0.626  \n- Luz            1 -45.164 0.8591  0.536  \n- Caudal         1 -45.084 0.9053  0.476  \n- Amonio         1 -44.961 0.9770  0.386  \n- Oxigeno        1 -44.667 1.1492  0.340  \n- pH             1 -44.738 1.1072  0.332  \n- Vel_Corriente  1 -44.412 1.3001  0.254  \n- Temp           1 -44.020 1.5356  0.138  \n- Conductividad  1 -43.286 1.9875  0.084 .\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nStep: tax.hel ~ Amonio + Nitrito + Oxigeno + pH + Conductividad + Caudal +      Vel_Corriente + Luz + Temp \n\n                Df     AIC      F Pr(>F)  \n- Nitrito        1 -46.555 0.7127  0.658  \n- Caudal         1 -46.216 0.9222  0.408  \n- Amonio         1 -46.112 0.9867  0.374  \n- Luz            1 -45.947 1.0903  0.362  \n- pH             1 -45.915 1.1104  0.354  \n- Oxigeno        1 -45.753 1.2124  0.262  \n- Temp           1 -45.284 1.5132  0.154  \n- Vel_Corriente  1 -44.698 1.8963  0.120  \n- Conductividad  1 -43.786 2.5121  0.042 *\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nStep: tax.hel ~ Amonio + Oxigeno + pH + Conductividad + Caudal + Vel_Corriente +      Luz + Temp \n\n                Df     AIC      F Pr(>F)  \n- Caudal         1 -47.100 0.9375  0.444  \n- Amonio         1 -46.967 1.0261  0.352  \n- pH             1 -46.802 1.1365  0.340  \n- Luz            1 -46.842 1.1100  0.322  \n- Oxigeno        1 -46.620 1.2591  0.286  \n- Temp           1 -45.383 2.1193  0.052 .\n- Vel_Corriente  1 -44.635 2.6618  0.052 .\n- Conductividad  1 -43.968 3.1590  0.018 *\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nStep: tax.hel ~ Amonio + Oxigeno + pH + Conductividad + Vel_Corriente +      Luz + Temp \n\n                Df     AIC      F Pr(>F)   \n- Amonio         1 -47.616 1.0204  0.382   \n- Luz            1 -47.525 1.0854  0.362   \n- pH             1 -47.448 1.1398  0.330   \n- Oxigeno        1 -47.387 1.1836  0.288   \n- Temp           1 -45.715 2.4235  0.040 * \n- Vel_Corriente  1 -44.448 3.4221  0.004 **\n- Conductividad  1 -42.714 4.8773  0.004 **\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nStep: tax.hel ~ Oxigeno + pH + Conductividad + Vel_Corriente + Luz +      Temp \n\n                Df     AIC      F Pr(>F)   \n- Luz            1 -48.000 1.1841  0.276   \n- pH             1 -47.803 1.3343  0.240   \n- Oxigeno        1 -47.714 1.4020  0.182   \n- Temp           1 -46.427 2.4162  0.042 * \n- Vel_Corriente  1 -45.170 3.4595  0.004 **\n- Conductividad  1 -43.486 4.9469  0.002 **\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nStep: tax.hel ~ Oxigeno + pH + Conductividad + Vel_Corriente + Temp \n\n                Df     AIC      F Pr(>F)   \n- pH             1 -48.202 1.4002  0.206   \n- Oxigeno        1 -48.138 1.4525  0.184   \n- Temp           1 -46.244 3.0499  0.012 * \n- Vel_Corriente  1 -45.949 3.3094  0.010 **\n- Conductividad  1 -44.266 4.8576  0.004 **\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nStep: tax.hel ~ Oxigeno + Conductividad + Vel_Corriente + Temp \n\n                Df     AIC      F Pr(>F)   \n- Oxigeno        1 -48.466 1.4257  0.210   \n- Temp           1 -47.010 2.7027  0.014 * \n- Vel_Corriente  1 -46.238 3.4121  0.006 **\n- Conductividad  1 -44.954 4.6440  0.002 **\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nStep: tax.hel ~ Conductividad + Vel_Corriente + Temp \n\n                Df     AIC      F Pr(>F)   \n- Temp           1 -47.549 2.5845  0.016 * \n- Vel_Corriente  1 -46.730 3.3681  0.004 **\n- Conductividad  1 -45.444 4.6545  0.002 **\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n\n\n\n\n11.0.1.10 Paso 8. R2 ajustado\n\nAl validar el ajuste del RDA con las dos variables seleccionadas, se obtiene un valor de 0.3 o 30% de ajuste.\n\n# Se define un R^2: 0.3 (30% de relación)\nRsquareAdj(step.backward)\n\n$r.squared\n[1] 0.3051824\n\n$adj.r.squared\n[1] 0.2009598\n\n\n\n\n\n11.0.1.11 Paso 9. RDA Parsimonioso (rda.par)\n\nRDA Parsimonioso significa que se realizará un nuevo RDA con las dos variables ambientales seleccionadas.\n\n# RDA resumido\n(rda.pars <- rda(tax.hel ~ Temp + Vel_Corriente + Conductividad, data = amb))\n\nCall: rda(formula = tax.hel ~ Temp + Vel_Corriente + Conductividad,\ndata = amb)\n\n              Inertia Proportion Rank\nTotal         0.14283    1.00000     \nConstrained   0.04359    0.30518    3\nUnconstrained 0.09924    0.69482   20\nInertia is variance \n\nEigenvalues for constrained axes:\n    RDA1     RDA2     RDA3 \n0.025917 0.013517 0.004157 \n\nEigenvalues for unconstrained axes:\n    PC1     PC2     PC3     PC4     PC5     PC6     PC7     PC8 \n0.03482 0.01676 0.01396 0.00973 0.00677 0.00518 0.00252 0.00220 \n(Showing 8 of 20 unconstrained eigenvalues)\n\n\n\n\n\n11.0.1.12 Paso 10. Coeficientes del modelo lineal parsimonioso\n\n\n# RDA resumido\nround(coef(rda.pars),2)\n\n               RDA1  RDA2  RDA3\nTemp           0.04  0.23  0.08\nVel_Corriente  0.47  0.36 -0.36\nConductividad -0.02 -0.01  0.00\n\n\n\n\n\n11.0.1.13 Paso 11. Dos Triplots del RDA parsimonioso (Scaling 1 y Scaling 2)\n\n\ndev.new(title = \"RDA Parsimonioso scaling 1 y 2\",\n        width = 16,height = 8,noRStudioGD = TRUE)\npar(mfrow = c(1, 2))\n\n# Scaling 1\nplot(rda.pars,scaling = 1,display = c(\"sp\", \"lc\", \"cn\"),\n     main = \"Triplot RDA taxa.hel ~ amb - scaling 1\")\nspe.sc1 <- scores(rda.pars, choices = 1:2, scaling = 1, display = \"sp\")\narrows(0, 0, spe.sc1[, 1] * 0.92,spe.sc1[, 2] * 0.92,\n       length = 0, lty = 1, col = \"red\")\n\n# Scaling 2\nplot(rda.pars,scaling = 2,display = c(\"sp\", \"lc\", \"cn\"),\n     main = \"Triplot RDA taxa.hel ~ amb - scaling 2\")\nspe.sc1 <- scores(rda.pars, choices = 1:2, scaling = 2, display = \"sp\")\narrows(0, 0, spe.sc1[, 1] * 0.92,spe.sc1[, 2] * 0.92,\n       length = 0, lty = 1, col = \"red\")\npar(mfrow = c(1, 1))\n\n#—-\n\n\n\n11.0.1.14 Paso 12. RDA con paquete ggplot2\n\nSe realizará la figura del RDA con el paquete ggplot2, dada su mejor presentación, comparado a las figuras anteriores, realizadas con el paquete vegan. Los siguientes comandos sirven para identificar las coorddenadas de los sitios (“sites”), los taxones (“sp”) y las variables ambientales (“vectors”).\n\n# Insumos del RDA parsimonioso o que resume a las tres variables\n(rda.pars <- rda(tax.hel ~ Temp + Vel_Corriente + Conductividad, data = amb))   # RDA resumido.\n\nCall: rda(formula = tax.hel ~ Temp + Vel_Corriente + Conductividad,\ndata = amb)\n\n              Inertia Proportion Rank\nTotal         0.14283    1.00000     \nConstrained   0.04359    0.30518    3\nUnconstrained 0.09924    0.69482   20\nInertia is variance \n\nEigenvalues for constrained axes:\n    RDA1     RDA2     RDA3 \n0.025917 0.013517 0.004157 \n\nEigenvalues for unconstrained axes:\n    PC1     PC2     PC3     PC4     PC5     PC6     PC7     PC8 \n0.03482 0.01676 0.01396 0.00973 0.00677 0.00518 0.00252 0.00220 \n(Showing 8 of 20 unconstrained eigenvalues)\n\nnames(summary(rda.pars))    # Insumos del RDA parsimonioso\n\n [1] \"species\"     \"sites\"       \"constraints\" \"biplot\"      \"call\"       \n [6] \"tot.chi\"     \"constr.chi\"  \"unconst.chi\" \"cont\"        \"concont\"    \n[11] \"scaling\"     \"digits\"      \"inertia\"     \"method\"     \n\n\n\n\n11.0.1.14.1 12.1 Coordenadas de los sitios y el factor “coord.sit”\n\n\n# 1) Coordenadas de los sitios y el factor (coord.sit)\ncoord.sit <- as.data.frame(scores(rda.pars,\n                                  choices = 1:2, display = \"sites\"))     # Coordenadas de los sitios\ncoord.sit$sitio <- rownames(coord.sit)      # Crear una columna con nombres de los sitios\ncoord.sit$grp <-  datos$Tributario               # Adicionar columna de grupos por Tributario\nhead(coord.sit)                             # vista resumida de las coordenadas de sitios\n\n            RDA1        RDA2 sitio grp\nT1.1 -1.11971663 -0.30601405  T1.1  T1\nT1.2 -0.85825274 -0.42028232  T1.2  T1\nT1.3 -0.18370421 -0.36439466  T1.3  T1\nT1.4 -0.12410643  0.08403049  T1.4  T1\nT1.5 -0.02273675  0.46138698  T1.5  T1\nT1.6 -0.10175889  0.47796564  T1.6  T1\n\n\n\n\n\n11.0.1.14.2 12.2 Coordenadas de los taxones “coord.tax”\n\n\n# 2) Coordenadasde las especies (coord.tax) \ncoord.tax <- as.data.frame(scores(rda.pars,\n                                  choices = 1:2, display = \"sp\"))    # Dos primeros ejes\ncoord.tax$especies <- rownames(coord.tax)       # Insertar columna con nombres de las especies\nhead(coord.tax) \n\n                        RDA1         RDA2         especies\nFragillaria       0.18835404 -0.111108636      Fragillaria\nLyngbya          -0.41883579  0.006822599          Lyngbya\nChamaepinnularia  0.09146325  0.064258294 Chamaepinnularia\nAchnantes         0.09957281 -0.021272988        Achnantes\nAmphora           0.08594521 -0.039656846          Amphora\nCaloneis          0.07482072  0.043049919         Caloneis\n\n\n\n\n\n11.0.1.14.3 12.3 Coordenadas de las ambientales “coord.amb”\n\n\n# 3) Coordenadasde las especies (coord.tax) \namb1 <- envfit(tax.rda, amb) # Se pueden seleccionar variables con, p.max = 0.05\ncoord.amb = as.data.frame(scores(amb1, \"vectors\"))\ncoord.amb$amb <- rownames(coord.amb)         # Insertar columna con nombres de las ambientales\ncoord.amb = coord.amb[c(6,8,10),] # La 3 variables seleccionadas\nhead(coord.amb) \n\n                     RDA1      RDA2           amb\nConductividad -0.51073374 0.4101799 Conductividad\nVel_Corriente -0.00143185 0.2248100 Vel_Corriente\nTemp          -0.32050590 0.6553301          Temp\n\n\n\n\n\n11.0.1.14.4 12.4 Figura del RDA con vectores de especies\n\n\nx11()\nggplot() +\n  # Sitios\n  geom_text_repel(data = coord.sit,aes(RDA1,RDA2,label=row.names(coord.sit)),\n                  size=4)+   # Muestra el cuadro de la figura\n  geom_point(data = coord.sit,aes(RDA1,RDA2,colour=grp),size=4)+\n  scale_shape_manual(values = c(21:25))+\n  # Taxones  \n  geom_segment(data = coord.tax,aes(x = 0, y = 0, xend = RDA1, yend = RDA2), \n               arrow = arrow(angle=22.5,length = unit(0.25,\"cm\"),\n                             type = \"closed\"),linetype=1, size=0.6,colour = \"red\")+\n  geom_text_repel(data = coord.tax,aes(RDA1,RDA2,label=especies),colour = \"red\")+\n  # Factor \n  geom_polygon(data=coord.sit,aes(x=RDA1,y=RDA2,fill=grp,group=grp),alpha=0.30) +\n  \n  geom_hline(yintercept=0,linetype=3,size=1) + \n  geom_vline(xintercept=0,linetype=3,size=1)+\n  guides(shape=guide_legend(title=NULL,color=\"black\"),\n         fill=guide_legend(title=NULL))+\n  theme_bw()+theme(panel.grid=element_blank())\n\n\n\n\nFigura 11.1: Figuras del RDA con las variables biológicas y los sitios\n\n\n\n\n\n\n\n11.0.1.14.5 12.5 Figura con vectores de especies (sin flechas)\n\n\nx11()\nggplot() +\n  # Sitios\n  geom_text_repel(data = coord.sit,aes(RDA1,RDA2,label=row.names(coord.sit)),\n                  size=4)+   # Muestra el cuadro de la figura\n  geom_point(data = coord.sit,aes(RDA1,RDA2,colour=grp),size=4)+\n  scale_shape_manual(values = c(21:25))+\n  # Taxones  *valores de cero para caracteres de las flechas (arrow)\n  geom_segment(data = coord.tax,aes(x = 0, y = 0, xend = RDA1, yend = RDA2), \n               arrow = arrow(angle=0,length = unit(0,\"cm\"),\n                             type = \"closed\"),linetype=0, size=0,colour = \"red\")+\n  geom_text_repel(data = coord.tax,aes(RDA1,RDA2,label=especies),colour = \"red\")+\n  # Factor \n  geom_polygon(data=coord.sit,aes(x=RDA1,y=RDA2,fill=grp,group=grp),alpha=0.30) +\n  \n  geom_hline(yintercept=0,linetype=3,size=1) + \n  geom_vline(xintercept=0,linetype=3,size=1)+\n  guides(shape=guide_legend(title=NULL,color=\"black\"),\n         fill=guide_legend(title=NULL))+\n  theme_bw()+theme(panel.grid=element_blank())\n\n\n\n\nFigura 11.2: Figuras del RDA con las variables biológicas y los sitios\n\n\n\n\n\n\n\n11.0.1.14.6 12.6 Figura con vectores de especies y ambientales\n\n\nx11()\nggplot() +\n  # Sitios\n  geom_text_repel(data = coord.sit,aes(RDA1,RDA2,label=row.names(coord.sit)),\n                  size=4)+   # Muestra el cuadro de la figura\n  geom_point(data = coord.sit,aes(RDA1,RDA2,colour=grp),size=4)+\n  scale_shape_manual(values = c(21:25))+\n  # especies  \n  geom_segment(data = coord.tax,aes(x = 0, y = 0, xend = RDA1, yend = RDA2), \n               arrow = arrow(angle=0,length = unit(0,\"cm\"),\n                             type = \"closed\"),linetype=0, size=0,colour = \"red\")+\n  geom_text_repel(data = coord.tax,aes(RDA1,RDA2,label=especies),colour = \"red\")+\n  # Ambiental  \n  geom_segment(data = coord.amb,aes(x = 0, y = 0, xend = RDA1, yend = RDA2), \n               arrow = arrow(angle=22.5,length = unit(0.25,\"cm\"),\n                             type = \"closed\"),linetype=1, size=0.6,colour = \"blue\")+\n  geom_text_repel(data = coord.amb,aes(RDA1,RDA2,label=row.names(coord.amb)),colour = \"#00abff\")+\n  # Factor \n  geom_mark_ellipse(data=coord.sit, aes(x=RDA1,y=RDA2,fill=grp,group=grp),alpha=0.30)  +\n  \n  geom_hline(yintercept=0,linetype=3,size=1) + \n  geom_vline(xintercept=0,linetype=3,size=1)+\n  guides(shape=guide_legend(title=NULL,color=\"black\"),\n         fill=guide_legend(title=NULL))+\n  theme_bw()+theme(panel.grid=element_blank())\n\n\n\n\nFigura 11.3: Figuras del RDA con las variables biológicas, las ambientales y los sitios\n\n\n\n\n\n\n\n\n\n11.0.2 Taller de entrenamiento\n\nObjetivo: Poner en práctica los conceptos vistos en este taller, realizando las siguientes opciones realizando un RDA con las variables biológicas (taxones) y variables ambientales. Enviar los resultados al Teams del profesor. ### P"
  },
  {
    "objectID": "Clasificación_cla.html",
    "href": "Clasificación_cla.html",
    "title": "12  Taller 8.1 Análisis de Clúster - CLA",
    "section": "",
    "text": "Objetivo de la actividad:\n\nEste ejercicio se realizará con la base de datos FQmarino.csv, que ya fue utilizada en el Taller 4.1 de Componentes Pincipales. Esta base contiene datos de siete variables fisicoquímicas, tomadas en siete bahías de Santa Marta.\nEl objetivo de este ejercicio consiste en la realización de un análisis de clúster, basado en cuatro pasos generales (distancia, método de agrupación, número de clúster y selección de variables clasificadoras), para realizar una clasificación de las bahías, basado en las variables que las caracterizan.\n\n\n12.0.1 Referencias bibliográficas de apoyo.\n\n\n\nClúster Jerárquicos\n\n\nLibro: Análisis de datos ecológicos y ambientales - Rodríguez-Barrios Javier 2023 Se detallan todos los procedimientos descritos en el presente ejercicio.\nMicroalgas de la CGSM - Vidal et al. (2018). Implementación de un cluster no jerárquico para valorar paleoambientes con microalgas de la Ciénaga Grande de Santa Marta.\nCluster Brinda información complementaria para los diferentes pasos que requiere un análisis de clúster.\nClustering y heatmaps Similar al anterior enlace, brinda información detallada sobre el análisis de clúster.\nAnálisis de conglomerados Otro enlace con información general sobre los clúster.\nClustering y heatmaps: aprendizaje no supervisado Aplicación de clúster en diferentes disciplinas.\nHierarchical Cluster Analysis Enlace en el que se encuentra información sobre cluster jerárquicos y técnicas detalladas para seleccionar el número de k - clúster o grupos formados.\nDetermining The Optimal Number Of Clusters Información relevante para el paso 3 de este ejercicio, relacionado a la definición de los k-clúster o el número de grupos formados.\n\n\nClúster no Jerárquicos\n\n\nK-means Cluster Analysis Brinda información sobre la construcción de clúster no jerárquicos.\n\n\nOtros\n\n\nIntroduction to dendextend El paquete dendextend brinda opciones para comparar y visualizar dendogramas. Esto complementa al paso 3 del presente ejercicio, relacionado a la definición de los k-clúster formados.\nHierarchical Clustering on Principal Components Articulación de los clúster en los análisis de componentes principales.\n\n\n12.0.1.1 Cargar las librerías requeridas\n\n\n# Librerías requeridas\nlibrary(ellipse)\nrequire(gclus)\nrequire(SciViews)\nrequire(ade4)\nrequire(vegan)\nlibrary(corrplot)\nlibrary(ggplot2)\nlibrary(pheatmap)\nlibrary(\"gplots\")\nlibrary(gridExtra)\nlibrary(factoextra)\n\n\n\n\n12.0.1.2 Cargar o importar la base de datos\n\n\n# Base de datos\ndatos = read.csv2(\"FQmarino.csv\",row.names=1)\n\ncolnames(datos) = c(\"Sitio\",\"pH\",\"Cond\",\"Turb\",\"Temp\",\"Sali\",\"CFot\",\"Oxig\")\n\n\n\n\n12.0.1.3 Exploración de los datos\n\nPara este ejemplo se urtilizarán figuras que relacionan a dos o más variables. En casos en los que se tengan diferentes grupos definidos, se pueden incluir figuras de cajas que permitan visualizar diferencias entre dichos grupos definidos por algún factor.\n\n# Elipses con colores\nM <- cor(datos[,2:8])            # Matriz de Correlación (M)\n\nLa Figura 14.1 permite visualizar las relaciones lineales entre todas las parejas de variables, incluyendo a los coeficientes de correlación de Pearson.\n\nx11()\ncorrplot(M,  method = \"circle\",            # Correlaciones con circulos\n         type = \"lower\", insig=\"blank\",    # Forma del panel\n         order = \"AOE\", diag = FALSE,      # Ordenar por nivel de correlación\n         addCoef.col =\"black\",             # Color de los coeficientes\n         number.cex = 0.8,                 # Tamaño del texto\n         col = COL2(\"RdYlBu\", 200))        # Transparencia de los circulos\n\n\n\n\nFigura 12.1: Correlaciones y coeficientes de correlación.\n\n\n\n\nLa Figura 14.2 es otra posigilidad para visualizar la relación entre las parejas de variables, pero además incluye páneles que visualizan la dispersión de los datos.\n\nlibrary(GGally)\nx11()\nggpairs(data=datos[,c(2:8)], \n        diag = list(continuous = \"densityDiag\"), \n        upper = list(combo = \"box\"), \n        lower = list(combo = \"dot\", aes(fill = Sitio))) +\n  scale_fill_brewer(palette = \"Set1\") +\n  theme(axis.text.x = element_text(angle = 90, vjust = 0.5))\n\n\n\n\nFigura 12.2: Correlaciones, dispersión y coeficientes de correlación.\n\n\n\n\nLa Figura 14.3 a diferencia de la anterior, clasifica a los grupos por colores y además incluye a sus coeficientes de correlación y el patrón de distribución de cada variable mediante histogramas de densidad.\n\nlibrary(GGally)\nx11()\nggpairs(datos[,c(2:8)], aes(color=datos$Sitio),\n        diag = list(continuous = \"densityDiag\"), \n        upper = list(combo = \"box\"), \n        lower = list(combo = \"dot\")) +\n  theme(axis.text.x = element_text(angle = 90, vjust = 0.5))\n\n\n\n\nFigura 12.3: Correlaciones, dispersión y coeficientes de correlación, por cada grupo en comparación.\n\n\n\n\nLa Figura 13.4 permite visualizar a una de las relaciones relevantes, diferenciando por tipos de sitios (S1 y S2).\n\n# Relación trivariada - Lineal\npanel.lm = function(x, y, ...) {\n  tmp<-lm(y~x,na.action=na.omit)\n  abline(tmp, lwd = 1.5, col= 2)\n  points(x,y, ...)}\n\ncoplot(Temp ~ CFot | Sitio, pch=19,\n       panel = panel.smooth, data=datos)\n\n\n\n\nFigura 12.4: Relación bivariada en cada grupo asignado (Sitios).\n\n\n\n\nLa Figura 13.5 es otra forma de visualizar la relación anterior, pero con el paquete “ggplot2”\n\nggplot(datos, aes(x = CFot, y = Temp)) +\n  geom_point() +\n  geom_smooth(method = \"lm\", se = FALSE) +\n  facet_wrap(~Sitio) + \n  theme_bw() + \n  theme(panel.grid=element_blank())\n\n\n\n\nFigura 12.5: Relación bivariada en cada grupo asignado (Sitios).\n\n\n\n\nFinalmente, la Figura 13.6 permite visualizar una relación más detallada entre dos variables seleccionadas y cuyos puntos caracterizan a cada uno de los sitios evaluados.\n\n# Selección de una relación bivariada\nnames(datos)\n\n[1] \"Sitio\" \"pH\"    \"Cond\"  \"Turb\"  \"Temp\"  \"Sali\"  \"CFot\"  \"Oxig\" \n\nx11()\nggplot(datos, aes(x=CFot, y= Temp)) + \n  geom_point(aes(color = Sitio), size=3) + \n  geom_smooth(method= \"lm\") + \n  theme_bw() +\n  theme(panel.grid=element_blank())\n\n\n\n\nFigura 12.6: Relación bivariada en cada grupo asignado (Sitios).\n\n\n\n\n\n\n\n\n12.0.2 Cuatro pasos para el análisis de clúster\n\nA continuación se presenta el paso a paso requerido para un análisis de cluster - cla. Cabe mencionar que es un proceso algo dispendioso en tiempo, pero que brinda la posibilidad de contar con los códigos elaborados para ajustarlos de forma eficiente a otras bases de datos que requieran a este tipo de procedimientos.\n\n\n12.0.2.1 PASO 1. Distancia entre observaciones\n\nSon muchas las distancias que pueden emplearse, pero cada una se ajusta al tipo de datos que se requieran trabajar. Para este caso se usará la distancia euclídea, debido a que se ajusta de manera apropiada a datos ambientales, incorporando además al comando scale, debido a que permite estandarizar a este tipo de variables que presentan escalas disímiles.\n\n# Matriz de distancia\nd.euclid <- dist(scale(datos[,c(2:8)]))\nround(d.euclid,2)\n\n      BTag PBet Mono Gran PGran  Rod\nPBet  2.59                          \nMono  2.94 3.14                     \nGran  3.16 4.09 3.84                \nPGran 3.94 3.75 4.82 2.13           \nRod   3.41 4.12 4.53 2.72  3.17     \nAero  4.47 4.54 5.22 3.47  3.30 3.55\n\n\n\n\n\n12.0.2.2 PASO 2. Elección del método de agrupación de mayor ajuste\n\nSon siete las opciones de dendogramas, de las cuales solo una será la que mejor se ajusta a los datos trabajados. Para ello, primero se realizarán los dendogramas y posteriormente se escogerá l de mejor ajuste con la correlación cofenética.\n\n\n\n12.0.2.3 2.1 Siete métodos de agrupamiento\n\n\n# Método 1. Vecino más cercano \"Cl.single\", función \"hclust\" y método \"single\"\nCl.single <- hclust(d.euclid,method=\"single\")\n\n\n# Método 2. Vecino más lejano \"Cl.complete\", función \"complete\"  \nCl.complete<-hclust(d.euclid,method=\"complete\")\n\n\n# Método 3. UPGMA función \"average\" Unión Promedio no Ponderado\nCl.upgma<-hclust(d.euclid,method=\"average\")\n\n\n# Método 4. UPGMC función \"mcquitty\" Unión Promedio Ponderado\nCl.upgmc<-hclust(d.euclid,method=\"mcquitty\")\n\n\n# Método 5. WPGMA función \"centroid\"\nCl.wpgma<-hclust(d.euclid,method=\"centroid\")\n\n\n# Método 6. WPGMC función \"median\"\nCl.wpgmc<-hclust(d.euclid,method=\"median\")\n\n\n# Método 7. WARD, función \"ward\"\nCl.ward<-hclust(d.euclid,method=\"ward.D\")\n\n\n\n\n12.0.2.4 2.2 Figuras de los dendogramas con los siete métodos de agrupamiento\n\nA continuación se realizará un panel que contenga hasta 4 figuras de dendogramas (Figura 13.7 y Figura 12.8), lo cual permite resumir al número de gráficas generadas, el comando que se empleará para incluir a varias figuras en un mismo panel grafico es grid.arrange() del paquete gridextra.\n\nx11()\n\nf1 <- fviz_dend(Cl.single, k = 2,        # k grupos (opcionales)\n          cex = 0.7,               # tamaño del texto de las ramas\n          ylab = \"Distancia Euclídea\",  # Rotulo de la distancia\n          main = \"Vecino más Cercano - Single\")  # Rotulo de título\n\nf2 <- fviz_dend(Cl.complete, k = 2,        # k grupos (opcionales)\n          cex = 0.7,               # tamaño del texto de las ramas\n          ylab = \"Distancia Euclídea\",  # Rotulo de la distancia\n          main = \"Vecino más Lejano - Complete\")  # Rotulo de título\n\n\nf3 <- fviz_dend(Cl.upgma, k = 2,           # k grupos (opcionales)\n          cex = 0.7,                 # tamaño del texto de las ramas\n          ylab = \"Distancia Euclídea\",  # Rotulo de la distancia\n          main = \"Unión Promedio no Ponderado - upgmc\")  # Rotulo de título\n\n\nf4 <- fviz_dend(Cl.upgmc, k = 2,          \n          cex = 0.7,                 \n          ylab = \"Distancia Euclídea\",  \n          main = \"Unión Promedio Ponderado - upgmc\") \n\n\ngrid.arrange(f1,f2,f3,f4, ncol = 2)\n\n\n\n\nFigura 12.7: Cuatro dendogramas jerárquicos con la distancia euclídea.\n\n\n\n\n\nx11()\n\nf5 <- fviz_dend(Cl.wpgma, k = 2,          \n          cex = 0.7,                 \n          ylab = \"Distancia Euclídea\",  \n          main = \"Unión Centroide no Ponderado - wpgma\") \n\nf6 <- fviz_dend(Cl.wpgmc, k = 2,          \n          cex = 0.7,                 \n          ylab = \"Distancia Euclídea\",  \n          main = \"Unión Centroide Ponderado - wpgmc\") \n\nf7 <- fviz_dend(Cl.ward, k = 2,          \n          cex = 0.7,                 \n          ylab = \"Distancia Euclídea\",  \n          main = \"Método de Ward\") \n\ngrid.arrange(f5,f6,f7, ncol = 2)\n\n\n\n\nFigura 12.8: Tres dendogramas jerárquicos restantes, con la distancia euclídea.\n\n\n\n\n\n\n\n12.0.2.5 2.3 Selección del mejor método de agrupamiento - Correlación Cofenética\n\n2.3.1 Cálculo de las correlaciones cofenéticas\n\n\nEl método que presente la mayor correlación cofenética será el seleccionado. Para este caso se escogerá el dendograma con el método upgma, el cuál presenta un cofenético de 0.8234.\n\n# (1) Correlación cofenpetica  para \"single\"\ncofenet1 <- cophenetic(Cl.single)\nsimple = cor(d.euclid,cofenet1)\nsimple\n\n[1] 0.7358594\n\n# (2) Correlación cofenética  para \"complete\"\ncofenet2<-cophenetic(Cl.complete)\ncompl = cor(d.euclid,cofenet2)\ncompl\n\n[1] 0.8113013\n\n# (3) Correlación cofenética  para \"average\"\ncofenet3<-cophenetic(Cl.upgma)\nupgma = cor(d.euclid,cofenet3)\nupgma\n\n[1] 0.8233726\n\n# (4) CCorrelación cofenética  para \"mcquitty\"\ncofenet4<-cophenetic(Cl.upgmc)\nupgmc = cor(d.euclid,cofenet4)\nupgmc\n\n[1] 0.8209463\n\n# (5) Correlación cofenética  para \"centroid\"\ncofenet5<-cophenetic(Cl.wpgma)\nwpgma = cor(d.euclid,cofenet5)\nwpgma\n\n[1] 0.02444114\n\n# (6) Correlación cofenética  para \"median\"\ncofenet6<-cophenetic(Cl.wpgmc)\nwpgmc = cor(d.euclid,cofenet6)\nwpgmc\n\n[1] 0.3397504\n\n# (7) Correlación cofenética  para \"ward\"\ncofenet7<-cophenetic(Cl.ward)\nward = cor(d.euclid,cofenet7)\nward\n\n[1] 0.79712\n\n\n\n\n2.3.2 Tabulación de las correlaciones cofenéticas\n\n\nLos siguientes comandos permitirán organizar a los siete métodos de agrupamiento, de acuerdo a su nivel de correlación cofenética.\n\n# data frame con cofenéticos\ncofeneticos = data.frame(simple,compl,upgma,upgmc,\n                         wpgma,wpgmc,ward)\n\n# cofenéticos por cada métodos (Met)\ncofenet=data.frame(Met = 1:7,Cofen=t(round(cofeneticos,3)))\n\n# tabla con orden descendente de cofenéticos\ncof_ordenado = cofenet[order(cofenet$Cofen, decreasing = TRUE), ]\ncof_ordenado\n\n       Met Cofen\nupgma    3 0.823\nupgmc    4 0.821\ncompl    2 0.811\nward     7 0.797\nsimple   1 0.736\nwpgmc    6 0.340\nwpgma    5 0.024\n\n\nCon este comando se puede exportar la tabla de cofenéticos como un archivo plano de csv.\n\n# guardar tabla como csv\n# write.csv2(cof_ordenado,\"cofenet.csv\")\n\n\n\n2.3.3 Figuras de algunas correlaciones cofenéticas vs. matriz de distancia\n\n\nA continuación se presenta una muestra de la relación entre las matrices de distancia cofenética y de distancia euclínea, que permitió seleccionar al mejor método de agrupamiento (Figura 12.9).\n\n# convertir matricesde distancia a vectores\nd.euclid <- as.vector(d.euclid)\nd.cofenet1 <- as.vector(cofenet1)\nd.cofenet2 <- as.vector(cofenet2)\nd.cofenet3 <- as.vector(cofenet3)\nd.cofenet4 <- as.vector(cofenet4)\n\n\n# crear un data frame con los vectores y agregar una columna de etiquetas\nsimple1 <- data.frame(d.euclid, d.cofenet1, d.cofenet2, d.cofenet3, d.cofenet4)\nhead(simple1)\n\n  d.euclid d.cofenet1 d.cofenet2 d.cofenet3 d.cofenet4\n1 2.592758   2.592758   2.592758   2.592758   2.592758\n2 2.935826   2.935826   3.138967   3.037397   3.037397\n3 3.157893   3.157893   5.222324   4.157454   4.476721\n4 3.936806   3.157893   5.222324   4.157454   4.476721\n5 3.412345   3.157893   5.222324   4.157454   4.476721\n6 4.469605   3.300609   5.222324   4.157454   4.476721\n\n\n\n# Figuras correlaciones cofenéticas\nx11()\n# (1) distancia cofenética  para \"unión simple\" \nf1<-ggplot(simple1, aes(d.euclid,d.cofenet1))+\n  geom_point(size=3, color=\"#4daf4a\") + \n  geom_smooth(method=\"lm\",se=FALSE,color=\"#377eb8\") +\n  geom_smooth(method=\"loess\",se=FALSE,color =\"#e41a1c\",lty=2,size=1.3) +\n  labs(title= \"Unión Simple\",\n       subtitle= paste(\"Correlación cofenética\",\n                 round(cor(d.euclid,cofenet1),4)),\n       x=\"Distancia Euclidea\",\n       y=\"Distancia cofenética\") +\n  theme_bw()\n\n# (2) distancia cofenética  para \"unión completa\" \nf2<-ggplot(simple1, aes(d.euclid,d.cofenet2))+\n  geom_point(size=3, color=\"#4daf4a\") + \n  geom_smooth(method=\"lm\",se=FALSE,color=\"#377eb8\") +\n  geom_smooth(method=\"loess\",se=FALSE,color =\"#e41a1c\",lty=2,size=1.3) +\n  labs(title= \"Unión Completa\",\n       subtitle= paste(\"Correlación cofenética\",\n                 round(cor(d.euclid,cofenet2),4)),\n       x=\"Distancia Euclidea\",\n       y=\"Distancia cofenética\") +\n  theme_bw()\n\n# (3) distancia cofenética  para \"unión upgma\" \nf3<-ggplot(simple1, aes(d.euclid,d.cofenet3))+\n  geom_point(size=3, color=\"#4daf4a\") + \n  geom_smooth(method=\"lm\",se=FALSE,color=\"#377eb8\") +\n  geom_smooth(method=\"loess\",se=FALSE,color =\"#e41a1c\",lty=2,size=1.3) +\n  labs(title= \"Unión promedio no ponderado - upgma\",\n       subtitle= paste(\"Correlación cofenética\",\n                 round(cor(d.euclid,cofenet3),4)),\n       x=\"Distancia Euclidea\",\n       y=\"Distancia cofenética\") +\n  theme_bw()\n\n\n# (4) distancia cofenética  para \"unión upgmc\" \nf4<-ggplot(simple1, aes(d.euclid,d.cofenet4))+\n  geom_point(size=3, color=\"#4daf4a\") + \n  geom_smooth(method=\"lm\",se=FALSE,color=\"#377eb8\") +\n  geom_smooth(method=\"loess\",se=FALSE,color =\"#e41a1c\",lty=2,size=1.3) +\n  labs(title= \"Unión promedio ponderado - upgmc\",\n       subtitle= paste(\"Correlación cofenética\",\n                 round(cor(d.euclid,cofenet4),4)),\n       x=\"Distancia Euclidea\",\n       y=\"Distancia cofenética\") +\n  theme_bw()\n\ngrid.arrange(f1,f2,f3,f4, ncol = 2)\n\n\n\n\nFigura 12.9: Cuatro regresiones entre la distancia euclídea empleada y las distancias cofenéticas de cada método de agrupamiento definido.\n\n\n\n\n\n\n\n12.0.2.6 PASO 3. Número de grupos formados\n\nLa definición de los grupos formados, representan un insumo importante de información, debido a que permiten generar los k cluster en los que se agrupan las observaciones, basado en las variables que las caracterizan. Este insumo es relevante además, como paso previo a otras técnicas que requieren los grupos definidos a priori, como los análisis discriminantes lineales (lda) o los análisis de varianza multivariados (manovas), de igual forma, a partir de los grupos se pueden responder hipótesis enfocadas en las variaciones que pueden presentar las variables a lo largo de gradientes discretos o en cluster.\n\n\n\n12.0.2.7 Opción 1. Niveles de Fusión.\n\nLa figura de niveles de fusión es una de las más utilizadas para la generación de grupos o de cluster, debido a la sencillez del componente gráfico, en el cual se definen los cluster o grupos (eje Y), dependiendo del escalón de mayor amplitud o distancia horizontal (eje X). En la Figura 12.10 se observa que la mayor amplitud se presenta en 2 k cluster, por lo cual, el dendograma seleccionado en el paso anterior se puede clasificar en dos grupos de observaciones.\n\n# Base de variables a relacionar (amb)\namb <- datos[,c(2:8)]\n\n\n# Crear un data.frame con los datos de altura, k y número de cluster\nf1 <- data.frame(h = Cl.upgma$height, k = nrow(amb):2, cluster = nrow(amb):2)\n\n\n# Crear el gráfico de dispersión y agregar etiquetas de texto\nggplot(f1, aes(x = h, y = k, label = cluster)) +\n  geom_point(color = \"grey\") +\n  geom_text(color = \"red\", size = 3, vjust = -0.5) +\n  geom_step(color = \"grey\", direction = \"vh\") +\n\n# Personalizar el gráfico con títulos, etiquetas de ejes y paleta de colores\n  ggtitle(\"Niveles de Fusión - Distancia Euclídea - UPGMA\") +\n  ylab(\"k (Número de Cluster)\") +\n  xlab(\"h (Altura del Nodo)\") +\n  scale_color_manual(values = c(\"grey\", \"red\")) +\n  theme(axis.title = element_text(size = 16)) +\n  theme_classic()\n\n\n\n\nFigura 12.10: Cuatro regresiones entre la distancia euclídea empleada y las distancias cofenéticas de cada método de agrupamiento definido.\n\n\n\n\n\n\n\n12.0.2.8 Opción 2. Número optimo de clusters de acuerdo al Ancho de silueta. Índice de calidad de Rousseeuw\n\nLa amplitud de silueta es de las opciones más usadas para definir al número de k cluster o grupos del dendograma realizado. En este ejercicio también se define a dos grupos. En caso que los resultados de esta técnica sean diferentes a la anterior, se suele decidir por esta, debido a su mayor grado de precisión.\n\n# 1. Crear un vector vacío (amb.vacio) con asw valores\namb.vacio <- numeric(nrow(amb))\n\n# 2. Silueta \"sil\" \nfor(k in 2: (nrow(amb)-1)){\n    sil <- silhouette(cutree(Cl.upgma,k=k),d.euclid)\n    amb.vacio[k]<-summary(sil)$avg.width} \n\n# 3. Mejor o mayor amplitud de silueta (2 particiones)\nk.mejor <- which.max(amb.vacio)\nk.mejor \n\n\n# Grafica de silueta\nx11()\nplot(1:nrow(amb),amb.vacio,type=\"h\",\n     main=\"Silueta-Número Óptimo de Clusters\", xlab=\"(Número de grupos)\",\n     ylab=\"Amplitud promedio de  silueta\")\n     \naxis(1,k.mejor,paste(\"optimum\",k.mejor,sep=\"\\n\"),col=\"red\",\n     font=2,col.axis=\"red\")\n     \npoints(k.mejor,max(amb.vacio),pch=16,col=\"red\",cex=1.5)\n\ncat(\"\",\"Silueta-Número óptimo de Clusters k=\",k.mejor,\n    \"\\n\",\"Con una aplitud promedio de silueta\",max(amb.vacio),\"\\n\")\n\n\n\n\n12.0.2.9 3.1 Figura del dendograma jerárquico final\n\nLa Figura 12.11 muestra la manera en la que se organizan las observaciones en los dos grupos formados (ramas rojas y azules) devido a la naturaleza de las variables fisicoquímicas que las caracterizar.\n\n# Dendograma final \nx11()\nfviz_dend(Cl.upgma, k = 2,        # k grupos\n          cex = 0.9,              # tamaño del texto de las observaciones\n          ylab = \"Distancia Euclídea\",  # Rotulo de la distancia\n          main = \"Unión Promedio no Ponderada (UPGMA)\", # Rotulo de título\n          lower_rect = 0,           # Inicio de los rectángulos en cero\n          k_colors = c(\"#00AFBB\",\"#FC4E07\"),\n          color_labels_by_k = TRUE,    # Colores para cada grupo\n          rect = TRUE)                 # Rectángulos de cada grupo\n\n\n\n\nFigura 12.11: Dendograma jerárquico final con los dos grupos asignados.\n\n\n\n\nVale la pena mencionar que estos análisis son importantes cuando se cuenta con pocas observaciones (ramas del dendograma), en el caso contrario, es preferible utilizar dendogramas no jerarquicos como el k-meas, el cual fue descrito en uno de los complementos del PCA y se retoma a continuación.\n\n\n\n12.0.2.10 3.2 Figura del dendograma no jerárquico final\n\n\n\nAgrupamiento elegido en el paso 2 (upgma)\n\n\n\n# Matriz de distancia\nd.euclid <- dist(scale(datos[,c(2:8)]))\n\n# Método 3. UPGMA función \"average\" Unión Promedio no Ponderado\nCl.upgma<-hclust(d.euclid,method=\"average\")\n\n\n\nGeneración de la variable agrupadora (gr)\n\n\n\n# Variable agrupadora con k=2 clúster\ngrp <- cutree(Cl.upgma, k = 2)    # Grupos generados \"grp\"  \ngrl <- levels(factor(grp))        # Rotulos de los grupos formados\n\nEste es un paso opcional en caso que se requiera insertar la nueva variable agrupadora a la base de datos en revisión.\n\n# Incluir la variable agrupadora en la base de datos\ndatos.1=data.frame(grp,datos)       # Nuevo dataframe con la variable agrupadora (gr)\nhead (datos.1)\n\n      grp Sitio    pH   Cond  Turb   Temp  Sali  CFot  Oxig\nBTag    1    S1 8.421 37.982 1.364 29.500 2.422 19.72 0.097\nPBet    1    S1 8.490 38.073 0.545 29.545 2.431 22.10 0.147\nMono    1    S1 8.505 37.836 1.273 29.600 2.416 22.10 0.331\nGran    2    S1 8.562 37.336 1.273 29.255 2.382 10.80 0.170\nPGran   2    S2 8.608 37.255 0.636 29.291 2.375  9.00 0.098\nRod     2    S2 8.808 38.063 1.273 29.310 2.380  8.80 0.098\n\n\n\n\nGeneración del clúster No Jerárquico (K-Means)\n\n\nLa Figura 12.12 es la forma no jerárquica de presentar los resultados del cluster definido por el método de agrupamiento upgma.\n\nx11()\nfviz_cluster(list(data = amb, cluster = grp),\n             palette = c(\"#2E9FDF\", \"#FC4E07\"),  # Colores para cada grupo\n             ellipse.type = \"confidence\",        # Elipses\n             repel = TRUE,                 # Elimina solapamiento de observaciones\n             show.clust.cent = FALSE,      # Muestra a los clúster centrados\n             ggtheme = theme_bw())     # Tipo de fondo tomado de ggplot2\n\n\n\n\nFigura 12.12: Dendograma no jerárquico final con los dos grupos asignados.\n\n\n\n\nUna pregunta interesante que se podría resolver, sería valorar si las diferencias entre los dos grupos de observaciones formadas es estadísticamente significativa, para lo cual se debe aplicar un análisis de varianza multivariado (manova).\n\n\n\n12.0.2.11 Paso 4. Variables de mayor contrinución a la clasificación\n\nA continuación se realizan diferentes opciones de mapas de calor (Figura 12.13, Figura 12.14), para identifiar a las variables con mayor relevancia en la clasificación realizada anteriormente en el dendograma seleccionado. Este paso es relevante cuando se quiere ponderar o seleecionar a las variables que aportan al análisis, resumiento de esta forma, la dimensionalidad del problema (número de variables).\n\namb1 <- as.matrix(amb)\n\n\n# Opción 1. Mapa de calor con paquete \"stats\"\nx11()\nhv <- heatmap(amb1, margins=c(7,6), \n              distfun = dist,\n              xlab =\"Variables fisico-químicas\",\n              ylab= \"Bahías\", \n              main = \"Clasificación de Bahías\",\n              scale = \"row\")   # Estandariza variables diferentes.\n\n\n\n\nFigura 12.13: Mapa de calor que define en color rojo a las variables de mayor aporte a la clasificación realizada.\n\n\n\n\nEl siguiente mapa de calor (Figura 12.14) incorpora a la distancia euclídea utilizada y el método de agrupamiento seleccionado (upgma).\n\n# Opción 2. Mapa de calor con paquete \"stats\"\nhclust.fq <- function(amb1) hclust(amb1, method=\"average\")   # Inserción de agrupación UPGMA\n\nx11()\nheatmap.2(amb1,               # Base de datos en formato matricial\n          margins=c(7,7),     # Margenes de la figura\n          scale = \"row\",      # Estandariza variables diferentes.\n          col = bluered(100),                 # Colores del mapa de calor\n          xlab =\"Variables fisico-químicas\",\n          ylab= \"Bahías\", \n          main = \"Clasificación de Bahías\",\n          trace = \"none\", \n          density.info = \"none\",\n          distfun = dist,          # Se puede usar vegdist de \"vegan\" \n          hclustfun=hclust.fq)     # Agrupamiento UPGMA\n\n\n\n\nFigura 12.14: Mapa de calor que define en color rojo a las variables de mayor aporte a la clasificación realizada.\n\n\n\n\nNota: Es posible hacer mapas de calor cruzando a las variables con los grupos asignados. Este procedimiento se presentará en el ejercicio de análisis discriminante."
  },
  {
    "objectID": "Clasificación_lda.html",
    "href": "Clasificación_lda.html",
    "title": "13  Taller 9.1 Análisis Discriminante Lineal - LDA",
    "section": "",
    "text": "Objetivo de la actividad:\n\nLa base de datos que se utilizará es la de medidas morfométricas de peces de un estudio realizado con peces de la india por Gupta et al. (2018) Articulo fuente en los que se validó la taxonomía de peces de la subfamilia Barbinae, utilizando 19 variables morfométricas y 19 variables meristicas, correspondientes a 5 Especie de la familia en mención.\n\n\n\n Imágen tomada de Gupta et al. (2018) (a) S . Sarana (b) P . ticto (c) P . sóforo , (d) P . conconio y (e) P . chola \n\n\nEl objetivo de este ejercicio consiste en identificar a las variables morfométricas que mejor discriminan a las Especie de peces y si dichas Especie se encuentran bien discriminadas en sus grupos taxonómicos asignados. De igual forma se construirá un modelo lineal en el que se puedan incluir nuevos individuos tomados de la misma muestra de peces y puedan ser discriminados de manera eficiente. La base de datos que se utilizará es peces.csv.\n\n\n13.0.1 Referencias bibliográficas de apoyo.\n\nLibro: Análisis de datos ecológicos y ambientales - Rodríguez-Barrios Javier 2023 Ver el capítulo de discriminante lineal (lda) en donde se detallan los procedimientos descritos en el presente ejercicio.\nSigatoka en cultivos de banano - Aguirre et al. (2015). Análisis de discriminante canónico y algunas técnicas multivariadas complementarias.\nLinear Discriminant Analysis in R Se brinda información sobre las generalidades de los lda y su aplicación en R.\nComputing and visualizing LDA in R En este documento se brinda información sobre el análisis y la visualización gráfica del lda.\n\n\n\n13.0.2 Cargar las librerías requeridas\n\n\n# Librerías requeridas\nlibrary(tidyverse)\nlibrary(lattice)\nlibrary(corrplot)\nlibrary(ggplot2)\nlibrary(ggrepel)\nlibrary(reshape2)\nlibrary(ggforce)\n\nlibrary(ade4)\nrequire(vegan)\nlibrary(car)\nlibrary(MASS)\nlibrary(candisc)\nlibrary(mvnormtest)\n\n\n\n\n13.0.3 Cargar o importar la base de datos\n\nLa presente base de datos se encuentra en formato plano de csv, presenta una columna Especie que agrupa a las 5 Especie de peces, otra columna Grupo, que asigna un número a cada especie y posteriormente a las 19 variables morfométricas y 10 variables meristicas, de las cuales se selecionarán las 19 morfométricas para este ejercicio M.1 a M.19.\n\n# Base de datos\npeces<-read.csv2(\"peces.csv\",row.names=1)\nnames(peces)\n\n [1] \"Especie\" \"Grupo\"   \"M.1\"     \"M.2\"     \"M.3\"     \"M.4\"     \"M.5\"    \n [8] \"M.6\"     \"M.7\"     \"M.8\"     \"M.9\"     \"M.10\"    \"M.11\"    \"M.12\"   \n[15] \"M.13\"    \"M.14\"    \"M.15\"    \"M.16\"    \"M.17\"    \"M.18\"    \"M.19\"   \n[22] \"M.20\"    \"M.21\"    \"M.22\"    \"M.23\"    \"M.24\"    \"M.25\"    \"M.26\"   \n[29] \"M.27\"    \"M.28\"    \"M.29\"   \n\n\n\n\n\n13.0.4 Exploración de los datos\n\nPara este ejemplo se urtilizarán figuras que relacionan parejas de variables y figuras de cajas que permitan visualizar diferencias entre las Especie de peces de acuerdo a su morfometría. *Para facilidad del ejercicio se seleccionarán algunas variables morfométricas - peces1, debido a que son las que presentan mejores patrones lineales.\n\n# Elipses con colores con variables morfométricas\npeces1 <- peces[,c(3:9,15,17,20)]\nM <- cor(peces1)            # Matriz de Correlación (M)\n\nLa Figura 14.1 permite visualizar las relaciones lineales entre todas las parejas de variables, incluyendo a los coeficientes de correlación de Pearson.\n\nx11()\ncorrplot(M,  method = \"circle\",            # Correlaciones con circulos\n         type = \"lower\", insig=\"blank\",    # Forma del panel\n         order = \"AOE\", diag = FALSE,      # Ordenar por nivel de correlación\n         addCoef.col =\"black\",             # Color de los coeficientes\n         number.cex = 0.6,                 # Tamaño del texto\n         col = COL2(\"RdYlBu\", 200))        # Transparencia de los circulos\n\n\n\n\nFigura 13.1: Correlaciones y coeficientes de correlación.\n\n\n\n\nLa Figura 14.2 a diferencia de la anterior, clasifica a los grupos por colores y además incluye a sus coeficientes de correlación y el patrón de distribución de cada variable mediante histogramas de densidad.\n\npeces1 <- peces[,c(3:9,15,17,20)]\npeces$Especie <- as.factor(peces$Especie)\n\nx11()\npairs ((peces1),panel=function(x,y)\n{abline(lsfit(x,y)$coef,lwd=2,col=3)\n  lines(lowess(x,y),lty=2,lwd=2,col=2)\n  points(x,y,col=peces$Especie, cex=1.4,pch=19,lwd=0.6)})\n\n\n\n\nFigura 13.2: Relación entre parejas de variables, por cada grupo en comparación (colores).\n\n\n\n\nLa Figura 14.3 permite visualizar la resolución de cada variable para diferenciar o discriminar a las diferentes especies de peces. Esta figura sirve de insumo para descartar aquellas variables con poco potencial de discriminación de las especies.\n\n# Figuras multivariadas de Cajas y bigotes\nlibrary(reshape)\n\nx11()\nggplot(melt(peces[,c(1,3:9,15,17,20)]), aes(x=variable, y=value)) + \n  geom_boxplot(aes(fill=Especie)) + \n  scale_fill_manual(values = c('#fc8d59','#ffffbf','#99d594','#377eb8','#33a02c')) +\n  labs(x=\"\",y=\"Morfometría\") + \n  facet_wrap(~ variable,scales=\"free\") + \n  theme_bw()\n\n\n\n\nFigura 13.3: Variación en la morfometría de los peces, de acuerdo a cada una de las variables seleccionadas.\n\n\n\n\n\n\n13.0.4.1 Mapa de Calor\n\nEl siguiente mapa de calor también permite visualizar a la resolución de las variables morfométricas para diferenciar a las especies de peces, las cuales representan a los grupos en comparación. Con los siguientes comandos se calculará una tabla que resume a los promedios de las 10 variables morfométricas para cada especie evaluada.\n\n# Extracción de los promedios de las variables para cada especie\nlibrary(tidyverse)\npromedios <- peces %>%      \n  subset(select = c(\"Especie\",\"M.1\",\"M.2\",\"M.3\",\"M.4\",\"M.5\",\"M.6\",\"M.7\",\"M.13\",\"M.15\",\"M.18\")) %>%\n  na.omit() %>%\n  group_by(Especie) %>%\n  summarize(across(everything(), mean))\n  \npromedios  <- data.frame(promedios) # Guardar promedios como dataframe\n# promedios\n\nA continuación se combierte el dataframe a formato matricial - promedios2, para poder ser graficado en el mapa de calor.\n\n# Seleccionar columnas de 2 a 10 del data frame peces1 y convertirlas en matriz\npromedios2 <- promedios %>% \n              subset(select = c(2:11)) %>% \n              as.matrix()\nround(promedios2,2)\n\n   M.1  M.2  M.3  M.4  M.5  M.6  M.7 M.13 M.15 M.18\n1 0.38 0.87 0.27 0.30 0.11 0.12 0.69 0.59 0.35 0.35\n2 0.32 0.76 0.25 0.25 0.11 0.13 0.66 0.52 0.34 0.33\n3 0.36 0.85 0.26 0.29 0.11 0.13 0.68 0.56 0.29 0.31\n4 0.37 0.90 0.26 0.28 0.13 0.15 0.70 0.45 0.39 0.40\n5 0.48 0.76 0.28 0.31 0.13 0.16 0.88 0.62 0.28 0.18\n\n\nAhora se incluyen los nombres de las especies a la matriz promedios2.\n\n# Asignar los valores de la primera columna de peces1 como nombres de fila en la matriz peces2\nrownames(promedios2) <- promedios[,1]\n\nLa Figura 13.4 permite visualizar a las variables que mejor discriminan a las especies de peces (variables de tonalidad rojiza).\n\n# Figura del primer mapa de calor\nx11()\nhv <- heatmap(promedios2, \n              margins=c(5,12), \n              distfun = dist,\n              xlab =\"Variables morfométricas\", \n              ylab= \"Especie de Peces\", \n              main = \"Clasificación de Peces\") \n\n\n\n\nFigura 13.4: Mapa de calor que relaciona a las variables morfométricas y a las especies de peces.\n\n\n\n\nLa Figura 13.5 incorpora elementos adicionales como al método de agrupamiento upgma, asumiendo que puede ser el que mejor se ajusta a los datos de este ejercicio.\n\n# Opción 2. Mapa de calor con paquete \"stats\"\nhclust.fq <- function(promedios2) \n             hclust(promedios2, method=\"average\")   # Inserción de UPGMA\n\n\nlibrary(\"gplots\")\nx11()\nheatmap.2(promedios2,         # Base de datos en formato matricial\n          margins=c(5,12),    # Margenes de la figura\n          scale = \"row\",      # Estandariza variables diferentes.\n          col = bluered(100),                 # Colores del mapa de calor\n          xlab =\"Variables morfométricas\", \n          ylab= \"Especie de Peces\", \n          main = \"Clasificación de Peces\",   \n          trace = \"none\", \n          density.info = \"none\",\n          distfun = dist,          # Se puede usar vegdist de \"vegan\" \n          hclustfun=hclust.fq)     # Agrupamiento UPGMA\n\n\n\n\nFigura 13.5: Mapa de calor que relaciona a las variables morfométricas y a las especies de peces.\n\n\n\n\n\n\n\n\n13.0.5 Tres pasos para la realización del discriminante lineal - LDA\n\n\n\n13.0.5.1 Paso 1. Pruebas de supuestos\n\nPara que el análisis discriminante lineal sea considerado como un modelo lineal, debe cumplir con los supuestos de normalidad multivariada y de homogeneidad de covarianzas. Para el caso del presente ejercicio, dichos supuestos no alcanzan a cumplirse con los diagnosticos utilizados (valor p < 0.05), motivo por el cual, el lda de este ejercicio será tomado como una técnica de exploración moltivariada para saber que tan bien discriminados quedan los individuos de cada especie, basado en las 10 variables morfomètricas seleccionadas.\n\n\n13.0.5.1.1 1.1 Supuesto de normalidad\n\nEl supuesto de normalidad multivariada será evaluado con el paquete mvnormtest, el cual utiliza el estadìstico de Shapiro Wilks Multivariado. Para ello se realizarà esta prueba en cada uno de los grupos o especies en comparación.\n\n# Diagnóstico de normalidad por cada tipo de Especie\nlibrary(mvnormtest)\n\nLos siguientes generan los dataframes de cada especie con las 10 variables seleccionadas, convirtiendola ademàs en formato matricial.\n\n# Dataframe por cada especie\n\n# datos de P. chola.\nP.chola   <- peces %>% \n             filter(Especie == \"P. chola\") %>%       \n             subset(select = c(\"M.1\",\"M.2\",\"M.3\",\"M.4\",\"M.5\",\"M.6\",\"M.7\",\"M.13\",\"M.15\",\"M.18\")) %>%              as.matrix()\n\n# datos de P. conchonious.\nP.concho  <- peces %>% \n             filter(Especie == \"P. conchonious\") %>%       \n             subset(select = c(\"M.1\",\"M.2\",\"M.3\",\"M.4\",\"M.5\",\"M.6\",\"M.7\",\"M.13\",\"M.15\",\"M.18\")) %>%              as.matrix() \n\n# datos de P. sophore.\nP.sophore <- peces %>% \n             filter(Especie == \"P. sophore\") %>%       \n             subset(select = c(\"M.1\",\"M.2\",\"M.3\",\"M.4\",\"M.5\",\"M.6\",\"M.7\",\"M.13\",\"M.15\",\"M.18\")) %>%              as.matrix()     \n\n# datos de P. ticto.\nP.ticto   <- peces %>% \n             filter(Especie == \"P. ticto\") %>%       \n             subset(select = c(\"M.1\",\"M.2\",\"M.3\",\"M.4\",\"M.5\",\"M.6\",\"M.7\",\"M.13\",\"M.15\",\"M.18\")) %>%              as.matrix()       \n\n# datos de P. ticto.\nS.sarana  <- peces %>% \n             filter(Especie == \"S. sarana\") %>%       \n             subset(select = c(\"M.1\",\"M.2\",\"M.3\",\"M.4\",\"M.5\",\"M.6\",\"M.7\",\"M.13\",\"M.15\",\"M.18\")) %>%              as.matrix()  \n\nVale la pena resaltar que los datos de las especies P. chola y P. sophore, son singulares, por lo cual no puede calcularse su supuesto de normalidad multivariada. Con el objeto de continuar en el ejercicio, las matrices que representan a las especies en menciòn, seràn desactivadas con #.\n\n# Prueba de normalidad para cada especie\n\n# norm1 <- mshapiro.test(t(P.chola))   # Matriz singular\nnorm2   <- mshapiro.test(t(P.concho))\n# norm3 <- mshapiro.test(t(P.sophore)) # Matriz singular\nnorm4   <- mshapiro.test(t(P.ticto))\nnorm5   <- mshapiro.test(t(S.sarana))\n\nA continuación se resume el resultado de los tres diagnósticos de normalidad multivariada realizados. Vale la pena mencionar que ninguna especie cumple con dicho supuesto estadóstico (valores p < 0.05), aunque existe la posibilidad de probar con alguna transformación.\n\n# Resumen de el diagnóstico de normalidad\n(normalidad = data.frame(Norm.P.concho = norm2$p.value,\n                         Norm.ticto    = norm4$p.value,\n                         Norm.sarana   = norm5$p.value))\n\n  Norm.P.concho   Norm.ticto  Norm.sarana\n1   0.001050723 2.629679e-08 5.169222e-07\n\n\n\n\n\n\n13.0.5.2 1.2 Supuesto de homogeneidad de covarianzas\n\nLa prueba de homogeneidad de covarianza o esfericidad, corresponde al segundo supuesto del análisis discriminante lineal, se utilizará la función betadisper, la cual es complementada por dos análisis de varianza, los cuales definirán si el supuesto logra ser cumplido.\n\n# Pruebas de Homogeneidad de covarianzas paquete \"vegan\"\npeces.d <- dist(peces[,c(3:9,15,17,20)])                # Matriz de distancias\npeces.homoge <- betadisper(peces.d, peces$Especie)      # Permutest\n\nCon la siguiente anova se obtiene un valor p de 0.016*, lo cual indica que no se cumple el supuesto de homogeneidad de covarianzas (valor p < 0.05).\n\n# 1) Prueba con anova permutacional\nanova(peces.homoge)  \n\nAnalysis of Variance Table\n\nResponse: Distances\n          Df   Sum Sq   Mean Sq F value  Pr(>F)  \nGroups     4 0.019804 0.0049509   3.281 0.01638 *\nResiduals 65 0.098082 0.0015090                  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n\nCon el permutest se obtiene un valor p de 0.015*, lo cual indica que tampoco se cumple el supuesto de homogeneidad de covarianzas (valor p < 0.05).\n\n# 2) Prueba permutacional\npermutest(peces.homoge)   # Se cumple el supuesto de homogeneidad \n\n\nPermutation test for homogeneity of multivariate dispersions\nPermutation: free\nNumber of permutations: 999\n\nResponse: Distances\n          Df   Sum Sq   Mean Sq     F N.Perm Pr(>F)  \nGroups     4 0.019804 0.0049509 3.281    999  0.015 *\nResiduals 65 0.098082 0.0015090                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n\n\n\n\n13.0.5.3 Paso 2. Análisis Discriminante Lineal de Fisher - LDA\n\nA continuación, se realizará el lda, que permitirá generar definir al nivel de discriminación de cada grupo o especie de pez. Se presentan algunas opciones gráficas con el procedimiento general y con el análisis discriminate canónico (dca)\n\n# Cálculo del LDA\nnames(peces)\n\n [1] \"Especie\" \"Grupo\"   \"M.1\"     \"M.2\"     \"M.3\"     \"M.4\"     \"M.5\"    \n [8] \"M.6\"     \"M.7\"     \"M.8\"     \"M.9\"     \"M.10\"    \"M.11\"    \"M.12\"   \n[15] \"M.13\"    \"M.14\"    \"M.15\"    \"M.16\"    \"M.17\"    \"M.18\"    \"M.19\"   \n[22] \"M.20\"    \"M.21\"    \"M.22\"    \"M.23\"    \"M.24\"    \"M.25\"    \"M.26\"   \n[29] \"M.27\"    \"M.28\"    \"M.29\"   \n\ndis<-lda (Especie ~ M.1+M.2+M.3+M.4+M.5+M.6+M.7+M.13+M.15+M.18,\n         data = peces)\nround(dis$prior,2)\n\n      P. chola P. conchonious     P. sophore       P. ticto      S. sarana \n          0.17           0.11           0.09           0.29           0.34 \n\n\n“Prior probabilities of groups” corresponde a la probabilidad de clasificación para cada grupo que dependerá del número de peces que lo conforman, aqueyas especies con mayor número de individuos censados, presentarán mayor probabilidad de discriminación.\nPrbabilidad de clasificar indv. de los cinco grupos: P. chola P. conchonious P. sophore P. ticto S. sarana 0.17 0.11 0.08 0.28 0.34\n\n# Insumos del AD \n# summary(dis)\n\nA continuación se presentan los promedios de cada especie por cada variable morfométrica seleccionada para el análisis.\n\n#Grupos de medias para las 4 variables \nround(dis$means,2)\n\n                M.1  M.2  M.3  M.4  M.5  M.6  M.7 M.13 M.15 M.18\nP. chola       0.38 0.87 0.27 0.30 0.11 0.12 0.69 0.59 0.35 0.35\nP. conchonious 0.32 0.76 0.25 0.25 0.11 0.13 0.66 0.52 0.34 0.33\nP. sophore     0.36 0.85 0.26 0.29 0.11 0.13 0.68 0.56 0.29 0.31\nP. ticto       0.37 0.90 0.26 0.28 0.13 0.15 0.70 0.45 0.39 0.40\nS. sarana      0.48 0.76 0.28 0.31 0.13 0.16 0.88 0.62 0.28 0.18\n\n\nLos autovalores son los que permiten definir las coordenadas de las variables para cada función canónica (eje o dimensión del lda), para la grafica del discriminante, se utilizarán las funciones LD1 y LD2, como ejes x y y respectivamente (ver Figura 13.6).\n\n# Autovalores estandarizados (pesos de las variables en cada eje)\nround((Cs <- dis$scaling),2)\n\n        LD1    LD2    LD3    LD4\nM.1   39.34 -16.59  26.35  21.80\nM.2  -13.21   7.17  12.49 -11.29\nM.3   -6.94  -6.34  13.47  -0.45\nM.4   18.73  51.95  25.65  -9.48\nM.5  -17.12 -13.39 -35.00  44.46\nM.6  -13.94 -45.46  -9.77 -52.02\nM.7    6.98  -9.75  -4.18  -5.66\nM.13  10.55  12.26  -5.03   5.43\nM.15  -9.08  -8.91   9.32  21.28\nM.18  -3.50  -4.82   2.14   4.19\n\n\nEn el siguiente insumo se relacionan las coordenadas de las 6 primeras observaciones, las cuales también serán graficadas en la Figura 13.6.\n\n# Coordenadas de las seis primeras observaciones en cada eje canónico\nround(head(Fp <- predict(dis)$x),2)\n\n    LD1  LD2  LD3   LD4\n1 -1.19 3.63 0.21 -0.41\n2 -0.69 1.72 0.03  0.62\n3 -2.64 3.04 1.36  3.00\n4 -2.09 1.18 0.97  0.42\n5 -1.45 2.47 1.56 -0.07\n6 -1.31 2.95 2.77 -0.86\n\n\nLa siguiente tabla es conocida como tabla de contingencia la cual realiza una validación cruzada entre las especies (filas) y los grupos discriminados por el lda (columnas). De acuerdo a esta tabla solo P. sophore no discrimina a todos sus individuos en su grupo, debido a que hay dos peces que presentan una morfometría más similar a P. chola.\n\n# Evaluación de desempeño del AD (método 1)\nattach(peces)\ngroup<-predict(dis,method=\"plug-in\")$class\n(tabla<-table(Especie,group))\n\n                group\nEspecie          P. chola P. conchonious P. sophore P. ticto S. sarana\n  P. chola             12              0          0        0         0\n  P. conchonious        0              8          0        0         0\n  P. sophore            2              0          4        0         0\n  P. ticto              0              0          0       20         0\n  S. sarana             0              0          0        0        24\n\n\nLa siguiente tabla realiza una validación en términos porcentuales, definiendo que en el caso de P. sophore el 64% de sus individuos discriminan correctamente en su especie. El resto de especies presentan una discriminación completa en su grupo.\n\n# Porcentaje de clasificación correcta \nround(diag(prop.table(tabla, 1)),2)*100\n\n      P. chola P. conchonious     P. sophore       P. ticto      S. sarana \n           100            100             67            100            100 \n\n\nLa siguiente validación realizada por el método de Jacknife, presenta menos resolución de discriminación que la anterior, por lo cual no será tenida en cuenta en este ejercicio.\n\n# M?todo 2: con clasifiación basada en jacknife (validación cruzada dejando uno afuera)\ndis.jac <- lda(Especie ~ M.1+M.2+M.3+M.4+M.5+M.6+M.7+M.13+M.15+M.18,\n               data=peces, CV=TRUE)\n\n\n# Número y proporciones de clasificación correcta\nclases.jac <- dis.jac$class\ntabla.jac <- table(Especie, clases.jac)\ntabla.jac\n\n                clases.jac\nEspecie          P. chola P. conchonious P. sophore P. ticto S. sarana\n  P. chola             10              0          2        0         0\n  P. conchonious        0              7          0        1         0\n  P. sophore            4              0          2        0         0\n  P. ticto              0              0          0       20         0\n  S. sarana             0              0          0        0        24\n\n\n\n# Validación cruzada\nround(diag(prop.table(tabla.jac, 1)),2)*100\n\n      P. chola P. conchonious     P. sophore       P. ticto      S. sarana \n            83             88             33            100            100 \n\n\n\n\n\n13.0.5.4 Paso 3. Visualización grafica del LDA\n\n** 3.1 Gráfico de elipses.**\n\n\nA continuación se realizará el componente grafico del lda, el cual inicia con una figura que definirá unas elipses, las cuales relacionan a los individuos de cada especie y cuyo solapamiento definirá el nivel de relación entre estas.\n\n# Escores o coordenadas de las observaciones en cada eje can?nico\nFp <- predict(dis)$x\n\n\n# Grupos asignados por el AD\ngroup<-predict(dis,method=\"plug-in\")$class\n\n\n# Coordenadas y grupos asignados\npeces.coord=data.frame(Especie=group,Fp)\n\nLa Figura 13.6 demuestra que si bien de presenta una buena discriminación de las especies de peces, 4 de las 5 evaluadas presentan cierta relación, definida por el solapamiento de sus elipses.\n\n# Figura del LDA\nattach(peces)\nx11()\nscatterplot(LD2~LD1 | Especie, data=peces.coord,reg.line=FALSE, \n            smooth=F, spread=F,span= 1,grid=F,\n            legend=list(coords=\"bottom\"), \n            ellipse=T,font.lab=2, pch=c(15,16,17,18,19),\n            col=c('#fc8d59','#e41a1c','#984ea3','#377eb8','#33a02c'),\n            main=\"Análisis discriminante\",\n            font.main=2,cex.main=2,cex.lab=1.5,\n            xlab=\"Eje1\", ylab=\"Eje2\")\n\n\n\n\nFigura 13.6: Mapa de calor que relaciona a las variables morfométricas y a las especies de peces.\n\n\n\n\n\n\n** 3.2 Gráfico del discriminante canónico - cda**\n\n\nEl siguiente análisis permite visualizar la influencia de cada variable morfométrica en la separación de los grupos de especies y selecciona a las variables que presentan más influencia en la discriminación de los peces.\n\nattach(peces)\nnames(peces)\n\n [1] \"Especie\" \"Grupo\"   \"M.1\"     \"M.2\"     \"M.3\"     \"M.4\"     \"M.5\"    \n [8] \"M.6\"     \"M.7\"     \"M.8\"     \"M.9\"     \"M.10\"    \"M.11\"    \"M.12\"   \n[15] \"M.13\"    \"M.14\"    \"M.15\"    \"M.16\"    \"M.17\"    \"M.18\"    \"M.19\"   \n[22] \"M.20\"    \"M.21\"    \"M.22\"    \"M.23\"    \"M.24\"    \"M.25\"    \"M.26\"   \n[29] \"M.27\"    \"M.28\"    \"M.29\"   \n\n\nLo primero que se realiza es el modelo lineal mod indicando las variables y los grupos a discriminar.\n\n# Modelo Lineal multivariado con las variables morfom?tricas de peces\nmod <- lm(cbind(M.1,M.2,M.3,M.4,M.5,M.6,M.7,M.13,M.15,M.18) ~ Especie,peces)\n\n\n# Resumen del modelo multivariado\n# summary(mod)\n\nPosteriormente realiza el discriminante canónico can que permite realizar la discriminación de los grupos en los ejes canónicos.\n\n# Análisis discriminante canónico - ADC\ncan <- candisc(mod, term=\"Especie\",data=peces,ndim=1)\n\nA continuación se presenta la Figura 13.7 que define a la discriminación de las especies con un solo eje canónico el cual explica el 81.8% de la variación de los datos. La orientación de los vectores (variables morfométricas), en relación a las cajas, indica su importancia para discriminar a cada especie o grupo en comparación.\n\nx11()\nplot(can,titles.1d = c(\"Puntuación canónica\", \"Estructura\"))\n\n\n\n\nFigura 13.7: Mapa de calor que relaciona a las variables morfométricas y a las especies de peces.\n\n\n\n\nEn el siguiente enlace se puede obtener un caso aplicado con este tipo de análisis multivariados: Aguirre et al. (2015). Ver la figura 2 del manuscrito en mención."
  },
  {
    "objectID": "Manova.html",
    "href": "Manova.html",
    "title": "14  Taller 10.1 Análisis de Varianza Multivariado - MANOVA",
    "section": "",
    "text": "Objetivo de la actividad:\n\nLa base de datos que se utilizará es la de medidas morfométricas de peces de un estudio realizado con peces de la india por Gupta et al. (2018) Articulo fuente en los que se validó la taxonomía de peces de la subfamilia Barbinae, utilizando 19 variables morfométricas y 19 variables meristicas, correspondientes a 5 Especie de la familia en mención.\n\n\n\n Imágen tomada de Gupta et al. (2018) (a) S . Sarana (b) P . ticto (c) P . sóforo , (d) P . conconio y (e) P . chola \n\n\nEl objetivo de este ejercicio consiste en comparar los promedios multivariados de las variables morfométricas que caracterizan a los peces de cada especie (grupos en comparación), para conocer si los atributos morfométricos generan diferencias en cada grupo evaluado. La base de datos que se utilizará es peces.csv.\n\n\n14.0.1 Referencias bibliográficas de apoyo.\n\nLibro: Análisis de datos ecológicos y ambientales - Rodríguez-Barrios Javier 2023 Ver el capítulo de MANOVA, en donde se detallan los procedimientos descritos en el presente ejercicio.\nMANOVA(Multivariate Analysis of Variance) Este documento presenta información relevante sobre la fundamentación de los MANOVAs y su análisis en R\nHow to perform the MANOVA test in R Este documento brinda información sobre los supuestos del MANOVA y la forma de realizar esta prueba multivariada en R.\n\n\n\n14.0.2 Cargar las librerías requeridas\n\n\n# Librerías requeridas\nlibrary(tidyverse)\nlibrary(ggplot2)\nlibrary(reshape2)\nlibrary(ggforce)\n\nlibrary(vegan)          # Para el permutes en homogeneidad de covarianzas\nlibrary(mvnormtest)     # Prueba de normalidad \"mshapiro.test\"\nsource(\"funciones.r\")   # Figuras de normalidad multivariada\nlibrary(ade4)\nlibrary(car)              # Para ejecutar el diagnóstico de independencia\nlibrary(MASS)\n\n\n\n\n14.0.3 Cargar o importar la base de datos\n\nLa presente base de datos se encuentra en formato plano de csv, presenta una columna Especie que agrupa a las 5 Especie de peces, otra columna Grupo, que asigna un número a cada especie y posteriormente a las 19 variables morfométricas y 10 variables meristicas, de las cuales se selecionarán las 19 morfométricas para este ejercicio M.1 a M.19.\n\n# Base de datos\npeces<-read.csv2(\"peces.csv\",row.names=1)\nnames(peces)\n\n [1] \"Especie\" \"Grupo\"   \"M.1\"     \"M.2\"     \"M.3\"     \"M.4\"     \"M.5\"    \n [8] \"M.6\"     \"M.7\"     \"M.8\"     \"M.9\"     \"M.10\"    \"M.11\"    \"M.12\"   \n[15] \"M.13\"    \"M.14\"    \"M.15\"    \"M.16\"    \"M.17\"    \"M.18\"    \"M.19\"   \n[22] \"M.20\"    \"M.21\"    \"M.22\"    \"M.23\"    \"M.24\"    \"M.25\"    \"M.26\"   \n[29] \"M.27\"    \"M.28\"    \"M.29\"   \n\n\n\n\n\n14.0.4 Exploración de los datos\n\nPara este ejemplo se urtilizarán figuras que relacionan parejas de variables y figuras de cajas que permitan visualizar diferencias entre las Especie de peces de acuerdo a su morfometría. *Para facilidad del ejercicio se seleccionarán algunas variables morfométricas - peces1, debido a que son las que presentan mejores patrones lineales.\n\n# Elipses con colores con variables morfométricas\npeces1 <- peces[,c(3:9,15,17,20)]\nM <- cor(peces1)            # Matriz de Correlación (M)\n\nLa Figura 14.1 permite visualizar la resolución de cada variable para diferenciar o discriminar a las diferentes especies de peces. Esta figura sirve de insumo para descartar aquellas variables con poco potencial de discriminación de las especies.\n\n# Figuras multivariadas de Cajas y bigotes\nlibrary(reshape)\n\nx11()\nggplot(melt(peces[,c(1,3:9,15,17,20)]), aes(x=variable, y=value)) + \n  geom_boxplot(aes(fill=Especie)) + \n  scale_fill_manual(values = c('#fc8d59','#ffffbf','#99d594','#377eb8','#33a02c')) +\n  labs(x=\"\",y=\"Morfometría\") + \n  facet_wrap(~ variable,scales=\"free\") + \n  theme_bw()\n\n\n\n\nFigura 14.1: Variación en la morfometría de los peces, de acuerdo a cada una de las variables seleccionadas.\n\n\n\n\n\n\n\n14.0.5 Cuatro pasos para la realización del MANOVA\n\n\n\n14.0.5.1 Paso 1. Pruebas de supuestos\n\nPara que el análisis de varianza multivariado - manova sea considerado como un modelo lineal, debe cumplir con los supuestos de normalidad multivariada, de homogeneidad de covarianzas y de independencia. Para el caso del presente ejercicio, los dos primeros supuestos no alcanzan a cumplirse con los diagnosticos utilizados (valor p < 0.05), motivo por el cual, el manova de este ejercicio será tomado como una técnica de exploración multivariada para evaluar las diferencias en las 5 especies, basado en las 10 variables morfomètricas seleccionadas.En el siguiente ejercicio se realizarán análisis de varianza no paramétricos pemanovas, que permiten probar hipótesis sin el cumplimiento de ls dos primeros supuestos, por lo cual serán los diseños multivariados más apropiados para esta base de datos.\n\n\n14.0.5.1.1 1.1 Supuesto de normalidad\n\nEl supuesto de normalidad multivariada será evaluado con el paquete mvnormtest, el cual utiliza el estadìstico de Shapiro Wilks Multivariado. Para ello se realizarà esta prueba en cada uno de los grupos o especies en comparación. NOTA: Este supuesto también será evaluado con los residuales del manova, posterior a su ejecución.\n\n# Diagnóstico de normalidad por cada tipo de Especie\nlibrary(mvnormtest)\n\nLos siguientes generan los dataframes de cada especie con las 10 variables seleccionadas, convirtiendola ademàs en formato matricial.\n\n# Dataframe por cada especie\n\n# datos de P. chola.\nP.chola   <- peces %>% \n             filter(Especie == \"P. chola\") %>%       \n             subset(select = c(\"M.1\",\"M.2\",\"M.3\",\"M.4\",\"M.5\",\"M.6\",\"M.7\",\"M.13\",\"M.15\",\"M.18\")) %>%              as.matrix()\n\n# datos de P. conchonious.\nP.concho  <- peces %>% \n             filter(Especie == \"P. conchonious\") %>%       \n             subset(select = c(\"M.1\",\"M.2\",\"M.3\",\"M.4\",\"M.5\",\"M.6\",\"M.7\",\"M.13\",\"M.15\",\"M.18\")) %>%              as.matrix() \n\n# datos de P. sophore.\nP.sophore <- peces %>% \n             filter(Especie == \"P. sophore\") %>%       \n             subset(select = c(\"M.1\",\"M.2\",\"M.3\",\"M.4\",\"M.5\",\"M.6\",\"M.7\",\"M.13\",\"M.15\",\"M.18\")) %>%              as.matrix()     \n\n# datos de P. ticto.\nP.ticto   <- peces %>% \n             filter(Especie == \"P. ticto\") %>%       \n             subset(select = c(\"M.1\",\"M.2\",\"M.3\",\"M.4\",\"M.5\",\"M.6\",\"M.7\",\"M.13\",\"M.15\",\"M.18\")) %>%              as.matrix()       \n\n# datos de P. ticto.\nS.sarana  <- peces %>% \n             filter(Especie == \"S. sarana\") %>%       \n             subset(select = c(\"M.1\",\"M.2\",\"M.3\",\"M.4\",\"M.5\",\"M.6\",\"M.7\",\"M.13\",\"M.15\",\"M.18\")) %>%              as.matrix()  \n\nVale la pena resaltar que los datos de las especies P. chola y P. sophore, son singulares, por lo cual no puede calcularse su supuesto de normalidad multivariada. Con el objeto de continuar en el ejercicio, las matrices que representan a las especies en menciòn, seràn desactivadas con #.\n\n# Prueba de normalidad para cada especie\nlibrary(mvnormtest)\n\n# norm1 <- mshapiro.test(t(P.chola))   # Matriz singular\nnorm2   <- mshapiro.test(t(P.concho))\n# norm3 <- mshapiro.test(t(P.sophore)) # Matriz singular\nnorm4   <- mshapiro.test(t(P.ticto))\nnorm5   <- mshapiro.test(t(S.sarana))\n\nA continuación se resume el resultado de los tres diagnósticos de normalidad multivariada realizados. Vale la pena mencionar que ninguna especie cumple con dicho supuesto estadóstico (valores p < 0.05), aunque existe la posibilidad de probar con alguna transformación.\n\n# Resumen de el diagnóstico de normalidad\n(normalidad = data.frame(Norm.P.concho = norm2$p.value,\n                         Norm.ticto    = norm4$p.value,\n                         Norm.sarana   = norm5$p.value))\n\n  Norm.P.concho   Norm.ticto  Norm.sarana\n1   0.001050723 2.629679e-08 5.169222e-07\n\n\n\n\n\n14.0.5.1.2 1.2 Supuesto de homogeneidad de covarianzas\n\nLa prueba de homogeneidad de covarianza o esfericidad, corresponde al segundo supuesto del análisis discriminante lineal, se utilizará la función betadisper, la cual es complementada por dos análisis de varianza, los cuales definirán si el supuesto logra ser cumplido.\n\n# Pruebas de Homogeneidad de covarianzas paquete \"vegan\"\nlibrary(vegan)\n\npeces.d <- dist(peces[,c(3:9,15,17,20)])                # Matriz de distancias\npeces.homoge <- betadisper(peces.d, peces$Especie)      # Permutest\n\nCon la siguiente anova se obtiene un valor p de 0.016*, lo cual indica que no se cumple el supuesto de homogeneidad de covarianzas (valor p < 0.05).\n\n# 1) Prueba con anova permutacional\nanova(peces.homoge)  \n\nAnalysis of Variance Table\n\nResponse: Distances\n          Df   Sum Sq   Mean Sq F value  Pr(>F)  \nGroups     4 0.019804 0.0049509   3.281 0.01638 *\nResiduals 65 0.098082 0.0015090                  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n\nCon el permutest se obtiene un valor p de 0.015*, lo cual indica que tampoco se cumple el supuesto de homogeneidad de covarianzas (valor p < 0.05).\n\n# 2) Prueba permutacional\npermutest(peces.homoge)   # Se cumple el supuesto de homogeneidad \n\n\nPermutation test for homogeneity of multivariate dispersions\nPermutation: free\nNumber of permutations: 999\n\nResponse: Distances\n          Df   Sum Sq   Mean Sq     F N.Perm Pr(>F)  \nGroups     4 0.019804 0.0049509 3.281    999  0.016 *\nResiduals 65 0.098082 0.0015090                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n\n\n\n\n\n14.0.5.2 Paso 2. Análisis de Varinaza Multivariado - MANOVA\n\nEl manova, por ser un modelo lineal especial, requiere que se indiquen las variables continuas (variables Xi) y la variable cualitativa o categórica (variable Yi), que para este caso es la Especie.\n\n# Manova (variables efecto: 10 morfológicas y la respuesta: Especie)\nattach(peces)\npeces.manova<-manova(cbind(M.1,M.2,M.3,M.4,M.5,M.6,M.7,M.13,M.15,M.18)~Especie)\n\nA continuación se presentará la tabla del manova para las tres primeras variables morfométricas. Para visualizar todos los resultados de este insumo, es necesario colocar solo: summary.aov(peces.manova). Para este caso se observa que todas las variables efecto o morfológicas, tienen un efecto muy significativo (valor p <<0.01) en la diferenciaciación de los 5 grupos o especies de peces.\n\n# respuesta de la variable M.1\nsummary.aov(peces.manova)$\" Response M.1\"\n\n            Df   Sum Sq  Mean Sq F value    Pr(>F)    \nEspecie      4 0.221052 0.055263  127.36 < 2.2e-16 ***\nResiduals   65 0.028205 0.000434                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n# respuesta de la variable M.2\nsummary.aov(peces.manova)$\" Response M.2\"\n\n            Df  Sum Sq  Mean Sq F value    Pr(>F)    \nEspecie      4 0.28343 0.070857   34.76 1.654e-15 ***\nResiduals   65 0.13250 0.002038                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n# respuesta de la variable M.3\nsummary.aov(peces.manova)$\" Response M.3\"\n\n            Df   Sum Sq    Mean Sq F value   Pr(>F)    \nEspecie      4 0.010738 0.00268443  10.486 1.29e-06 ***\nResiduals   65 0.016641 0.00025601                     \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n\nA continuación se presentan los cuatro tipos de MANOVAS, con la diferencia de que Hotelling puede utilizarse sin el cumplimiento del supuesto de normalidad multivariada (pero deben cumplirse los otros supuestos como el de la homogeneidad y el de la independencia). Para este caso los 4 estadísticos muestran altas diferencias entre algunos de los grupos representados por las cinco especies, posiblemente por el efecto de P. sarana, que al ser de un género diferente, presenta marcadas diferencias morfológicas (ver Figura 14.3).\n\n# Tipos de MANOVA para evaluar si hay diferencias en los promedios de cada Especie \nsummary(peces.manova,test=\"Pillai\")\n\n          Df Pillai approx F num Df den Df    Pr(>F)    \nEspecie    4  2.513   9.9711     40    236 < 2.2e-16 ***\nResiduals 65                                            \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nsummary(peces.manova,test=\"Wilks\")\n\n          Df     Wilks approx F num Df den Df    Pr(>F)    \nEspecie    4 0.0028912   19.667     40  214.2 < 2.2e-16 ***\nResiduals 65                                               \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nsummary(peces.manova,test=\"Hotelling\")\n\n          Df Hotelling-Lawley approx F num Df den Df    Pr(>F)    \nEspecie    4           29.052   39.584     40    218 < 2.2e-16 ***\nResiduals 65                                                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nsummary(peces.manova,test=\"Roy\")\n\n          Df    Roy approx F num Df den Df    Pr(>F)    \nEspecie    4 23.757   140.17     10     59 < 2.2e-16 ***\nResiduals 65                                            \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n\n\n\n\n14.0.5.3 Paso 3. Supuestos del MANOVA\n\nSOn tres los supuestos que a continuación se probarán: (1) Normalidad en los residuales, (2) homogeneidad de las covarianzas y (3) Independiencia en los datos. Vale la pena resaltar la importancia del cumplimiento de la independiencia, debido a que presenta un efecto sobre diseños que requieran ser aleatorios. La homogeneidad fue diagnosticada al inicio de este ejercicio no se cumple.\n\n\n\n14.0.5.4 3.1. Supuesto de normalidad de los residuales del MANOVA\n\nA continuación se probará el supuesto de (1) normalidad en los residuales del manova, de forma numérica y gráfica. El estadístico de Shapiro Wilks Multivariado es el que se utiliza, demostrando que los residuales están muy alejados del patrón normal (valor p << 0.01 o p = 3.043e-07).\n\n# 1) Prueba de multinormalidad de los residuales del manova (mshapiro.test)\nlibrary(mvnormtest)\nx <- as.matrix(t(residuals(peces.manova)))\nmshapiro.test(x)\n\n\n    Shapiro-Wilk normality test\n\ndata:  Z\nW = 0.83893, p-value = 3.043e-07\n\n# No se cumple este supuesto\n\nA continuación se hará uso del código fuente “funciones.r” el cual presenta los comandos requeridos para la figura que diagnostica la normalidad multivariada (Figura 14.2 qqplot).\n\n# Figura de multinormalidad\n# Funciones para la figura\nsource(\"funciones.r\")\n\nEn la Figura 14.2 se observa que algunos residuales (puntos circulares) se alejan considerablemente del patrón de normalidad, definido por la recta roja.\n\n# Grafica QQ-PLot para visualizar la normalidad\nx <- as.matrix(residuals(peces.manova)) \n# centroide\ncenter <- colMeans(x) \nn <- nrow(x); p <- ncol(x); cov <- cov(x); \nd <- mahalanobis(x,center,cov) \n\nx11()\nqqplot(qchisq(ppoints(n),df=p),d,\n       main=\"Normalidad multivariada\",\n       ylab=\"Cuantil Chi-Cuadrado\", xlab= \"Distancia Mahalanobish\")\nabline(a=0,b=1,col=2) \n\n\n\n\nFigura 14.2: Figura qqplot entre los residuales observados (Distancia Mahalanobish) y los cuantiles chi cuadrado (estimados).\n\n\n\n\n\n\n\n14.0.5.5 3.2. Supuesto de independencia\n\nSe utilizará el estadístico Durbin Watson (DW) el cual demuestra que se cumple la independencia (valor p > 0.05).\n\n# Prueba de Independencia - Estadistico Durbin Watson\nattach(peces)\nmodelo<-lm(M.1+M.2+M.3+M.4+M.5+M.6+M.7+M.13+M.15+M.18~Especie)\ndurbinWatsonTest(modelo)\n\n lag Autocorrelation D-W Statistic p-value\n   1      0.08444408       1.80425   0.204\n Alternative hypothesis: rho != 0\n\n\n\n\n\n14.0.5.6 Paso 4. Prueba a postriori del MANOVA\n\nA continuación, se realizará una figura del análisis discriminante - lda, que permitirá generar definir al nivel de discriminación de cada grupo o especie de pez. Se presentan algunas opciones gráficas con el procedimiento general y con el análisis discriminate canónico (dca)\n\n# Cálculo del LDA\nnames(peces)\n\n [1] \"Especie\" \"Grupo\"   \"M.1\"     \"M.2\"     \"M.3\"     \"M.4\"     \"M.5\"    \n [8] \"M.6\"     \"M.7\"     \"M.8\"     \"M.9\"     \"M.10\"    \"M.11\"    \"M.12\"   \n[15] \"M.13\"    \"M.14\"    \"M.15\"    \"M.16\"    \"M.17\"    \"M.18\"    \"M.19\"   \n[22] \"M.20\"    \"M.21\"    \"M.22\"    \"M.23\"    \"M.24\"    \"M.25\"    \"M.26\"   \n[29] \"M.27\"    \"M.28\"    \"M.29\"   \n\ndis<-lda (Especie ~ M.1+M.2+M.3+M.4+M.5+M.6+M.7+M.13+M.15+M.18,\n         data = peces)\n\nA continuación se realizará el componente grafico del lda, el cual inicia con una figura que definirá unas elipses, las cuales relacionan a los individuos de cada especie y cuyo solapamiento definirá el nivel de relación entre estas.\n\n# Escores o coordenadas de las observaciones en cada eje can?nico\nFp <- predict(dis)$x\n\n\n# Grupos asignados por el AD\ngroup<-predict(dis,method=\"plug-in\")$class\n\n\n# Coordenadas y grupos asignados\npeces.coord=data.frame(Especie=group,Fp)\n\nLa Figura 14.3 demuestra que si bien de presenta una buena discriminación de las especies de peces, 4 de las 5 evaluadas presentan cierta relación, definida por el solapamiento de sus elipses.\n\n# Figura del LDA\nattach(peces)\nx11()\nscatterplot(LD2~LD1 | Especie, data=peces.coord,reg.line=FALSE, \n            smooth=F, spread=F,span= 1,grid=F,\n            legend=list(coords=\"bottom\"), \n            ellipse=T,font.lab=2, pch=c(15,16,17,18,19),\n            col=c('#fc8d59','#e41a1c','#984ea3','#377eb8','#33a02c'),\n            main=\"Análisis discriminante\",\n            font.main=2,cex.main=2,cex.lab=1.5,\n            xlab=\"Eje1\", ylab=\"Eje2\")\n\n\n\n\nFigura 14.3: Mapa de calor que relaciona a las variables morfométricas y a las especies de peces."
  },
  {
    "objectID": "references.html",
    "href": "references.html",
    "title": "Referencias",
    "section": "",
    "text": "Knuth, Donald E. 1984. “Literate Programming.” Comput.\nJ. 27 (2): 97–111. https://doi.org/10.1093/comjnl/27.2.97."
  }
]